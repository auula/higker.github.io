<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å®ç°webä¸­é—´ä»¶session</title>
    <link href="/2021/04/04/%E5%AE%9E%E7%8E%B0web%E4%B8%AD%E9%97%B4%E4%BB%B6session/"/>
    <url>/2021/04/04/%E5%AE%9E%E7%8E%B0web%E4%B8%AD%E9%97%B4%E4%BB%B6session/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚-è¿°"><a href="#æ¦‚-è¿°" class="headerlink" title="æ¦‚ è¿°"></a>æ¦‚ è¿°</h2><p>å¤§å®¶éƒ½çŸ¥é“ <code>session</code> æ˜¯<code>webåº”ç”¨</code>åœ¨æœåŠ¡å™¨ç«¯å®ç°çš„ä¸€ç§ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´è®¤è¯çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰ <code>Go</code> æ ‡å‡†åŒ…æ²¡æœ‰ä¸º <code>session</code> æä¾›ä»»ä½•æ”¯æŒï¼Œæœ¬æ–‡æˆ‘å°†è®²è§£<code>session</code>çš„å®ç°åŸç†ï¼Œå’Œä¸€äº›å¸¸è§åŸºäº<code>session</code>å®‰å…¨äº§ç”Ÿçš„é˜²å¾¡é—®é¢˜ã€‚</p><p>å½“ç„¶æœ‰äººå¯èƒ½çœ‹äº†ä¼šæŠ¬æ ï¼Œè¯´ç°åœ¨å¤§éƒ¨åˆ†ä¸æ˜¯å‰åç«¯åˆ†ç¦»æ¶æ„å—ï¼Ÿå¯¹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>JWT</code>è§£å†³ä½ çš„é—®é¢˜ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ä¸€ä½“åŒ–<code>web</code>åº”ç”¨éœ€è¦<code>session</code>ï¼Œæ‰€ä»¥æˆ‘å‡†å¤‡é€ ä¸ªè½®å­ã€‚è‡ªå·±é€ çš„è½®å­å“ªé‡Œå‡ºé—®é¢˜äº†ï¼Œæ¯”åˆ«äººæ›´ç†Ÿæ‚‰ï¼Œæœ‰<code>bug</code>äº†ï¼Œè¿˜ä¸ç”¨æ±‚ç€åˆ«äººä¿®<code>bug</code>,è‡ªå·±ä¿®å°±å¥½äº†ï¼Œå‘µå‘µå“ˆå“ˆå“ˆï¼Œå½“ç„¶è¿™å‡ å¥è¯æœ‰ç‚¹çš®ğŸ˜œã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goyrvcs0n1j307q04zaa0.jpg" srcset="/img/loading.gif" alt="å˜¤ å˜¤ å˜¤..."></p><h2 id="éœ€-æ±‚"><a href="#éœ€-æ±‚" class="headerlink" title="éœ€ æ±‚"></a>éœ€ æ±‚</h2><p>æˆ‘è§‰å¾—ä¸€åå¥½çš„ç¨‹åºå‘˜ï¼Œåœ¨å†™ç¨‹åºä¹‹å‰åº”è¯¥åˆ—ä¸€ä¸‹éœ€æ±‚åˆ†æï¼Œæ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œç„¶åå†å»å†™ä»£ç ã€‚</p><ul><li>æ”¯æŒå†…å­˜å­˜å‚¨ä¼šè¯æ•°æ®</li><li>æ”¯æŒåˆ†å¸ƒå¼<code>redis</code>ä¼šè¯å­˜å‚¨</li><li>ä¼šè¯å¦‚æœæœ‰å¿ƒè·³å°±è‡ªåŠ¨ç»­å‘½<code>30</code>åˆ†é’Ÿï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰</li><li>æä¾›é˜²å¾¡ï¼š<code>ä¸­é—´äºº</code>ï¼Œ<code>ä¼šè¯åŠ«æŒ</code>ï¼Œ<code>ä¼šè¯é‡æ”¾</code>ç­‰æ”»å‡»</li></ul><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><p>é¦–å…ˆå¿…é¡»äº†è§£å·¥ä½œåŸç†æ‰èƒ½å†™ä»£ç ï¼Œè¿™é‡Œæˆ‘å°±ç¨å¾®è¯´ä¸€ä¸‹ï¼Œ<code>session</code>æ˜¯åŸºäº<code>cookie</code>å®ç°çš„ï¼Œä¸€ä¸ª<code>session</code>å¯¹åº”ä¸€ä¸ª<code>uuid</code>ä¹Ÿæ˜¯<code>sessionid</code>ï¼Œåœ¨æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œç„¶åæŠŠè¿™ä¸ª<code>sessionid</code>é€šè¿‡<code>cookie</code>è®©æµè§ˆå™¨ä¿å­˜ç€ï¼Œä¸‹æ¬¡æµè§ˆå™¨è¯·æ±‚è¿‡æ¥äº†å°±ä¼šæœ‰<code>sessionid</code>ï¼Œç„¶åé€šè¿‡<code>sessionid</code>è·å–è¿™ä¸ªä¼šè¯çš„æ•°æ®ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goyr6owhr0j30gw0c23z5.jpg" srcset="/img/loading.gif" alt="è¯·æ±‚è¿‡ç¨‹"></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>éƒ½æ˜¯è¯´ç€å®¹æ˜“ï¼Œå®é™…å†™èµ·æ¥å°±æ˜¯å„ç§å‘ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯å®ç°äº†ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goyrnh2ebmj30dc07j3yk.jpg" srcset="/img/loading.gif" alt="linus ğŸ–•"></p><p><strong>å°‘è¯´åºŸè¯ï¼Œè¿˜æ˜¯ç›´æ¥å¹²ä»£ç å§ã€‚</strong></p><ol><li>ä¾èµ–å…³ç³»</li></ol><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goysgg2puij30hz0dz3ys.jpg" srcset="/img/loading.gif" alt="ä¾èµ–å…³ç³»"></p><p>ä¸Šé¢æ˜¯è®¾è®¡çš„ç›¸å…³ä¾èµ–å…³ç³»å›¾ï¼Œ<code>session</code>æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»“æ„ä½“ï¼Œ<br><code>GlobalManager</code>æ˜¯æ•´ä½“çš„ä¼šè¯ç®¡ç†å™¨è´Ÿè´£æ•°æ®æŒä¹…åŒ–ï¼Œè¿‡æœŸä¼šè¯åƒåœ¾å›æ”¶å·¥ä½œâ™»ï¸ï¼Œ<code>storage</code>æ˜¯å­˜å‚¨å™¨æ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬è¦å®ç°ä¸¤ç§æ–¹å¼å­˜å‚¨ä¼šè¯æ•°æ®æˆ–è€…ä»¥åè¦å¢åŠ å…¶ä»–æŒä¹…åŒ–å­˜å‚¨ï¼Œæ‰€ä»¥å¿…é¡»éœ€è¦æ¥å£æŠ½è±¡æ”¯æŒï¼Œ<code>memory</code>å’Œ<code>redis</code>æ˜¯å­˜å‚¨çš„å…·ä½“å®ç°ã€‚</p><ol start="2"><li><code>storage</code>æ¥å£</li></ol><pre><code class="go">package sessionx// session storage interfacetype storage interface {    Read(s *Session) error    Create(s *Session) error    Update(s *Session) error    Remove(s *Session) error}</code></pre><p><code>storage</code>å°±9è¡Œä»£ç ï¼Œæ˜¯å…·ä½“çš„ä¼šè¯æ•°æ®æ“ä½œåŠ¨ä½œçš„æŠ½è±¡ï¼Œå…¨éƒ¨å‚æ•°ä½¿ç”¨çš„æ˜¯<code>session</code>è¿™ä¸ªç»“æ„çš„æŒ‡é’ˆï¼Œå¦‚æœå¤„ç†å¼‚å¸¸äº†å°±<code>å³é”™å³è¿”å›</code>ã€‚</p><p>ä¸ºä»€ä¹ˆæŠŠå‡½æ•°ç­¾åçš„<code>å½¢å‚</code>ä½¿ç”¨æŒ‡é’ˆç±»å‹çš„ï¼Œè¿™ä¸ªæˆ‘æƒ³çœ‹çš„æ‡‚äººåº”è¯¥çŸ¥é“è¿™æ˜¯ä¸ºä»€ä¹ˆäº†ğŸ˜</p><ol start="3"><li><code>memoryStore</code>ç»“æ„ä½“</li></ol><pre><code class="go">type memoryStore struct {    sync.Map}</code></pre><p><code>memoryStore</code>ç»“æ„ä½“é‡Œé¢å°±åµŒå…¥<code>sync.Map</code>ç»“æ„ä½“ï¼Œä¸€å¼€å§‹æ˜¯ä½¿ç”¨çš„<code>map</code>è¿™ç§ï¼Œä½†æ˜¯åé¢å‘ç°åœ¨å¹¶å‘è¯»å†™ç„¶ååŠ <code>sync.Mutex</code>é”ğŸ”ï¼Œæ€§èƒ½è¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨<code>sync.Map</code>é€Ÿåº¦å¿«ã€‚<code>sync.Map</code>ç”¨æ¥åš<code>K:V</code>å­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯<code>sessionid</code>å¯¹åº”<code>session data</code>çš„ã€‚</p><p>å®ç°<code>storage</code>å…·ä½“æ–¹æ³•å¦‚ä¸‹:</p><pre><code class="go">func (m *memoryStore) Read(s *Session) error {    if ele, ok := m.Load(s.ID); ok {      // bug è¿™ä¸ªä¸èƒ½ç›´æ¥ s = ele       s.Data = ele.(*Session).Data      return nil    }    // s = nil    return fmt.Errorf(&quot;id `%s` not exist session data&quot;, s.ID)}</code></pre><p>è¯»å–æ•°æ®çš„æ—¶å€™å…ˆå°†æŒä¹…åŒ–çš„æ•°æ®è¯»å‡ºæ¥ç„¶åèµ‹å€¼ç»™æœ¬æ¬¡ä¼šè¯çš„<code>session</code>ã€‚</p><p><strong>æ³¨æ„:</strong> åœ¨goçš„<code>map</code>ä¸­çš„<code>struct</code>ä¸­çš„å­—æ®µä¸èƒ½å¤Ÿç›´æ¥å¯»å€ï¼Œå®˜æ–¹<strong>issue</strong> <a href="https://github.com/golang/go/issues/3117" target="_blank" rel="noopener">https://github.com/golang/go/issues/3117</a></p><p>å…¶ä»–å‡ ä¸ªå‡½æ•°:</p><pre><code class="go">func (m *memoryStore) Create(s *Session) error {      m.Store(s.ID, s)      return nil}func (m *memoryStore) Remove(s *Session) error {      m.Delete(s.ID)      return nil}func (m *memoryStore) Update(s *Session) error {      if ele, ok := m.Load(s.ID); ok {        // ä¸ºä»€ä¹ˆæ˜¯äº¤æ¢data å› ä¸ºæˆ‘ä»¬ä¸ç¡®å®šä¸Šå±‚æ˜¯å¦æ‰©å®¹æ¢äº†åœ°å€        ele.(*Session).Data = s.Data        ele.(*Session).Expires = s.Expires        //m.sessions[s.ID] = ele        return nil      }      return fmt.Errorf(&quot;id `%s` updated session fail&quot;, s.ID)}</code></pre><p>è¿™å¥è¯ä»£ç æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå†™è¿‡<code>go</code>éƒ½èƒ½çœ‹å¾—æ‡‚ã€‚</p><p>åƒåœ¾å›æ”¶:</p><pre><code class="go">func (m *memoryStore) gc() {    // recycle your trash every 10 minutes    for {        time.Sleep(time.Minute * 10)        m.Range(func(key, value interface{}) bool {            if time.Now().UnixNano() &gt;= value.(*Session).Expires.UnixNano() {              m.Delete(key)            }            return true        })        runtime.GC()        // log.Println(&quot;gc running...&quot;)    }}</code></pre><p>æ¯”è¾ƒä¼šè¯è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸå°±åˆ é™¤ä¼šè¯ï¼Œä»¥ä¸Šå°±æ˜¯å†…å­˜å­˜å‚¨çš„å®ç°ã€‚</p><ol start="4"><li><code>redisStore</code>ç»“æ„ä½“</li></ol><pre><code class="go">type redisStore struct {    sync.Mutex    sessions *redis.Client}func (rs *redisStore) Read(s *Session) error {    sid := fmt.Sprintf(&quot;%s:%s&quot;, mgr.cfg.RedisKeyPrefix, s.ID)    bytes, err := rs.sessions.Get(ctx, sid).Bytes()    if err != nil {      return err    }    if err := rs.sessions.Expire(ctx, sid, mgr.cfg.TimeOut).Err(); err != nil {      return err    }    if err := decoder(bytes, s); err != nil {      return err    }    // log.Println(&quot;redis read:&quot;, s)    return nil}func (rs *redisStore) Create(s *Session) error {    return rs.setValue(s)}func (rs *redisStore) Update(s *Session) error {    return rs.setValue(s)}func (rs *redisStore) Remove(s *Session) error {    return rs.sessions.Del(ctx, fmt.Sprintf(&quot;%s:%s&quot;, mgr.cfg.RedisKeyPrefix, s.ID)).Err()}func (rs *redisStore) setValue(s *Session) error {    bytes, err := encoder(s)    if err != nil {        return err    }    err = rs.sessions.Set(ctx, fmt.Sprintf(&quot;%s:%s&quot;, mgr.cfg.RedisKeyPrefix, s.ID), bytes, mgr.cfg.TimeOut).Err()    return err}</code></pre><p>ä»£ç ä¹Ÿå°±50è¡Œå·¦å³ï¼Œå¾ˆç®€å•å°±æ˜¯é€šè¿‡<code>redis</code>å®¢æˆ·ç«¯å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼ŒæŠŠæœ¬åœ°çš„ä¼šè¯æ•°æ®æä¾›<code>encoding/gob</code>åºåˆ—åŒ–æˆäºŒè¿›åˆ¶å†™åˆ°<code>redis</code>æœåŠ¡å™¨ä¸Šå­˜å‚¨ï¼Œéœ€è¦çš„æ—¶å€™å†ååºåˆ—åŒ–å‡ºæ¥ã€‚</p><p><strong>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¼šæœ‰äººé—®äº†ï¼Œredisæ²¡æœ‰å¹¶å‘é—®é¢˜å—ï¼Ÿ</strong></p><p>ğŸ‘¨â€ğŸ’»â€ï¼š é‚£æˆ‘è‚¯å®šä¼šå›ç­”ï¼Œä½ åœ¨é—®è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰äº†è§£è¿‡<code>redis</code>ï¼Ÿï¼Ÿï¼Ÿ  </p><p><code>Redis</code> å¹¶å‘ç«äº‰æŒ‡çš„æ˜¯å¤šä¸ª <code>Redis</code> å®¢æˆ·ç«¯åŒæ—¶ <code>set key</code>å¼•èµ·çš„å¹¶å‘é—®é¢˜ï¼Œ<code>Redis</code> æ˜¯ä¸€ç§å•çº¿ç¨‹æœºåˆ¶çš„ <code>NoSQL</code> æ•°æ®åº“ï¼Œæ‰€ä»¥ <code>Redis</code> æœ¬èº«å¹¶æ²¡æœ‰é”çš„æ¦‚å¿µã€‚</p><p>ä½†æ˜¯å¤šå®¢æˆ·ç«¯åŒæ—¶å¹¶å‘å†™åŒä¸€ä¸ª <code>key</code>ï¼Œä¸€ä¸ª <code>key</code> çš„å€¼æ˜¯ <code>1</code>ï¼Œæœ¬æ¥æŒ‰é¡ºåºä¿®æ”¹ä¸º <code>2,3,4</code> ï¼Œæœ€å <code>key</code> å€¼æ˜¯ <code>4</code>ï¼Œä½†æ˜¯å› ä¸ºå¹¶å‘å»å†™ <code>key</code>ï¼Œé¡ºåºå¯èƒ½å°±å˜æˆäº† <code>4,3,2</code>ï¼Œæœ€å <code>key</code> å€¼å°±å˜æˆäº† <code>2</code>ã€‚</p><p>æˆ‘è¿™ä¸ªåº“å½“å‰ä¹Ÿå°±ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¦‚æœä½ éƒ¨ç½²åˆ°å¤šä¸ªæœºå­ï¼Œé‚£å°±ä½¿ç”¨ <code>setnx(key, value)</code> æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œæˆ‘å½“å‰å†™çš„è¿™ä¸ªåº“æ²¡æœ‰æä¾›åˆ†å¸ƒå¼é”ï¼Œå…·ä½“è¯·è‡ªè¡Œ<code>google</code>ã€‚</p><ol start="5"><li><code>manager</code>ç»“æ„ä½“</li></ol><pre><code class="go">type storeType uint8const (    // memoryStore store type    M storeType = iota    // redis store type    R    SessionKey = &quot;session-id&quot;)// manager for session managertype manager struct {    cfg   *Configs    store storage}func New(t storeType, cfg *Configs) {    switch t {    case M:        // init memory storage        m := new(memoryStore)        go m.gc()        mgr = &amp;manager{cfg: cfg, store: m}    case R:        // parameter verify        validate := validator.New()        if err := validate.Struct(cfg); err != nil {            panic(err.Error())        }        // init redis storage        r := new(redisStore)        r.sessions = redis.NewClient(&amp;redis.Options{            Addr:     cfg.RedisAddr,            Password: cfg.RedisPassword, // no password set            DB:       cfg.RedisDB,       // use default DB            PoolSize: int(cfg.PoolSize), // connection pool size        })        // test connection        timeout, cancelFunc := context.WithTimeout(context.Background(), 8*time.Second)        defer cancelFunc()        if err := r.sessions.Ping(timeout).Err(); err != nil {            panic(err.Error())        }        mgr = &amp;manager{cfg: cfg, store: r}    default:      panic(&quot;not implement store type&quot;)    }}</code></pre><p><code>manager</code>ç»“æ„ä½“ä¹Ÿå°±ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªå­˜æ”¾æˆ‘ä»¬å…¨å±€é…ç½®ä¿¡æ¯ï¼Œä¸€ä¸ªæˆ‘ä»¬å®ä¾‹åŒ–ä¸åŒçš„æŒä¹…åŒ–å­˜å‚¨çš„å­˜å‚¨å™¨ï¼Œå…¶ä»–ä»£ç å°±æ˜¯è¾…åŠ©æ€§çš„ä»£ç ï¼Œä¸ç»†è¯´äº†ã€‚</p><ol start="6"><li><code>Session</code>ç»“æ„ä½“</li></ol><p>è¿™ä¸ªç»“æ„ä½“æ˜¯å¯¹åº”ç€æµè§ˆå™¨ä¼šè¯çš„ç»“æ„ä½“ï¼Œè®¾è®¡åŸåˆ™æ˜¯ä¸€ä¸ª<code>id</code>å¯¹åº”ä¸€ä¸ª<code>session</code>ç»“æ„ä½“ã€‚</p><pre><code class="go">type Session struct {    // ä¼šè¯ID    ID string    // sessionè¶…æ—¶æ—¶é—´    Expires time.Time    // å­˜å‚¨æ•°æ®çš„map    Data map[interface{}]interface{}    _w   http.ResponseWriter    // æ¯ä¸ªsessionå¯¹åº”ä¸€ä¸ªcookie    Cookie *http.Cookie}</code></pre><p>å…·ä½“æ“ä½œå‡½æ•°:</p><pre><code class="go">// Get Retrieves the stored element data from the session via the keyfunc (s *Session) Get(key interface{}) (interface{}, error) {    err := mgr.store.Read(s)    if err != nil {        return nil, err    }    s.refreshCookie()    if ele, ok := s.Data[key]; ok {        return ele, nil    }    return nil, fmt.Errorf(&quot;key &#39;%s&#39; does not exist&quot;, key)}// Set Stores information in the sessionfunc (s *Session) Set(key, v interface{}) error {    lock[&quot;W&quot;](func() {        if s.Data == nil {          s.Data = make(map[interface{}]interface{}, 8)        }        s.Data[key] = v    })      s.refreshCookie()      return mgr.store.Update(s)}// Remove an element stored in the sessionfunc (s *Session) Remove(key interface{}) error {      s.refreshCookie()    lock[&quot;R&quot;](func() {        delete(s.Data, key)    })      return mgr.store.Update(s)}// Clean up all data for this sessionfunc (s *Session) Clean() error {    s.refreshCookie()    return mgr.store.Remove(s)}// åˆ·æ–°cookie ä¼šè¯åªè¦æœ‰æ“ä½œå°±é‡ç½®ä¼šè¯ç”Ÿå‘½å‘¨æœŸfunc (s *Session) refreshCookie() {    s.Expires = time.Now().Add(mgr.cfg.TimeOut)    s.Cookie.Expires = s.Expires    // è¿™é‡Œä¸æ˜¯ä½¿ç”¨æŒ‡é’ˆ    // å› ä¸ºè¿™é‡Œæˆ‘ä»¬æ”¯æŒredis å¦‚æœwebæœåŠ¡å™¨é‡å¯äº†    // é‚£ä¹ˆsessionæ•°æ®åœ¨å†…å­˜é‡Œæ¸…ç©º    // ä»redisè¯»å–çš„æ•°æ®ååºåˆ—åŒ–åœ°å€å’Œé‡æ–°å¯åŠ¨çš„ä¸ä¸€æ ·    // æ‰€æœ‰ç›´æ¥æ•°æ®æ‹·è´    http.SetCookie(s._w, s.Cookie)}</code></pre><p>ä¸Šé¢æ˜¯å‡ ä¸ªå‡½æ•°æ˜¯ï¼Œä¼šè¯çš„æ•°æ®æ“ä½œå‡½æ•°ï¼Œ<code>refreshCookie()</code>æ˜¯ç”¨æ¥åˆ·æ–°æµè§ˆå™¨<code>cookie</code>ä¿¡æ¯çš„ï¼Œå› ä¸ºæˆ‘åœ¨è®¾è®¡çš„æ—¶å€™åªæœ‰æµè§ˆå™¨æœ‰å¿ƒè·³ä¹Ÿå°±æ˜¯æœ‰æ“ä½œæ•°æ®çš„æ—¶å€™ï¼Œç®¡ç†å™¨å°±é»˜è®¤ä¸ºè¿™ä¸ªæµè§ˆå™¨ä¼šè¯è¿˜æ˜¯æ´»ç€çš„ï¼Œä¼šè‡ªåŠ¨åŒæ­¥æ›´æ–°<code>cookie</code>è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæ›´æ–°è¿‡ç¨‹å¯ä¸æ˜¯å…‰åˆ·æ–°<code>cookie</code>å°±å®Œäº‹çš„äº†ï¼ŒæŒä¹…åŒ–çš„è¯çš„æ•°æ®è¿‡æœŸæ—¶é—´ä¹Ÿä¸€æ ·æ›´æ–°äº†ã€‚</p><p><strong>Handleræ–¹æ³•</strong></p><pre><code class="go">// Handler Get session data from the Requestfunc Handler(w http.ResponseWriter, req *http.Request) *Session {    // ä»è¯·æ±‚é‡Œé¢å–session    var session Session    session._w = w    cookie, err := req.Cookie(mgr.cfg.Cookie.Name)    if err != nil || cookie == nil || len(cookie.Value) &lt;= 0 {        return createSession(w, cookie, &amp;session)    }    // IDé€šè¿‡ç¼–ç ä¹‹åé•¿åº¦æ˜¯73ä½    if len(cookie.Value) &gt;= 73 {        session.ID = cookie.Value        if mgr.store.Read(&amp;session) != nil {            return createSession(w, cookie, &amp;session)        }        // é˜²æ­¢webæœåŠ¡å™¨é‡å¯ä¹‹åredisä¼šè¯æ•°æ®è¿˜åœ¨        // ä½†æ˜¯æµè§ˆå™¨cookieæ²¡æœ‰æ›´æ–°        // é‡æ–°åˆ·æ–°cookie        // å­˜åœ¨æŒ‡é’ˆä¸€è‡´é—®é¢˜ï¼Œè¿™æ ·æ“ä½œè¿˜æ˜¯ä¸€å—å†…å­˜ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦å¤åˆ¶å‰¯æœ¬        _ = session.copy(mgr.cfg.Cookie)        session.Cookie.Value = session.ID        session.Cookie.Expires = session.Expires        http.SetCookie(w, session.Cookie)        }      // åœ°å€ä¸€æ ·ä¸è¡Œï¼ï¼ï¼      // log.Printf(&quot;mgr.cfg.Cookie pointer:%p \n&quot;, mgr.cfg.Cookie)      // log.Printf(&quot;session.cookie pointer:%p \n&quot;, session.Cookie)      return &amp;session}func createSession(w http.ResponseWriter, cookie *http.Cookie, session *Session) *Session {      // init session parameter      session.ID = generateUUID()      session.Expires = time.Now().Add(mgr.cfg.TimeOut)      _ = mgr.store.Create(session)      // é‡ç½®é…ç½®cookieæ¨¡æ¿      session.copy(mgr.cfg.Cookie)      session.Cookie.Value = session.ID      session.Cookie.Expires = session.Expires      http.SetCookie(w, session.Cookie)      return session}</code></pre><p><code>Handler</code>å‡½æ•°æ˜¯ä»<code>http</code>è¯·æ±‚é‡Œé¢è¯»å–åˆ°<code>sessionid</code>ç„¶åä»æŒä¹…åŒ–å±‚è¯»å–æ•°æ®ç„¶åå®ä¾‹åŒ–ä¸€ä¸ª<code>session</code>ç»“æ„ä½“çš„å‡½æ•°ï¼Œæ²¡æœ‰å•¥å¥½è¯´çš„ï¼Œæ³¨é‡Šå†™ä¸Šé¢äº†ã€‚</p><h2 id="å®‰å…¨é˜²å¾¡é—®é¢˜"><a href="#å®‰å…¨é˜²å¾¡é—®é¢˜" class="headerlink" title="å®‰å…¨é˜²å¾¡é—®é¢˜"></a>å®‰å…¨é˜²å¾¡é—®é¢˜</h2><p>é¦–å…ˆæˆ‘è¿˜æ˜¯é‚£å¥è¯ï¼š<code>ä¸æ‡‚æ”»å‡»ï¼Œæ€ä¹ˆåšé˜²å®ˆ</code>ã€‚<br>é‚£æˆ‘ä»¬å…ˆè¯´è¯´è¿™ä¸ªé—®é¢˜æ€ä¹ˆäº§ç”Ÿçš„:</p><blockquote><p><code>ä¸­é—´äººæ”»å‡»</code>ï¼ˆ<code>Man-in-the-MiddleAttack</code>ï¼Œç®€ç§°<code>MITMæ”»å‡»</code>ï¼‰æ˜¯ä¸€ç§<code>é—´æ¥</code>çš„å…¥ä¾µæ”»å‡»ï¼Œè¿™ç§æ”»å‡»æ¨¡å¼æ˜¯é€šè¿‡å„ç§æŠ€æœ¯æ‰‹æ®µå°†å—å…¥ä¾µè€…æ§åˆ¶çš„ä¸€å°è®¡ç®—æœºè™šæ‹Ÿæ”¾ç½®åœ¨ç½‘ç»œè¿æ¥ä¸­çš„ä¸¤å°é€šä¿¡è®¡ç®—æœºä¹‹é—´ï¼Œè¿™å°è®¡ç®—æœºå°±ç§°ä¸º<code>ä¸­é—´äºº</code>ã€‚</p></blockquote><p>è¿™ä¸ªè¿‡ç¨‹ï¼Œæ­£å¸¸ç”¨æˆ·åœ¨é€šè¿‡æµè§ˆå™¨è®¿é—®æˆ‘ä»¬ç¼–å†™çš„ç½‘ç«™ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æœ‰ä¸ª<code>hack</code>é€šè¿‡<code>arp</code>æ¬ºéª—ï¼ŒæŠŠè·¯ç”±å™¨çš„æµé‡åŠ«æŒåˆ°ä»–çš„ç”µè„‘ä¸Šï¼Œç„¶åé»‘å®¢é€šè¿‡ä¸€äº›ç‰¹æ®Šçš„è½¯ä»¶æŠ“åŒ…ä½ çš„ç½‘ç»œè¯·æ±‚æµé‡ä¿¡æ¯ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœä½ <code>sessionid</code>å¦‚æœå­˜æ”¾åœ¨<code>cookie</code>ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½è¢«é»‘å®¢æå–å¤„ç†ï¼Œå¦‚æœä½ è¿™ä¸ªæ—¶å€™ç™»å½•äº†ç½‘ç«™ï¼Œè¿™æ˜¯é»‘å®¢å°±æ‹¿åˆ°ä½ çš„ç™»å½•å‡­è¯ï¼Œç„¶ååœ¨ç™»å½•è¿›è¡Œ<code>é‡æ”¾</code>ä¹Ÿå°±æ˜¯ä½¿ç”¨ä½ çš„<code>sessionid</code>ï¼Œä»è€Œè¾¾åˆ°è®¿é—®ä½ è´¦æˆ·ç›¸å…³çš„æ•°æ®ç›®çš„ã€‚</p><pre><code class="go">func (s *Session) MigrateSession() error {    // è¿ç§»åˆ°æ–°å†…å­˜ é˜²æ­¢ä¼šè¯ä¸€è‡´å¼•å‘å®‰å…¨é—®é¢˜    // è¿™ä¸ªé—®é¢˜çš„æ ¹æºåœ¨ sessionid ä¸å˜ï¼Œå¦‚æœç”¨æˆ·åœ¨æœªç™»å½•æ—¶æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ª sessionidï¼Œç™»å½•ä¹‹åæœåŠ¡ç«¯ç»™ç”¨æˆ·é‡æ–°æ¢ä¸€ä¸ª sessionidï¼Œå°±å¯ä»¥é˜²æ­¢ä¼šè¯å›ºå®šæ”»å‡»äº†ã€‚    s.ID = generateUUID()    newSession, err := deepcopy.Anything(s)    if err != nil {        return errors.New(&quot;migrate session make a deep copy from src into dst failed&quot;)    }    newSession.(*Session).ID = s.ID    newSession.(*Session).Cookie.Value = s.ID    newSession.(*Session).Expires = time.Now().Add(mgr.cfg.TimeOut)    newSession.(*Session)._w = s._w    newSession.(*Session).refreshCookie()    // æ–°å†…å­˜å¼€å§‹æŒä¹…åŒ–    // log.Printf(&quot;old session pointer:%p \n&quot;, s)    // log.Printf(&quot;new session pointer:%p \n&quot;, newSession.(*Session))    //log.Println(&quot;MigrateSession:&quot;, newSession.(*Session))    return mgr.store.Create(newSession.(*Session))}</code></pre><p>å¦‚æœå¤§å®¶å†™è¿‡<code>Java</code>è¯­è¨€ï¼Œéƒ½åº”è¯¥ä½¿ç”¨è¿‡<code>springboot</code>è¿™ä¸ªæ¡†æ¶ï¼Œå¦‚æœä½ çœ‹è¿‡æºä»£ç ï¼Œé‚£å°±çŸ¥é“è¿™ä¸ªæ¡†æ¶é‡Œé¢çš„<code>session</code>å®‰å…¨ç­–ç•¥æœ‰ä¸€ä¸ª<code>migrateSession</code>é€‰é¡¹ï¼Œè¡¨ç¤ºåœ¨ç™»å½•æˆåŠŸä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œç„¶åè®²æ—§çš„ <code>session</code> ä¸­çš„ä¿¡æ¯å¤åˆ¶åˆ°æ–°çš„ <code>session</code> ä¸­ã€‚</p><p>æˆ‘å‚ç…§ä»–çš„ç­–ç•¥ï¼Œä¹ŸåŒæ ·åœ¨æˆ‘è¿™ä¸ªåº“é‡Œé¢å®ç°äº†ï¼Œåœ¨ç”¨æˆ·åŒ¿åè®¿é—®çš„æ—¶å€™æ˜¯ä¸€ä¸ª <code>sessionid</code>ï¼Œå½“ç”¨æˆ·æˆåŠŸç™»å½•ä¹‹åï¼Œåˆæ˜¯å¦å¤–ä¸€ä¸ª <code>sessionid</code>ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆé¿å…ä¼šè¯å›ºå®šæ”»å‡»ã€‚</p><p>ä½¿ç”¨çš„æ—¶å€™ä¹Ÿå¯ä»¥<code>éšæ—¶ä½¿ç”¨é€šè¿‡MigrateSessionè¿›è¡Œè°ƒç”¨</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¸€ä½†è¢«è°ƒç”¨ï¼ŒåŸå§‹æ•°æ®å’Œ<code>id</code>å…¨éƒ¨è¢«åˆ·æ–°äº†ï¼Œå†…å­˜åœ°å€ä¹Ÿæ¢äº†ï¼Œå¯ä»¥çœ‹æˆ‘çš„æºä»£ç ã€‚</p><h2 id="ä½¿ç”¨æ¼”ç¤º"><a href="#ä½¿ç”¨æ¼”ç¤º" class="headerlink" title="ä½¿ç”¨æ¼”ç¤º"></a>ä½¿ç”¨æ¼”ç¤º</h2><pre><code class="go">package mainimport (    &quot;fmt&quot;    &quot;log&quot;    &quot;net/http&quot;    &quot;time&quot;    sessionx &quot;github.com/higker/sesssionx&quot;)var (    // é…ç½®ä¿¡æ¯    cfg = &amp;sessionx.Configs{          TimeOut:        time.Minute * 30,          RedisAddr:      &quot;127.0.0.1:6379&quot;,          RedisDB:        0,          RedisPassword:  &quot;redis.nosql&quot;,          RedisKeyPrefix: sessionx.SessionKey,          PoolSize:       100,          Cookie: &amp;http.Cookie{            Name:     sessionx.SessionKey,            Path:     &quot;/&quot;,            Expires:  time.Now().Add(time.Minute * 30), // TimeOut            Secure:   false,            HttpOnly: true,        },    })func main() {    // Rè¡¨ç¤ºrediså­˜å‚¨ cfgæ˜¯é…ç½®ä¿¡æ¯      sessionx.New(sessionx.R, cfg)    http.HandleFunc(&quot;/set&quot;, func(writer http.ResponseWriter, request *http.Request) {        session := sessionx.Handler(writer, request)        session.Set(&quot;K&quot;, time.Now().Format(&quot;2006 01-02 15:04:05&quot;))        fmt.Fprintln(writer, &quot;set time value succeed.&quot;)    })    http.HandleFunc(&quot;/get&quot;, func(writer http.ResponseWriter, request *http.Request) {        session := sessionx.Handler(writer, request)        v, err := session.Get(&quot;K&quot;)        if err != nil {            fmt.Fprintln(writer, err.Error())            return        }        fmt.Fprintln(writer, fmt.Sprintf(&quot;The stored value is : %s&quot;, v))    })    http.HandleFunc(&quot;/migrate&quot;, func(writer http.ResponseWriter, request *http.Request) {        session := sessionx.Handler(writer, request)        err := session.MigrateSession()        if err != nil {            log.Println(err)        }        fmt.Fprintln(writer, session)    })    _ = http.ListenAndServe(&quot;:8080&quot;, nil)}</code></pre><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goyv71f8qdj30a106sdg9.jpg" srcset="/img/loading.gif" alt="å¥åº·æ£€æµ‹"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goyv89devcj312a0f6jt5.jpg" srcset="/img/loading.gif" alt="å¤šé¡¹é›†æˆåŒ–æµ‹è¯•"></p><h2 id="å°-ç»“"><a href="#å°-ç»“" class="headerlink" title="å° ç»“"></a>å° ç»“</h2><p>æ¨èè¿˜æ˜¯ä½¿ç”¨<code>JWT</code>è¿™ç§æ–¹å¼åšé‰´æƒï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€ä½“åŒ–<code>webåº”ç”¨</code>çš„<code>session</code>ä¹Ÿä¸ä¼šè¢«è¿™ä¹ˆæ—©æ·˜æ±°ï¼Œå¦‚æœä¸Šé¢æœ‰é—®é¢˜ï¼Œæ¬¢è¿å¤§ä½¬ä»¬<code>pr</code>ï¼Œè¿˜æœ‰éƒ¨åˆ†ä»£ç æ²¡æœ‰åˆ—å‡ºï¼Œå¯ä»¥å»ä»“åº“çœ‹çœ‹ã€‚</p><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p>ä»£ç ä»“åº“ï¼š<a href="https://github.com/higker/sessionx" target="_blank" rel="noopener">https://github.com/higker/sessionx</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¼˜é›…çš„å†™æµ‹è¯•Goconvery</title>
    <link href="/2021/04/04/%E4%BC%98%E9%9B%85%E7%9A%84%E5%86%99%E6%B5%8B%E8%AF%95Goconvery/"/>
    <url>/2021/04/04/%E4%BC%98%E9%9B%85%E7%9A%84%E5%86%99%E6%B5%8B%E8%AF%95Goconvery/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®€-ä»‹"><a href="#ç®€-ä»‹" class="headerlink" title="ç®€ ä»‹"></a>ç®€ ä»‹</h2><p>ç›¸ä¿¡å„ä½<code>Gopher</code> åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™éƒ½ç¦»ä¸å¼€ç¼–å†™<code>å•å…ƒæµ‹è¯•</code>ï¼Œ<code>Go</code>è¯­è¨€è™½ç„¶è‡ªå¸¦å•å…ƒæµ‹è¯•åŠŸèƒ½ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥æœ‰ç‚¹ä¹å‘³å’Œæ¯ç‡¥ã€‚åœ¨<code>GoConvey</code>è¯ç”Ÿä¹‹å‰ä¹Ÿå‡ºç°äº†è®¸å¤šç¬¬ä¸‰æ–¹è¾…åŠ©åº“ã€‚ä½†æ²¡æœ‰ä¸€ä¸ªè¾…åŠ©åº“èƒ½å¤Ÿåƒ<code>GoConvey</code>è¿™æ ·ä¼˜é›…åœ°ä¹¦å†™ä»£ç çš„å•å…ƒæµ‹è¯•ï¼Œç®€æ´çš„è¯­æ³•å’Œèˆ’é€‚çš„ç•Œé¢èƒ½å¤Ÿè®©ä¸€ä¸ªä¸çˆ±ä¹¦å†™å•å…ƒæµ‹è¯•çš„å¼€å‘äººå‘˜ä»æ­¤çˆ±ä¸Š<code>å•å…ƒæµ‹è¯•</code>ã€‚</p><p><code>GoConvey</code> æ˜¯ä¸ªç›¸å½“ä¸é”™çš„ <code>Go</code> æµ‹è¯•æ¡†æ¶ï¼Œå…¼å®¹<code>go testing</code>ï¼Œå¹¶ä¸”å¯ç›´æ¥åœ¨ç»ˆç«¯çª—å£å’Œæµè§ˆå™¨ä¸Šä½¿ç”¨ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vv95ap5j31nq0u0nfy.jpg" srcset="/img/loading.gif" alt="GoConvey Web UI"></p><h2 id="ç‰¹-æ€§"><a href="#ç‰¹-æ€§" class="headerlink" title="ç‰¹ æ€§"></a>ç‰¹ æ€§</h2><ul><li>ç›´æ¥æ•´åˆ <code>go test</code></li><li>ä¸°å¯Œçš„æµ‹è¯•æ–­è¨€è§„åˆ™</li><li>å¯è¯»çš„å½©è‰²æ§åˆ¶å°è¾“å‡º</li><li>å…¨è‡ªåŠ¨çš„<code>Web UI</code></li></ul><h2 id="å¿«é€Ÿä½“éªŒ"><a href="#å¿«é€Ÿä½“éªŒ" class="headerlink" title="å¿«é€Ÿä½“éªŒ"></a>å¿«é€Ÿä½“éªŒ</h2><p><strong>å¿«é€Ÿä½“éªŒï¼Œå…ˆçœ‹çœ‹æˆ‘ä»¬çš„ä»£ç </strong></p><pre><code class="go">func TestSpec(t *testing.T) {    Convey(&quot;ç»™å‡ºä¸€ä¸ªå¸¦æœ‰èµ·å§‹å€¼çš„æ•´æ•°&quot;, t, func() {        x := 1        Convey(&quot;å½“æ•´æ•°é€’å¢æ—¶&quot;, func() {            x++            Convey(&quot;è¯¥å€¼çš„ç»“æœåº”æ˜¯å¤§äº&gt;1 ?&quot;, func() {                So(x, ShouldEqual, 2)            })        })    })}</code></pre><p>ç„¶åè·‘èµ·æ¥ï¼š<code>go test -v</code></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vvkvlbuj30i4092dgh.jpg" srcset="/img/loading.gif" alt="æµ‹è¯•ç»“æœ"><br><code>So</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>ä½ è‡ªå·±è¢«æµ‹è¯•é€»è¾‘å‡½æ•°</code>ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>æ–­è¨€è§„åˆ™</code>ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°<code>é¢„è®¡ç»“æœ</code>ï¼Œå¯ä»¥çœ‹åˆ°å±‚æ¬¡æ¸…æ™°ï¼Œå¹¶ä¸”å…¼å®¹<code>go test -v</code>å‘½ä»¤ã€‚</p><h2 id="å¿«é€Ÿä¸Šæ‰‹"><a href="#å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="å¿«é€Ÿä¸Šæ‰‹"></a>å¿«é€Ÿä¸Šæ‰‹</h2><ul><li>åœ¨ä½ çš„é¡¹ç›®å®‰è£…<code>goconvey</code></li><li>åœ¨<code>Go testing</code>æ–‡ä»¶é‡Œé¢ç¼–å†™æµ‹è¯•ä»£ç </li><li>è¿è¡Œå³å¯çœ‹åˆ°æµ‹è¯•ç»“æœ</li></ul><ol><li>åœ¨é¡¹ç›®ä¸‹é¢å®‰è£…<code>goconery</code></li></ol><pre><code class="go">go get github.com/smartystreets/goconvey</code></pre><ol start="2"><li>åœ¨é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ª<code>operator.go</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åªæ˜¯ä¸ºäº†æ¼”ç¤ºå•å…ƒæµ‹è¯•ä½¿ç”¨çš„ä¾‹å­</li></ol><p><strong>operator.go</strong>æ–‡ä»¶</p><pre><code class="go">package testingimport(      &quot;errors&quot;)// ä¸ºäº†æµ‹è¯•ç¼–å†™çš„åŠ å‡ä¹˜é™¤å‡½æ•°func Add(x,y int) int {    return x + y}func  Subtract(x,y int) int {    return x - y}func Division(x,y int)(int,error){    if y == 0 {        return 0,errors.New(&quot;è¢«é™¤æ•°ä¸èƒ½ä¸ºé›¶&quot;)    }    return x / y,nil}func Multiply(x,y int) int{    return x * y}</code></pre><ol start="3"><li>åˆ›å»ºä¸€ä¸ªå•å…ƒæµ‹è¯•å¹¶ä¸”ä½¿ç”¨<code>goconery</code>è¿›è¡Œå•å…ƒæµ‹è¯•</li></ol><p><strong>operator_test.go</strong>æ–‡ä»¶</p><pre><code class="go">// å•å…ƒæµ‹è¯•å‡½æ•°å’Œæ™®é€šgoæµ‹è¯•å‘½åä¸€æ ·func TestAdd(t *testing.T) {    //  Convey å‡½æ•° ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•åç§°    //  t = *testing.T    //     func = è‡ªå®šä¹‰æµ‹è¯•é€»è¾‘    Convey(&quot;ä¸¤æ•°ç›¸åŠ æµ‹è¯•ï¼Œ11 + 11 = 22 ï¼Ÿ&quot;, t, func() {        x, y := 11, 11        // So å‡½æ•°æ¯”è¾ƒç»“æœ ShouldEqual æ˜¯ç›¸ç­‰çš„æ„æ€        So(Add(x,y), ShouldEqual, 22)    })}</code></pre><p>æ³¨æ„: åœ¨é»˜è®¤çš„<code>testing</code>åŒ…ä¹‹å¤–è¿˜è¦å¯¼å…¥ä¸€ä¸ª<code>. &quot;github.com/smartystreets/goconvey/convey&quot;</code>åŒ…ï¼ï¼ï¼</p><p>ç„¶åæµ‹è¯•çœ‹çœ‹ï¼š</p><pre><code class="go">go test -v=== RUN   TestAdd  ä¸¤æ•°ç›¸åŠ æµ‹è¯• âœ”1 total assertion--- PASS: TestAdd (0.00s)PASSok      github.com/higker/testing    0.005s</code></pre><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vwsippdj30fw06bmxi.jpg" srcset="/img/loading.gif" alt="æ­£ç¡®âœ…"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¤šå†™å‡ ä¸ªå‡½æ•°æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre><code class="go">func TestSubtract(t *testing.T) {    Convey(&quot;æµ‹è¯•ä¸¤æ•°ç›¸å‡ï¼Œ22 - 11 != 22 ï¼Ÿ&quot;, t, func() {        x, y := 22, 11        // So å‡½æ•°æ¯”è¾ƒç»“æœ ShouldNotEqual æ˜¯ä¸ç›¸ç­‰çš„æ„æ€        So(Subtract(x,y), ShouldNotEqual, 22)    })}func TestMultiply(t *testing.T) {    Convey(&quot;å°†ä¸¤æ•°ç›¸ä¹˜ï¼Œ11 * 2 = 22 ï¼Ÿ&quot;, t, func() {        x, y := 11, 2        So(Multiply(x,y), ShouldEqual, 22)    })}</code></pre><p>æ–°åŠ äº†2ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢ç›®å½•å¯åŠ¨å‘½ä»¤è¡Œè¾“å…¥<code>goconvey</code>ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¯åŠ¨<code>webç•Œé¢</code>äº†</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vvzk7ecj30yk06rq5w.jpg" srcset="/img/loading.gif" alt="goconveyå‘½ä»¤å¯åŠ¨web ui"></p><ol><li>ç„¶ååœ¨æµè§ˆå™¨æ‰“å¼€<code>http://127.0.0.1:8080/</code>ï¼Œå³å¯çœ‹åˆ°æˆ‘ä»¬åˆšåˆšç¼–å†™çš„æµ‹è¯•ç»“æœé€šè¿‡ç•Œé¢çš„æ–¹å¼å±•ç¤ºå‡ºæ¥äº†</li></ol><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vxfwqtxj314q0u010s.jpg" srcset="/img/loading.gif" alt="http://127.0.0.1:8080/"></p><p>æ˜¯ä¸æ˜¯å¾ˆ<code>cool</code>å¾ˆå“‡å¡ğŸ˜œã€‚ã€‚</p><p>ç°åœ¨æˆ‘åœ¨æµ‹è¯•æ•…æ„åŠ å…¥ä¸€ä¸ªè¿ç®—é”™è¯¯çš„é€»è¾‘ï¼Œçœ‹çœ‹ä¼šæ€ä¹ˆæ ·ã€‚</p><pre><code class="go">func TestDivision(t *testing.T) {    Convey(&quot;å°†ä¸¤æ•°ç›¸é™¤&quot;, t, func() {      x, y := 10, 2      Convey(&quot;é™¤ä»¥é 0 æ•°&quot;, func() {          n,_ := Division(x, y)          So(n, ShouldEqual, 5)      })      Convey(&quot;é™¤ä»¥ 0&quot;, func() {          y = 0 // æˆ‘ä»¬å°†è¢«é™¤æ•°è®¾ç½®ä¸º0          _,err := Division(x, y)          So(err, ShouldNotBeNil)      })    })}</code></pre><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vy22o5jj30i4092dgc.jpg" srcset="/img/loading.gif" alt="ç»“æœ"></p><p>åªè¦<code>GoConvey</code>æ­£åœ¨è¿è¡Œï¼Œæµ‹è¯•ç»“æœå°±ä¼šåœ¨æ‚¨çš„æµè§ˆå™¨çª—å£ä¸­è‡ªåŠ¨æ›´æ–°ã€‚è¯¥è®¾è®¡æ˜¯å“åº”å¼çš„ï¼Œå› æ­¤å¦‚æœéœ€è¦å°†å…¶æ”¾åœ¨ä»£ç æ—è¾¹ï¼Œåˆ™å¯ä»¥å°†æµè§ˆå™¨ç´§ç´§å‹ç¼©ï¼Œè¿™æ—¶æˆ‘ä¸éœ€è¦æ‰‹åŠ¨è·‘æˆ‘ä»¬çš„æµ‹è¯•ï¼Œå› ä¸ºæˆ‘åˆšåˆšé€šè¿‡<code>goconvey</code>èµ·æ¥äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒä¼šç›‘æµ‹æˆ‘ä»¬çš„ä»£ç æ”¹åŠ¨ï¼Œå¹¶ä¸”å®æ—¶åœ¨<code>webç•Œé¢</code>ä¸Šå±•ç¤ºæˆ‘çš„æµ‹è¯•ç»“æœã€‚</p><p><strong>ä¸Šé¢çš„<code>TestDivision</code>å‡½æ•°æˆ‘åšäº†å¤„ç†ï¼Œæ‰€ä»¥ä¸ä¼šæŠ›å¼‚å¸¸ï¼Œå¦‚æœå¼‚å¸¸äº†å°±æ˜¯ä¸‹é¢çš„ğŸ‘‡æˆªå›¾</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vxtpo5xj314q0u04e7.jpg" srcset="/img/loading.gif" alt="å¯ä»¥çœ‹åˆ°ç•Œé¢erroräº†æ˜¾ç¤ºæˆçº¢è‰²äº†"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vyik170j30ph0k2wju.jpg" srcset="/img/loading.gif" alt="ç›¸å…³çš„é”™è¯¯ä¿¡æ¯"></p><p>å¥½äº†ç›¸å…³çš„æ¼”ç¤ºåˆ°æ­¤ä¸ºæ­¢äº†ï¼Œ<code>goconery</code>é€šè¿‡å¾ˆå¤šæµ‹è¯•è§„åˆ™å’Œæ–­è¨€è§„åˆ™ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è§„åˆ™ï¼Œå¤§å®¶å¯ä»¥åœ¨ä»–çš„å®˜æ–¹ç½‘ç«™æ˜¯æŸ¥åˆ°ç›¸å…³çš„èµ„æ–™ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åŠ¨æ‰‹è¯•è¯•ï¼Œæèµ·æ¥ï¼ï¼ï¼</p><h2 id="ç•Œé¢ä¸€äº›å¸®åŠ©ä¿¡æ¯"><a href="#ç•Œé¢ä¸€äº›å¸®åŠ©ä¿¡æ¯" class="headerlink" title="ç•Œé¢ä¸€äº›å¸®åŠ©ä¿¡æ¯"></a>ç•Œé¢ä¸€äº›å¸®åŠ©ä¿¡æ¯</h2><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp7vys8yubj30j91oxjzw.jpg" srcset="/img/loading.gif" alt="uiå›¾è§£"></p><h2 id="Assertions-å†…ç½®çš„æ–­è¨€"><a href="#Assertions-å†…ç½®çš„æ–­è¨€" class="headerlink" title="Assertions å†…ç½®çš„æ–­è¨€"></a>Assertions å†…ç½®çš„æ–­è¨€</h2><p><strong>General Equality</strong></p><pre><code class="go">So(thing, ShouldEqual, thing2)So(thing, ShouldNotEqual, thing2)So(thing, ShouldResemble, thing2)So(thing, ShouldNotResemble, thing2)So(thing, ShouldPointTo, thing2)So(thing, ShouldNotPointTo, thing2)So(thing, ShouldBeNil, thing2)So(thing, ShouldNotBeNil, thing2)So(thing, ShouldBeTrue)So(thing, ShouldBeFalse)</code></pre><p><strong>Numeric Quantity comparison</strong></p><pre><code class="go">So(1, ShouldBeGreaterThan, 0)So(1, ShouldBeGreaterThanOrEqualTo, 0)So(1, ShouldBeLessThan, 2)So(1, ShouldBeLessThanOrEqualTo, 2)So(1.1, ShouldBeBetween, .8, 1.2)So(1.1, ShouldNotBeBetween, 2, 3)So(1.1, ShouldBeBetweenOrEqual, .9, 1.1)So(1.1, ShouldNotBeBetweenOrEqual, 1000, 2000)</code></pre><p><strong>Collections</strong></p><pre><code class="go">So([]int{2, 4, 6}, ShouldContain, 4)So([]int{2, 4, 6}, ShouldNotContain, 5)So(4, ShouldBeIn, ...[]int{2, 4, 6})So(4, ShouldNotBeIn, ...[]int{1, 3, 5})</code></pre><p><strong>Strings</strong></p><pre><code class="go">So(&quot;asdf&quot;, ShouldStartWith, &quot;as&quot;)So(&quot;asdf&quot;, ShouldNotStartWith, &quot;df&quot;)So(&quot;asdf&quot;, ShouldEndWith, &quot;df&quot;)So(&quot;asdf&quot;, ShouldNotEndWith, &quot;df&quot;)So(&quot;asdf&quot;, ShouldContain, &quot;sd&quot;)  // optional &#39;expected occurences&#39; arguments?So(&quot;asdf&quot;, ShouldNotContain, &quot;er&quot;)So(&quot;adsf&quot;, ShouldBeBlank)So(&quot;asdf&quot;, ShouldNotBeBlank)</code></pre><p><strong>panic</strong></p><pre><code>So(func(), ShouldPanic)So(func(), ShouldNotPanic)So(func(), ShouldPanicWith, &quot;&quot;) // or errors.New(&quot;something&quot;)So(func(), ShouldNotPanicWith, &quot;&quot;) // or errors.New(&quot;something&quot;)</code></pre><h2 id="æ€»-ç»“"><a href="#æ€»-ç»“" class="headerlink" title="æ€» ç»“"></a>æ€» ç»“</h2><p><code>goconery</code>ä¼šè®©ä¸€ä¸ªä¸çˆ±å†™å•å…ƒæµ‹è¯•çš„<code>gopher</code>çˆ±ä¸Šå†™æµ‹è¯•ï¼ï¼å†™å‡ºä¼˜é›…çš„æµ‹è¯•ä»£ç ã€‚</p><h2 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h2><p>goconvey: <a href="https://github.com/smartystreets/goconvey" target="_blank" rel="noopener">https://github.com/smartystreets/goconvey</a></p><p>æœ¬ä¾‹å­ä»“åº“ï¼š<a href="https://github.com/higker/goconvey-example" target="_blank" rel="noopener">https://github.com/higker/goconvey-example</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Goconvery</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>csrfæ”»å‡»å’Œé˜²èŒƒ</title>
    <link href="/2021/03/14/csrf%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E8%8C%83/"/>
    <url>/2021/03/14/csrf%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gojm5usbk6j20p00antfb.jpg" srcset="/img/loading.gif" alt="csrfæ”»å‡»å’Œé˜²èŒƒ"></p><h2 id="æ¦‚-è¿°"><a href="#æ¦‚-è¿°" class="headerlink" title="æ¦‚ è¿°"></a>æ¦‚ è¿°</h2><p>éšç€äº’è”ç½‘çš„é«˜é€Ÿå‘å±•ï¼Œä¿¡æ¯å®‰å…¨é—®é¢˜å·²ç»æˆä¸ºä¼ä¸šæœ€ä¸ºå…³æ³¨çš„ç„¦ç‚¹ä¹‹ä¸€ï¼Œè€Œå‰ç«¯åˆæ˜¯å¼•å‘ä¼ä¸šå®‰å…¨é—®é¢˜çš„é«˜å±æ®ç‚¹ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œå‰ç«¯äººå‘˜é™¤äº†ä¼ ç»Ÿçš„ <code>XSS</code>ã€<code>CSRF</code> ç­‰å®‰å…¨é—®é¢˜ä¹‹å¤–ï¼Œåˆæ—¶å¸¸é­é‡ç½‘ç»œåŠ«æŒã€éæ³•è°ƒç”¨ <code>API</code> ç­‰æ–°å‹å®‰å…¨é—®é¢˜ã€‚å½“ç„¶ï¼Œæµè§ˆå™¨è‡ªèº«ä¹Ÿåœ¨ä¸æ–­åœ¨è¿›åŒ–å’Œå‘å±•ï¼Œä¸æ–­å¼•å…¥ <code>CSP</code>ã€<code>Same-Site Cookies</code> ç­‰æ–°æŠ€æœ¯æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†æ˜¯ä»å­˜åœ¨å¾ˆå¤šæ½œåœ¨çš„å¨èƒï¼Œè¿™éœ€è¦æˆ‘ä»¬æŠ€æœ¯äººå‘˜ä¸æ–­å¯¹ç³»ç»Ÿè¿›è¡Œâ€œæŸ¥æ¼è¡¥ç¼ºâ€ã€‚</p><h2 id="åºŸè¯å°‘è¯´ï¼Œå…ˆçœ‹é—®é¢˜"><a href="#åºŸè¯å°‘è¯´ï¼Œå…ˆçœ‹é—®é¢˜" class="headerlink" title="åºŸè¯å°‘è¯´ï¼Œå…ˆçœ‹é—®é¢˜"></a>åºŸè¯å°‘è¯´ï¼Œå…ˆçœ‹é—®é¢˜</h2><p>ä¸ºäº†æ¨¡æ‹Ÿé—®é¢˜æˆ‘è¿™è¾¹ç”¨<code>go</code>å†™äº†<code>2</code>ä¸ªæœåŠ¡ç«¯çš„ä»£ç ï¼Œæ­£å¸¸äº¤æ˜“ç³»ç»Ÿçš„APIï¼Œå½“ç„¶è¿™é‡Œåªæ˜¯ä¸ºäº†<code>æ¼”ç¤ºæ¼æ´åˆ©ç”¨</code>ï¼Œä»£ç æ¯”è¾ƒç®€å•å¦‚ä¸‹:</p><p><strong>transaction.go å†…å®¹:</strong></p><pre><code class="go">package mainimport (    &quot;errors&quot;    &quot;fmt&quot;    &quot;github.com/spf13/cast&quot;    &quot;log&quot;    &quot;net/http&quot;)// æ¨¡æ‹Ÿæ•°æ®å­˜å‚¨type user struct {    id    string    money int}var userdata []*userfunc init() {    userdata = append(userdata, &amp;user{id: &quot;Tom&quot;, money: 10000})    userdata = append(userdata, &amp;user{id: &quot;John&quot;, money: 10000})    userdata = append(userdata, &amp;user{id: &quot;hack&quot;, money: 0})}// æ¨¡æ‹Ÿäº¤æ˜“ç³»ç»ŸAPIfunc main() {    http.HandleFunc(&quot;/transaction&quot;, transactionHandler)    http.ListenAndServe(&quot;:1999&quot;, nil)}// å‡è®¾è¿™æ˜¯äº¤æ˜“å¤„ç†å™¨func transactionHandler(w http.ResponseWriter, req *http.Request) {    if req.URL.Path != &quot;/transaction&quot; {          http.Error(w, &quot;404 not found.&quot;, http.StatusNotFound)          return    }    switch req.Method {    case &quot;GET&quot;:          http.ServeFile(w, req, &quot;form.html&quot;)    case &quot;POST&quot;:      if err := req.ParseForm(); err != nil {          fmt.Fprintf(w, &quot;ParseForm() err: %v&quot;, err)          return      }      if e := transaction(req.FormValue(&quot;Id&quot;), req.FormValue(&quot;toId&quot;), req.FormValue(&quot;money&quot;)); e != nil {          fmt.Fprintf(w,&quot;%s&quot;,e.Error())          return      }      fmt.Fprintf(w,&quot;transaction successful.&quot;)    default:      fmt.Fprintf(w, &quot;Sorry, only GET and POST methods are supported.&quot;)    }}func transaction(Id, toId, money string) error {    if len(Id) &lt;= 0 || len(toId) &lt;= 0 || cast.ToInt(money) &lt;= 0 {      return errors.New(&quot;form invalid parameter&quot;)    }    var user, recipient *user    for _, u := range userdata {      if u.id == Id {          user = u          break      }    }    for _, r := range userdata {      if r.id == toId {          recipient = r          break      }    }    // ç”¨æˆ·ä¸å­˜åœ¨    if user == nil || recipient == nil {      return errors.New(&quot;user does not exist&quot;)    }    // æœ‰é’±æ‰èƒ½è½¬è´¦    if user.money &lt; 0 || user.money &lt; cast.ToInt(money) {      return errors.New(&quot;your balance is insufficient&quot;)    }    user.money = user.money - cast.ToInt(money)    recipient.money = recipient.money + cast.ToInt(money)    log.Printf(&quot;ç”¨æˆ· %s å‘ç”¨æˆ· %s è½¬è´¦ %s å…ƒ.&quot;, Id, toId, money)    return nil}</code></pre><p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç è·‘èµ·æ¥ï¼Œ<code>go run transaction.go</code></p><pre><code>[Running] go run &quot;/Users/ding/Desktop/CSRF_Demo/transaction.go&quot;2021/03/12 21:50:08 Transaction Server Running....</code></pre><p>å¥½äº†ï¼ŒæœåŠ¡å™¨æ­£å¸¸è·‘èµ·æ¥äº†ï¼ŒæŒ‰ç…§æˆ‘ä»¬æ­£å¸¸çš„ç³»ç»Ÿæµç¨‹æ˜¯ï¼Œæˆ‘ä»¬ç™»é™†åˆ°äº†ç³»ç»Ÿé‡Œé¢ï¼Œç³»ç»Ÿé‡Œé¢æœ‰æˆ‘ä»¬çš„æµè§ˆå™¨ä¼šè¯æ•°æ®ï¼Œè¿™æ—¶æˆ‘ä»¬åªæƒ³é€šè¿‡ç³»ç»Ÿç»™å‡ºçš„äº¤æ˜“æ¥å£æ“ä½œå°±å¯ä»¥äº†ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºæˆ‘ä½¿ç”¨<code>postman</code>è¿›è¡Œæµ‹è¯•ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gohgs1l2eij30qi0huabj.jpg" srcset="/img/loading.gif" alt="æ“ä½œæˆªå›¾"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„äº¤æ˜“ç³»ç»Ÿè®¾è®¡çš„æ‰€éœ€çš„å‚æ•°ï¼Œå¹¶ä¸”æˆ‘ä»¬å¡«å†™äº†è¯·æ±‚è¡¨å•æ•°æ®ï¼Œå¹¶ä¸”æäº¤äº†è¿™ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬å»æœåŠ¡å™¨çœ‹çœ‹æ—¥å¿—:</p><pre><code>[Running] go run &quot;/Users/ding/Desktop/CSRF_Demo/transaction.go&quot;2021/03/12 21:50:08 Transaction Server Running....2021/03/12 21:54:41 ç”¨æˆ· Tom å‘ç”¨æˆ· John è½¬è´¦ 2000 å…ƒ.</code></pre><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€æ¡è½¬è´¦è®°å½•ï¼Œè¯´æ˜æˆ‘ä»¬æ“ä½œæˆåŠŸäº†ã€‚</p><h2 id="å¼€å§‹æ¼æ´åˆ©ç”¨"><a href="#å¼€å§‹æ¼æ´åˆ©ç”¨" class="headerlink" title="å¼€å§‹æ¼æ´åˆ©ç”¨"></a>å¼€å§‹æ¼æ´åˆ©ç”¨</h2><p>æŒ‰ç…§æ­£å¸¸äººçš„æ€ç»´æˆ‘ä»¬å°±æ­£å¸¸æ“ä½œå°±è¡Œäº†ï¼Œä½†æ˜¯ä¸–ç•Œè¿™ä¹ˆå¤§æ€ä¹ˆå¯èƒ½æ²¡æœ‰åäººå‘¢ï¼Ÿï¼Ÿï¼Ÿé‚£ä¸‹é¢æŠŠç¬¬ä¸€ä¸ªæœåŠ¡å™¨è·‘èµ·æ¥ï¼Œå¹¶ä¸”è®¿é—®ç¬¬äºŒä¸ªæœåŠ¡å™¨çœ‹çœ‹ç»“æœæ€ä¹ˆæ ·ï¼Ÿï¼Ÿ</p><p><strong>csrf.goæ–‡ä»¶é‡Œé¢å†…å®¹:</strong></p><pre><code class="go">package mainimport (    &quot;log&quot;    &quot;net/http&quot;)func main(){    http.HandleFunc(&quot;/csrf&quot;,csrfHandler)    log.Println(&quot;CSRF Server Running....&quot;)    http.ListenAndServe(&quot;:2021&quot;, nil)}func csrfHandler(writer http.ResponseWriter, request *http.Request) {    http.ServeFile(writer, request, &quot;csrf.html&quot;)}</code></pre><p>é¦–å…ˆæˆ‘æŠŠæ”»å‡»åˆ©ç”¨æœåŠ¡å™¨å¯åŠ¨ <code>go run csrf.go</code></p><pre><code class="go">2021/03/12 22:16:43 CSRF Server Running....</code></pre><p>ç„¶åæˆ‘åœ¨åŒä¸€æµè§ˆå™¨é‡Œé¢è®¿é—®è¿™ä¸ªåœ°å€<code>http://127.0.0.1:2021/csrf</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gohhhxzpwhj30gi02s3yo.jpg" srcset="/img/loading.gif" alt="æ”»å‡»åˆ©ç”¨"></p><p>åœ¨ä½ å›è½¦çš„é‚£ä¸€ç§’ï¼Œå…¶å®è¿™ä¸ªæ¼æ´å·²ç»åˆ©ç”¨æˆåŠŸäº†ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¸æ˜¯ä½ ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ¡†ç›´æ¥è¾“å…¥ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½ åœ¨æ‰“å¼€å…¶ä»–ç½‘ç«™ï¼Œå…¶ä»–ç½‘ç«™é‡Œé¢æœ‰ä¸€ä¸ªåœ°å€å°±æ˜¯è¿™ä¸ªåœ°å€ï¼Œæˆ–è€…æ˜¯ä½ åœ¨<code>QQ</code>æˆ–è€…ä¸€äº›èŠå¤©è½¯ä»¶ä¸Šï¼Œåˆ«äººç»™ä½ å‘é€ä¸€ä¸ªåœ°å€ï¼Œåœ¨ä½ ç‚¹å‡»é‚£ä¸€ç§’è¿™ä¸ªæ”»å‡»å°±æˆåŠŸäº†ã€‚</p><p>é‚£æ€ä¹ˆè¯æ˜æˆåŠŸäº†å‘¢ï¼Ÿæˆ‘ä»¬å»çœ‹çœ‹è½¬è´¦ç³»ç»Ÿçš„æ—¥å¿—ã€‚ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gohhlco3g6j30m704ojs0.jpg" srcset="/img/loading.gif" alt="æ—¥å¿—è®°å½•"></p><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€æ¡è½¬è´¦æ—¥å¿—è®°å½•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åˆšåˆšé€šè¿‡æ¼æ´åˆ©ç”¨è¾¾æˆçš„è½¬è´¦æ•ˆæœã€‚</p><h2 id="é‚£è¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ"><a href="#é‚£è¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£è¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ"></a>é‚£è¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</h2><p>é€šè¿‡æˆ‘ä»¬æ”»å‡»åˆ©ç”¨æœåŠ¡å™¨ä¸Šçš„ä»£ç å¯ä»¥çœ‹å‡ºæ¥æˆ‘ä»¬åœ¨æœåŠ¡å™¨è¿”å›äº†ä¸€ä¸ª<code>csrf.html</code>æ–‡ä»¶ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶åšäº†ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ</p><p><strong>æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</strong></p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;csrf æ”»å‡»æ¼”ç¤º&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=&quot;http://127.0.0.01:1999/transaction&quot; method=POST&gt;    &lt;input type=&quot;hidden&quot; name=&quot;Id&quot; value=&quot;Tom&quot; /&gt;    &lt;input type=&quot;hidden&quot; name=&quot;money&quot; value=&quot;5000&quot; /&gt;    &lt;input type=&quot;hidden&quot; name=&quot;toId&quot; value=&quot;hack&quot; /&gt;&lt;/form&gt;&lt;script&gt; document.forms[0].submit(); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>ç›¸ä¿¡æ˜¯ä¸ªç¨‹åºå‘˜éƒ½èƒ½çœ‹æ‡‚æˆ‘åšäº†ä»€ä¹ˆå§ï¼Œä¸ç”¨ç»†è¯´ã€‚</p><h2 id="CSRFæ”»å‡»å’Œé˜²èŒƒ"><a href="#CSRFæ”»å‡»å’Œé˜²èŒƒ" class="headerlink" title="CSRFæ”»å‡»å’Œé˜²èŒƒ"></a>CSRFæ”»å‡»å’Œé˜²èŒƒ</h2><p>ä¸Šé¢æ”»å‡»è¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<code>CSRF</code>æ”»å‡»ï¼Œç›¸æ¯”<code>XSS</code>ï¼Œ<code>CSRF</code>çš„åæ°”ä¼¼ä¹å¹¶ä¸æ˜¯é‚£ä¹ˆå¤§ï¼Œå¾ˆå¤šäººéƒ½è®¤ä¸º<code>CSRF</code>â€œ<code>ä¸é‚£ä¹ˆæœ‰ç ´åæ€§</code>â€ï¼ŒçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ</p><p><code>CSRF</code>æ”»å‡»çš„ä¾‹å­å·²ç»ä¸æ˜¯å•ä¸ªä¸ªä¾‹äº†ï¼Œ<code>Gmailï¼ŒFacebookï¼ŒTwitterï¼ŒYouTube</code>è¿™äº›éƒ½æœ‰ä¸ªç±»ä¼¼çš„æ¼æ´äº‹ä»¶ã€‚</p><ul><li><a href="https://www.davidairey.com/google-gmail-security-hijack/" target="_blank" rel="noopener">https://www.davidairey.com/google-gmail-security-hijack/</a></li></ul><blockquote><p><code>CSRFï¼ˆCross-site request forgeryï¼‰</code>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gohdrs7ja5j30tg0gyta4.jpg" srcset="/img/loading.gif" alt="CSRFæ”»å‡»åŸç†å›¾"></p><p>æˆ‘åˆšæ‰çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„<code>CSRF</code>ä¾‹å­ï¼Œå—å®³è€…ç™»å½•<code>a.com</code>ï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯<code>ï¼ˆCookieï¼‰</code>ï¼Œæ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº†<code>b.com</code>ï¼Œ<code>b.com</code> å‘ <code>a.com</code> å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼š<code>a.com/xx</code>ã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦a<code>.com</code>çš„<code>Cookie</code>ï¼Œ<code>a.com</code>æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ï¼Œä»è€Œè¾¾åˆ°é»‘å®¢çš„ç›®çš„ã€‚</p><h2 id="å°-ç»“"><a href="#å°-ç»“" class="headerlink" title="å° ç»“"></a>å° ç»“</h2><p>æ¶‰åŠåˆ°é“­æ„Ÿæ•°æ®æ“ä½œçš„åŠ å¼ºéªŒè¯ï¼Œå®¢æˆ·ç«¯çš„æ•°æ®ä¸å¯ä¿¡ï¼ŒæœåŠ¡å™¨åŠ å¼ºå¯¹æ•°æ®æ ¡éªŒï¼Œå’ŒåŠ ä¸€äº›<code>é£æ§</code>ç­–ç•¥ï¼Œä¾‹å¦‚<code>éªŒè¯ç ï¼Œæ‰‹æœºçŸ­ä¿¡ï¼Œjwt</code>ï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹éªŒè¯ç é˜²ç«å¢™ï¼Œä¹Ÿå¯ä»¥åœ¨è¯·æ±‚çš„ä¹‹å‰å…ˆæ‹¿åˆ°ä¸€ä¸ªå”¯ä¸€çš„<code>token</code>ï¼ŒåŒæºæ£€æµ‹ï¼ˆ<code>Origin</code> å’Œ <code>Referer</code> éªŒè¯ï¼‰ï¼Œå½“ç„¶è¿™äº›æ–¹æ³•è¿˜ä¸å®‰å…¨ï¼Œå¦‚æœæœ‰ç©ºä¼šç»­æ›´ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ä¿¡æ¯å®‰å…¨</tag>
      
      <tag>csrf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å›¾è§£å„ç§é™æµç®—æ³•</title>
    <link href="/2021/03/07/%E5%9B%BE%E8%A7%A3%E5%90%84%E7%A7%8D%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95/"/>
    <url>/2021/03/07/%E5%9B%BE%E8%A7%A3%E5%90%84%E7%A7%8D%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰-è¨€"><a href="#å‰-è¨€" class="headerlink" title="å‰ è¨€"></a>å‰ è¨€</h2><blockquote><p>åœ¨å¼€å‘é«˜å¹¶å‘ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°æ¥å£è®¿é—®é¢‘æ¬¡è¿‡é«˜ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨å’Œç¨³å®šæ€§ï¼Œè¿™æ—¶å€™å°±éœ€è¦åšæµé‡é™åˆ¶ï¼Œä½ å¯èƒ½æ˜¯ç”¨çš„ <code>Nginx</code> è¿™ç§ <code>Web Server</code> æ¥æ§åˆ¶è¯·æ±‚ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”¨äº†ä¸€äº›æµè¡Œçš„ç±»åº“å®ç°ã€‚é™æµæ˜¯é«˜å¹¶å‘ç³»ç»Ÿçš„ä¸€å¤§æ€å™¨ï¼Œåœ¨è®¾è®¡é™æµç®—æ³•ä¹‹å‰æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å®ƒä»¬æ˜¯ä»€ä¹ˆã€‚</p></blockquote><h2 id="é™-æµ"><a href="#é™-æµ" class="headerlink" title="é™ æµ"></a>é™ æµ</h2><p><code>é™æµ</code>çš„ç›®çš„æ˜¯é€šè¿‡å¯¹å¹¶å‘è®¿é—®è¯·æ±‚è¿›è¡Œé™é€Ÿï¼Œæˆ–è€…å¯¹ä¸€ä¸ªæ—¶é—´çª—å£å†…çš„è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡ã€æ’é˜Ÿæˆ–ç­‰å¾…ã€é™çº§ç­‰å¤„ç†ã€‚é€šè¿‡å¯¹å¹¶å‘ï¼ˆæˆ–è€…ä¸€å®šæ—¶é—´çª—å£å†…ï¼‰è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™æ‹’ç»æœåŠ¡ï¼ˆå®šå‘åˆ°é”™è¯¯é¡µæˆ–å‘ŠçŸ¥èµ„æºæ²¡æœ‰äº†ï¼‰ã€æ’é˜Ÿç­‰å¾…ï¼ˆæ¯”å¦‚ç§’æ€ã€è¯„è®ºã€ä¸‹å•ï¼‰ã€é™çº§ï¼ˆè¿”å›å…œåº•æ•°æ®æˆ–é»˜è®¤æ•°æ®ï¼‰ã€‚</p><p>å¦‚ å›¾:</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn8bgfh0pzj30pt0ii4bx.jpg" srcset="/img/loading.gif" alt="è‡ªå·±é­”æ”¹å‡ºæ¥çš„æ¼«ç”»"></p><p>å¦‚å›¾ä¸Šçš„æ¼«ç”»ï¼Œåœ¨æŸä¸ªæ—¶é—´æ®µæµé‡ä¸Šæ¥äº†ï¼ŒæœåŠ¡çš„æ¥å£è®¿é—®é¢‘ç‡å¯èƒ½ä¼šéå¸¸å¿«ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹æ¥å£è®¿é—®é¢‘æ¬¡åšé™åˆ¶å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨æ— æ³•æ‰¿å—è¿‡é«˜çš„å‹åŠ›æŒ‚æ‰ï¼Œè¿™æ—¶å€™ä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿæ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥å°±è¦å¯¹å…¶è¿›è¡Œé™æµå¤„ç†ã€‚</p><p>é™æµç®—æ³•å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å»æ§åˆ¶æ¯ä¸ªæ¥å£æˆ–ç¨‹åºçš„å‡½æ•°è¢«è°ƒç”¨é¢‘ç‡ï¼Œå®ƒæœ‰ç‚¹å„¿åƒä¿é™©ä¸ï¼Œé˜²æ­¢ç³»ç»Ÿå› ä¸ºè¶…è¿‡è®¿é—®é¢‘ç‡æˆ–å¹¶å‘é‡è€Œå¼•èµ·ç˜«ç—ªã€‚æˆ‘ä»¬å¯èƒ½åœ¨è°ƒç”¨æŸäº›ç¬¬ä¸‰æ–¹çš„æ¥å£çš„æ—¶å€™ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å“åº”å¤´ï¼š</p><pre><code class="yaml">X-RateLimit-Limit: 60         //æ¯ç§’60æ¬¡è¯·æ±‚X-RateLimit-Remaining: 22     //å½“å‰è¿˜å‰©ä¸‹å¤šå°‘æ¬¡X-RateLimit-Reset: 1612184024 //é™åˆ¶é‡ç½®æ—¶é—´</code></pre><p>ä¸Šé¢çš„ <code>HTTP Response</code> æ˜¯é€šè¿‡å“åº”å¤´å‘Šè¯‰è°ƒç”¨æ–¹æœåŠ¡ç«¯çš„é™æµé¢‘æ¬¡æ˜¯æ€æ ·çš„ï¼Œä¿è¯åç«¯çš„æ¥å£è®¿é—®ä¸Šé™ã€‚ä¸ºäº†è§£å†³é™æµé—®é¢˜å‡ºç°äº†å¾ˆå¤šçš„ç®—æ³•ï¼Œå®ƒä»¬éƒ½æœ‰ä¸åŒçš„ç”¨é€”ï¼Œé€šå¸¸çš„ç­–ç•¥å°±æ˜¯æ‹’ç»è¶…å‡ºçš„è¯·æ±‚ï¼Œæˆ–è€…è®©è¶…å‡ºçš„è¯·æ±‚æ’é˜Ÿç­‰å¾…ã€‚</p><p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œé™æµçš„å¸¸ç”¨å¤„ç†æ‰‹æ®µæœ‰ï¼š</strong></p><ul><li>è®¡æ•°å™¨</li><li>æ»‘åŠ¨çª—å£</li><li>æ¼æ¡¶</li><li>ä»¤ç‰Œæ¡¶</li></ul><h2 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h2><blockquote><p>è®¡æ•°å™¨æ˜¯ä¸€ç§æœ€ç®€å•é™æµç®—æ³•ï¼Œå…¶åŸç†å°±æ˜¯ï¼š<code>åœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…ï¼Œå¯¹è¯·æ±‚è¿›è¡Œè®¡æ•°ï¼Œä¸é˜€å€¼è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦éœ€è¦é™æµï¼Œä¸€æ—¦åˆ°äº†æ—¶é—´ä¸´ç•Œç‚¹ï¼Œå°†è®¡æ•°å™¨æ¸…é›¶ã€‚</code><br>è¿™ä¸ªå°±åƒä½ å»åè½¦ä¸€æ ·ï¼Œè½¦å¢è§„å®šäº†å¤šå°‘ä¸ªä½ç½®ï¼Œæ»¡äº†å°±ä¸è®©ä¸Šè½¦äº†ï¼Œä¸ç„¶å°±æ˜¯è¶…è½½äº†ï¼Œè¢«äº¤è­¦å”å”æŠ“åˆ°äº†å°±è¦ç½šæ¬¾çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿé‚£å°±ä¸æ˜¯ç½šæ¬¾çš„äº‹æƒ…äº†ï¼Œå¯èƒ½ç›´æ¥å´©æ‰äº†ã€‚</p></blockquote><ol><li>å¯ä»¥åœ¨ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ªå˜é‡ <code>count</code>ï¼Œå½“è¿‡æ¥ä¸€ä¸ªè¯·æ±‚æˆ‘å°±å°†è¿™ä¸ªæ•°<code>+1</code>ï¼ŒåŒæ—¶è®°å½•è¯·æ±‚æ—¶é—´ã€‚</li><li>å½“ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™åˆ¤æ–­ <code>count</code> çš„è®¡æ•°å€¼æ˜¯å¦è¶…è¿‡è®¾å®šçš„é¢‘æ¬¡ï¼Œä»¥åŠå½“å‰è¯·æ±‚çš„æ—¶é—´å’Œç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶é—´æ˜¯å¦åœ¨ <code>1</code> åˆ†é’Ÿå†…ã€‚</li><li>å¦‚æœåœ¨ <code>1</code> åˆ†é’Ÿå†…å¹¶ä¸”è¶…è¿‡è®¾å®šçš„é¢‘æ¬¡åˆ™è¯æ˜è¯·æ±‚è¿‡å¤šï¼Œåé¢çš„è¯·æ±‚å°±æ‹’ç»æ‰ã€‚</li><li>å¦‚æœè¯¥è¯·æ±‚ä¸ç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´å¤§äºè®¡æ•°å‘¨æœŸï¼Œä¸” <code>count</code> å€¼è¿˜åœ¨é™æµèŒƒå›´å†…ï¼Œå°±é‡ç½® <code>count</code>ã€‚</li></ol><p>ä»£ç å®ç°:</p><pre><code class="go">package mainimport (    &quot;log&quot;    &quot;sync&quot;    &quot;time&quot;)type Counter struct {    rate  int           //è®¡æ•°å‘¨æœŸå†…æœ€å¤šå…è®¸çš„è¯·æ±‚æ•°    begin time.Time     //è®¡æ•°å¼€å§‹æ—¶é—´    cycle time.Duration //è®¡æ•°å‘¨æœŸ    count int           //è®¡æ•°å‘¨æœŸå†…ç´¯è®¡æ”¶åˆ°çš„è¯·æ±‚æ•°    lock  sync.Mutex}func (l *Counter) Allow() bool {    l.lock.Lock()    defer l.lock.Unlock()    if l.count == l.rate-1 {        now := time.Now()        if now.Sub(l.begin) &gt;= l.cycle {            //é€Ÿåº¦å…è®¸èŒƒå›´å†…ï¼Œ é‡ç½®è®¡æ•°å™¨            l.Reset(now)            return true        } else {            return false        }    } else {        //æ²¡æœ‰è¾¾åˆ°é€Ÿç‡é™åˆ¶ï¼Œè®¡æ•°åŠ 1        l.count++        return true    }}func (l *Counter) Set(r int, cycle time.Duration) {    l.rate = r    l.begin = time.Now()    l.cycle = cycle    l.count = 0}func (l *Counter) Reset(t time.Time) {    l.begin = t    l.count = 0}func main() {    var wg sync.WaitGroup    var lr Counter    lr.Set(3, time.Second) // 1så†…æœ€å¤šè¯·æ±‚3æ¬¡    for i := 0; i &lt; 10; i++ {        wg.Add(1)        log.Println(&quot;åˆ›å»ºè¯·æ±‚:&quot;, i)        go func(i int) {          if lr.Allow() {              log.Println(&quot;å“åº”è¯·æ±‚:&quot;, i)          }          wg.Done()        }(i)        time.Sleep(200 * time.Millisecond)    }    wg.Wait()}</code></pre><p>OutPut:</p><pre><code class="shell">2021/02/01 21:16:12 åˆ›å»ºè¯·æ±‚: 02021/02/01 21:16:12 å“åº”è¯·æ±‚: 02021/02/01 21:16:12 åˆ›å»ºè¯·æ±‚: 12021/02/01 21:16:12 å“åº”è¯·æ±‚: 12021/02/01 21:16:12 åˆ›å»ºè¯·æ±‚: 22021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 32021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 42021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 52021/02/01 21:16:13 å“åº”è¯·æ±‚: 52021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 62021/02/01 21:16:13 å“åº”è¯·æ±‚: 62021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 72021/02/01 21:16:13 å“åº”è¯·æ±‚: 72021/02/01 21:16:14 åˆ›å»ºè¯·æ±‚: 82021/02/01 21:16:14 åˆ›å»ºè¯·æ±‚: 9</code></pre><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„æ˜¯æ¯<code>200ms</code>åˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼Œæ˜æ˜¾é«˜äº<code>1</code>ç§’æœ€å¤š<code>3</code>ä¸ªè¯·æ±‚çš„é™åˆ¶ï¼Œè¿è¡Œèµ·æ¥ä¹‹åå‘ç°ç¼–å·ä¸º <code>2ã€3ã€4ã€8ã€9</code> çš„è¯·æ±‚è¢«ä¸¢å¼ƒï¼Œè¯´æ˜é™æµæˆåŠŸã€‚</p><p><strong>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæœ‰ä¸ªéœ€æ±‚å¯¹äºæŸä¸ªæ¥å£ <code>/query</code> æ¯åˆ†é’Ÿæœ€å¤šå…è®¸è®¿é—® 200 æ¬¡ï¼Œå‡è®¾æœ‰ä¸ªç”¨æˆ·åœ¨ç¬¬ 59 ç§’çš„æœ€åå‡ æ¯«ç§’ç¬é—´å‘é€ 200 ä¸ªè¯·æ±‚ï¼Œå½“ 59 ç§’ç»“æŸå <code>Counter</code> æ¸…é›¶äº†ï¼Œä»–åœ¨ä¸‹ä¸€ç§’çš„æ—¶å€™åˆå‘é€ 200 ä¸ªè¯·æ±‚ã€‚é‚£ä¹ˆåœ¨ 1 ç§’é’Ÿå†…è¿™ä¸ªç”¨æˆ·å‘é€äº† 2 å€çš„è¯·æ±‚ï¼Œè¿™ä¸ªæ˜¯ç¬¦åˆæˆ‘ä»¬çš„è®¾è®¡é€»è¾‘çš„ï¼Œè¿™ä¹Ÿæ˜¯è®¡æ•°å™¨æ–¹æ³•çš„è®¾è®¡ç¼ºé™·ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæ‰¿å—æ¶æ„ç”¨æˆ·çš„å¤§é‡è¯·æ±‚ï¼Œç”šè‡³å‡»ç©¿ç³»ç»Ÿã€‚</strong></p><p>å¦‚ä¸‹å›¾:</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmr45dwvpoj30om0eo75c.jpg" srcset="/img/loading.gif" alt="è®¡æ•°å›¾è§£"></p><p>è¿™ç§æ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½†ä¹Ÿæœ‰ä¸ªå¤§é—®é¢˜å°±æ˜¯æ²¡æœ‰å¾ˆå¥½çš„å¤„ç†å•ä½æ—¶é—´çš„è¾¹ç•Œã€‚</p><h2 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h2><p><code>æ»‘åŠ¨çª—å£</code>æ˜¯é’ˆå¯¹è®¡æ•°å™¨å­˜åœ¨çš„ä¸´ç•Œç‚¹ç¼ºé™·ï¼Œæ‰€è°“ <code>æ»‘åŠ¨çª—å£ï¼ˆSliding windowï¼‰</code> æ˜¯ä¸€ç§æµé‡æ§åˆ¶æŠ€æœ¯ï¼Œè¿™ä¸ªè¯å‡ºç°åœ¨ <code>TCP</code> åè®®ä¸­ã€‚<code>æ»‘åŠ¨çª—å£</code>æŠŠå›ºå®šæ—¶é—´ç‰‡è¿›è¡Œåˆ’åˆ†ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„æµé€ï¼Œè¿›è¡Œç§»åŠ¨ï¼Œå›ºå®šæ•°é‡çš„å¯ä»¥ç§»åŠ¨çš„æ ¼å­ï¼Œè¿›è¡Œè®¡æ•°å¹¶åˆ¤æ–­é˜€å€¼ã€‚</p><p>å¦‚ å›¾ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmr46n366gj30y80eota1.jpg" srcset="/img/loading.gif" alt="å›¾è§£1"></p><p>ä¸Šå›¾ä¸­æˆ‘ä»¬ç”¨çº¢è‰²çš„è™šçº¿ä»£è¡¨ä¸€ä¸ªæ—¶é—´çª—å£ï¼ˆ<code>ä¸€åˆ†é’Ÿ</code>ï¼‰ï¼Œæ¯ä¸ªæ—¶é—´çª—å£æœ‰ <code>6</code> ä¸ªæ ¼å­ï¼Œæ¯ä¸ªæ ¼å­æ˜¯ <code>10</code> ç§’é’Ÿã€‚æ¯è¿‡ <code>10</code> ç§’é’Ÿæ—¶é—´çª—å£å‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œå¯ä»¥çœ‹çº¢è‰²ç®­å¤´çš„æ–¹å‘ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªæ ¼å­éƒ½è®¾ç½®ä¸€ä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨ <code>Counter</code>ï¼Œå‡å¦‚ä¸€ä¸ªè¯·æ±‚åœ¨ <code>0:45</code> è®¿é—®äº†é‚£ä¹ˆæˆ‘ä»¬å°†ç¬¬äº”ä¸ªæ ¼å­çš„è®¡æ•°å™¨ <code>+1</code>ï¼ˆä¹Ÿæ˜¯å°±æ˜¯ <code>0:40~0:50</code>ï¼‰ï¼Œåœ¨åˆ¤æ–­é™æµçš„æ—¶å€™éœ€è¦æŠŠæ‰€æœ‰æ ¼å­çš„è®¡æ•°åŠ èµ·æ¥å’Œè®¾å®šçš„é¢‘æ¬¡è¿›è¡Œæ¯”è¾ƒå³å¯ã€‚</p><p>é‚£ä¹ˆæ»‘åŠ¨çª—å£å¦‚ä½•è§£å†³æˆ‘ä»¬ä¸Šé¢é‡åˆ°çš„é—®é¢˜å‘¢ï¼Ÿæ¥çœ‹ä¸‹é¢çš„å›¾ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmr47hbj6dj31cq0kwgpd.jpg" srcset="/img/loading.gif" alt="å›¾è§£2"></p><p>å½“ç”¨æˆ·åœ¨<code>0:59</code> ç§’é’Ÿå‘é€äº† <code>200</code>ä¸ªè¯·æ±‚å°±ä¼šè¢«ç¬¬å…­ä¸ªæ ¼å­çš„è®¡æ•°å™¨è®°å½• <code>+200</code>ï¼Œå½“ä¸‹ä¸€ç§’çš„æ—¶å€™æ—¶é—´çª—å£å‘å³ç§»åŠ¨äº†ä¸€ä¸ªï¼Œæ­¤æ—¶è®¡æ•°å™¨å·²ç»è®°å½•äº†è¯¥ç”¨æˆ·å‘é€çš„ <code>200</code> ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥å†å‘é€çš„è¯å°±ä¼šè§¦å‘é™æµï¼Œåˆ™æ‹’ç»æ–°çš„è¯·æ±‚ã€‚</p><p>å…¶å®è®¡æ•°å™¨å°±æ˜¯æ»‘åŠ¨çª—å£å•Šï¼Œåªä¸è¿‡åªæœ‰ä¸€ä¸ªæ ¼å­è€Œå·²ï¼Œæ‰€ä»¥æƒ³è®©é™æµåšçš„æ›´ç²¾ç¡®åªéœ€è¦åˆ’åˆ†æ›´å¤šçš„æ ¼å­å°±å¯ä»¥äº†ï¼Œä¸ºäº†æ›´ç²¾ç¡®æˆ‘ä»¬ä¹Ÿä¸çŸ¥é“åˆ°åº•è¯¥è®¾ç½®å¤šå°‘ä¸ªæ ¼å­ï¼Œ<code>æ ¼å­çš„æ•°é‡å½±å“ç€æ»‘åŠ¨çª—å£ç®—æ³•çš„ç²¾åº¦ï¼Œä¾ç„¶æœ‰æ—¶é—´ç‰‡çš„æ¦‚å¿µï¼Œæ— æ³•æ ¹æœ¬è§£å†³ä¸´ç•Œç‚¹é—®é¢˜</code>ã€‚</p><ul><li>ç›¸å…³ç®—æ³•å®ç° <a href="github.com/RussellLuo/slidingwindow">github.com/RussellLuo/slidingwindow</a></li></ul><h2 id="æ¼-æ¡¶"><a href="#æ¼-æ¡¶" class="headerlink" title="æ¼ æ¡¶"></a>æ¼ æ¡¶</h2><p><code>æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼‰</code>ï¼ŒåŸç†å°±æ˜¯ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¼æ¡¶ï¼ŒæŒ‰ç…§å›ºå®šé€Ÿç‡æµå‡ºæ°´æ»´ã€‚ç”¨è¿‡æ°´é¾™å¤´éƒ½çŸ¥é“ï¼Œæ‰“å¼€é¾™å¤´å¼€å…³æ°´å°±ä¼šæµä¸‹æ»´åˆ°æ°´æ¡¶é‡Œï¼Œè€Œæ¼æ¡¶æŒ‡çš„æ˜¯æ°´æ¡¶ä¸‹é¢æœ‰ä¸ªæ¼æ´å¯ä»¥å‡ºæ°´ã€‚å¦‚æœæ°´é¾™å¤´å¼€çš„ç‰¹åˆ«å¤§é‚£ä¹ˆæ°´æµé€Ÿå°±ä¼šè¿‡å¤§ï¼Œè¿™æ ·å°±å¯èƒ½å¯¼è‡´æ°´æ¡¶çš„æ°´æ»¡äº†ç„¶åæº¢å‡ºã€‚</p><p>å¦‚ å›¾ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmr4ascdhrj30cb08bq37.jpg" srcset="/img/loading.gif" alt="æ¼ æ¡¶"></p><p>ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¡¶ï¼Œæœ‰æ°´æµè¿›æ¥ï¼Œä¹Ÿæœ‰æ°´æµå‡ºå»ã€‚å¯¹äºæµè¿›æ¥çš„æ°´æ¥è¯´ï¼Œæˆ‘ä»¬æ— æ³•é¢„è®¡ä¸€å…±æœ‰å¤šå°‘æ°´ä¼šæµè¿›æ¥ï¼Œä¹Ÿæ— æ³•é¢„è®¡æ°´æµçš„é€Ÿåº¦ã€‚ä½†æ˜¯å¯¹äºæµå‡ºå»çš„æ°´æ¥è¯´ï¼Œè¿™ä¸ªæ¡¶å¯ä»¥å›ºå®šæ°´æµå‡ºçš„é€Ÿç‡ï¼ˆ<code>å¤„ç†é€Ÿåº¦</code>ï¼‰ï¼Œä»è€Œè¾¾åˆ° <code>æµé‡æ•´å½¢</code> å’Œ <code>æµé‡æ§åˆ¶</code> çš„æ•ˆæœã€‚</p><p>ä»£ç å®ç°:</p><pre><code class="go">type LeakyBucket struct {    rate       float64 //å›ºå®šæ¯ç§’å‡ºæ°´é€Ÿç‡    capacity   float64 //æ¡¶çš„å®¹é‡    water      float64 //æ¡¶ä¸­å½“å‰æ°´é‡    lastLeakMs int64   //æ¡¶ä¸Šæ¬¡æ¼æ°´æ—¶é—´æˆ³ ms    lock sync.Mutex}func (l *LeakyBucket) Allow() bool {    l.lock.Lock()    defer l.lock.Unlock()    now := time.Now().UnixNano() / 1e6    eclipse := float64((now - l.lastLeakMs)) * l.rate / 1000 //å…ˆæ‰§è¡Œæ¼æ°´    l.water = l.water - eclipse                              //è®¡ç®—å‰©ä½™æ°´é‡    l.water = math.Max(0, l.water)                           //æ¡¶å¹²äº†    l.lastLeakMs = now    if (l.water + 1) &lt; l.capacity {        // å°è¯•åŠ æ°´,å¹¶ä¸”æ°´è¿˜æœªæ»¡        l.water++        return true    } else {        // æ°´æ»¡ï¼Œæ‹’ç»åŠ æ°´        return false    }}func (l *LeakyBucket) Set(r, c float64) {    l.rate = r    l.capacity = c    l.water = 0    l.lastLeakMs = time.Now().UnixNano() / 1e6}</code></pre><p>æ¼æ¡¶ç®—æ³•æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>æ¼æ¡¶å…·æœ‰å›ºå®šå®¹é‡ï¼Œå‡ºæ°´é€Ÿç‡æ˜¯å›ºå®šå¸¸é‡ï¼ˆæµå‡ºè¯·æ±‚ï¼‰</li><li>å¦‚æœæ¡¶æ˜¯ç©ºçš„ï¼Œåˆ™ä¸éœ€æµå‡ºæ°´æ»´</li><li>å¯ä»¥ä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´æ»´åˆ°æ¼æ¡¶ï¼ˆæµå…¥è¯·æ±‚ï¼‰</li><li>å¦‚æœæµå…¥æ°´æ»´è¶…å‡ºäº†æ¡¶çš„å®¹é‡ï¼Œåˆ™æµå…¥çš„æ°´æ»´æº¢å‡ºï¼ˆæ–°è¯·æ±‚è¢«æ‹’ç»ï¼‰</li></ul><p>æ¼æ¡¶é™åˆ¶çš„æ˜¯å¸¸é‡æµå‡ºé€Ÿç‡ï¼ˆå³æµå‡ºé€Ÿç‡æ˜¯ä¸€ä¸ªå›ºå®šå¸¸é‡å€¼ï¼‰ï¼Œæ‰€ä»¥æœ€å¤§çš„é€Ÿç‡å°±æ˜¯å‡ºæ°´çš„é€Ÿç‡ï¼Œä¸èƒ½å‡ºç°çªå‘æµé‡ã€‚</p><h2 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h2><p>ä»¤ç‰Œæ¡¶ç®—æ³•<code>ï¼ˆToken Bucketï¼‰</code>æ˜¯ç½‘ç»œæµé‡æ•´å½¢<code>ï¼ˆTraffic Shapingï¼‰</code>å’Œé€Ÿç‡é™åˆ¶<code>ï¼ˆRate Limitingï¼‰</code>ä¸­æœ€å¸¸ä½¿ç”¨çš„ä¸€ç§ç®—æ³•ã€‚å…¸å‹æƒ…å†µä¸‹ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•ç”¨æ¥æ§åˆ¶å‘é€åˆ°ç½‘ç»œä¸Šçš„æ•°æ®çš„æ•°ç›®ï¼Œå¹¶å…è®¸çªå‘æ•°æ®çš„å‘é€ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmr4cwnxkmj30bq07iwet.jpg" srcset="/img/loading.gif" alt="ä»¤ç‰Œæ¡¶ç®—æ³•"></p><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå›ºå®šçš„æ¡¶ï¼Œæ¡¶é‡Œå­˜æ”¾ç€ä»¤ç‰Œ<code>ï¼ˆtokenï¼‰</code>ã€‚ä¸€å¼€å§‹æ¡¶æ˜¯ç©ºçš„ï¼Œç³»ç»ŸæŒ‰å›ºå®šçš„æ—¶é—´<code>ï¼ˆrateï¼‰</code>å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼Œç›´åˆ°æ¡¶é‡Œçš„ä»¤ç‰Œæ•°æ»¡ï¼Œå¤šä½™çš„è¯·æ±‚ä¼šè¢«ä¸¢å¼ƒã€‚å½“è¯·æ±‚æ¥çš„æ—¶å€™ï¼Œä»æ¡¶é‡Œç§»é™¤ä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœæ¡¶æ˜¯ç©ºçš„åˆ™æ‹’ç»è¯·æ±‚æˆ–è€…é˜»å¡ã€‚</p><p>å®ç°ä»£ç ï¼š</p><pre><code class="go">type TokenBucket struct {    rate         int64 //å›ºå®šçš„tokenæ”¾å…¥é€Ÿç‡, r/s    capacity     int64 //æ¡¶çš„å®¹é‡    tokens       int64 //æ¡¶ä¸­å½“å‰tokenæ•°é‡    lastTokenSec int64 //æ¡¶ä¸Šæ¬¡æ”¾tokençš„æ—¶é—´æˆ³ s    lock sync.Mutex}func (l *TokenBucket) Allow() bool {    l.lock.Lock()    defer l.lock.Unlock()    now := time.Now().Unix()    l.tokens = l.tokens + (now-l.lastTokenSec)*l.rate // å…ˆæ·»åŠ ä»¤ç‰Œ    if l.tokens &gt; l.capacity {        l.tokens = l.capacity    }    l.lastTokenSec = now    if l.tokens &gt; 0 {        // è¿˜æœ‰ä»¤ç‰Œï¼Œé¢†å–ä»¤ç‰Œ        l.tokens--        return true    } else {        // æ²¡æœ‰ä»¤ç‰Œ,åˆ™æ‹’ç»        return false    }}func (l *TokenBucket) Set(r, c int64) {    l.rate = r    l.capacity = c    l.tokens = 0    l.lastTokenSec = time.Now().Unix()}</code></pre><p>ä»¤ç‰Œæ¡¶æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ä»¤ç‰ŒæŒ‰å›ºå®šçš„é€Ÿç‡è¢«æ”¾å…¥ä»¤ç‰Œæ¡¶ä¸­</li><li>æ¡¶ä¸­æœ€å¤šå­˜æ”¾ <code>B</code> ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶æ»¡æ—¶ï¼Œæ–°æ·»åŠ çš„ä»¤ç‰Œè¢«ä¸¢å¼ƒæˆ–æ‹’ç»</li><li>å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œä¸è¶³ <code>N</code> ä¸ªï¼Œåˆ™ä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œä¸”è¯·æ±‚å°†è¢«é™æµï¼ˆä¸¢å¼ƒæˆ–é˜»å¡ç­‰å¾…ï¼‰</li></ul><p>ä»¤ç‰Œæ¡¶é™åˆ¶çš„æ˜¯å¹³å‡æµå…¥é€Ÿç‡ï¼ˆå…è®¸çªå‘è¯·æ±‚ï¼Œåªè¦æœ‰ä»¤ç‰Œå°±å¯ä»¥å¤„ç†ï¼Œæ”¯æŒä¸€æ¬¡æ‹¿3ä¸ªä»¤ç‰Œï¼Œ4ä¸ªä»¤ç‰Œâ€¦ï¼‰ï¼Œå¹¶å…è®¸ä¸€å®šç¨‹åº¦çªå‘æµé‡ã€‚</p><h2 id="å°-ç»“"><a href="#å°-ç»“" class="headerlink" title="å° ç»“"></a>å° ç»“</h2><p>ç›®å‰å¸¸ç”¨çš„æ˜¯<code>ä»¤ç‰Œæ¡¶</code>è¿™ç§ï¼Œæœ¬æ–‡ä»‹ç»äº†å‡ ç§å¸¸è§çš„é™æµç®—æ³•å®ç°ï¼Œæ–‡ç« æ’°å†™ä¸æ˜“ï¼Œç‚¹ä¸ªå…³æ³¨ä¸è¿·è·¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ€ä¹ˆå®ç°ä¸€ä¸ªæœç´¢å¼•æ“</title>
    <link href="/2021/03/07/%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"/>
    <url>/2021/03/07/%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goajgn7ah4j30vq0hsjy7.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="æ¦‚-è¿°"><a href="#æ¦‚-è¿°" class="headerlink" title="æ¦‚ è¿°"></a>æ¦‚ è¿°</h2><blockquote><p>åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£é‡Œï¼Œæˆ‘ä»¬å¹³æ—¶æƒ³è¦å»æ‰¾ä¸€äº›è‡ªå·±æ„Ÿå…´è¶£çš„ä¸œè¥¿é€šå¸¸éƒ½æ˜¯é€šè¿‡<code>æœç´¢å¼•æ“</code>æ¥å¸®ä½ å®ŒæˆæŸ¥æ‰¾çš„ã€‚ç”¨è¿‡æœç´¢å¼•æ“çš„äººéƒ½çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨æœç´¢æ ä¸­è¾“å…¥æˆ‘ä»¬éœ€è¦çš„æŸ¥æ‰¾çš„<code>å…³é”®å­—</code>ï¼Œç‚¹å‡»<code>æœç´¢</code>å°±ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœé¡µé¢ï¼Œè¿™ä¸ªç»“æœé¡µé¢çš„å†…å®¹å°±åŒ…å«äº†æˆ‘ä»¬è¦æŸ¥æ‰¾çš„<code>å…³é”®å­—</code>ã€‚<br>é‚£ä¹ˆ<code>æœç´¢å¼•æ“</code>åˆ°åº•æ˜¯å¦‚ä½•é«˜æ•ˆæŸ¥æ‰¾ç›®æ ‡å†…å®¹å‘¢ï¼Ÿæœ¬æ–‡ä¸»è¦ä»‹ç»<code>æœç´¢å¼•æ“</code>çš„ä¸€äº›å®ç°çš„ç›¸å…³æŠ€æœ¯ã€‚</p></blockquote><h2 id="æ€ä¹ˆä»æ–‡ç« é‡Œé¢æ‰¾åˆ°ä½ éœ€è¦çš„å†…å®¹ï¼Ÿ"><a href="#æ€ä¹ˆä»æ–‡ç« é‡Œé¢æ‰¾åˆ°ä½ éœ€è¦çš„å†…å®¹ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä»æ–‡ç« é‡Œé¢æ‰¾åˆ°ä½ éœ€è¦çš„å†…å®¹ï¼Ÿ"></a>æ€ä¹ˆä»æ–‡ç« é‡Œé¢æ‰¾åˆ°ä½ éœ€è¦çš„å†…å®¹ï¼Ÿ</h2><p>é‚£ä¹ˆç¬¬ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬åœ¨<code>æœç´¢æ¡†</code>é‡Œé¢è¾“å…¥ä¸€å¤§å †ä¿¡æ¯ï¼Œæœç´¢å¼•æ“æ˜¯æ€ä¹ˆæ‰¾åˆ°æˆ‘éœ€è¦çš„å†…å®¹çš„å‘¢ï¼Ÿï¼Ÿè¿™ä¸ªé—®é¢˜æˆ‘è®¤ä¸ºæœ‰ä¸€å®šåŸºç¡€çš„äººéƒ½å¯ä»¥å®ç°å‡ºæ¥ï¼Œä¹Ÿæœ‰å¾ˆå¤šäººè®¨è®ºæ€ä¹ˆå®ç°æ•ˆç‡æ›´é«˜ï¼Œé‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹æˆ‘ä»¬çš„è¯·æ±‚è¿‡ç¨‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goakdpabrjj30rf03v3yr.jpg" srcset="/img/loading.gif" alt="æŸ¥è¯¢è¿‡ç¨‹"></p><p>å½“ç„¶è¿™é‡Œæ˜¯ç®€å•çš„ç”»äº†ä¸€ä¸‹ï¼Œå…·ä½“çœ‹å„è‡ªä¸šåŠ¡æƒ…å†µã€‚</p><h2 id="åˆ†è¯å¤„ç†"><a href="#åˆ†è¯å¤„ç†" class="headerlink" title="åˆ†è¯å¤„ç†"></a>åˆ†è¯å¤„ç†</h2><p>å‡è®¾æˆ‘ä»¬åœ¨<code>æœç´¢æ¡†</code>è¾“å…¥äº†ä¸€äº›æœç´¢å…³é”®å­—ï¼Œé‚£æ˜¯æœç´¢å¼•æ“åœ¨åç«¯ä¼šå¯¹æˆ‘ä»¬çš„è¾“å…¥çš„å…³é”®å­—æˆ–è€…å…³é”®è¯è¿›è¡Œåˆ†è¯å¤„ç†ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨æœç´¢ä¸€å¥è¯<code>I Love You!</code>é‚£è¿™æ®µè¯é€šè¿‡åˆ†è¯ä¹‹åå°±æ˜¯<code>[I,Love,You,I Love You]</code>ï¼Œå½“ç„¶è¿™æ˜¯è‹±æ–‡è¾“å…¥çš„æ—¶å€™ä¼šå¸¦ä¸Šç©ºæ ¼ï¼Œå¦‚æœæ˜¯ä¸­æ–‡çš„è¯éœ€è¦å€ŸåŠ©ä¸€äº›ä¸“ä¸šçš„åˆ†è¯ç®—æ³•åº“è¿›è¡Œåˆ†è¯æ“ä½œï¼Œè¿™é‡Œä¸ç»†è¯´ã€‚</p><p><strong>ç›¸å…³çš„ç®—æ³•</strong></p><ul><li>å‰ç¼€è¯å…¸å®ç°é«˜æ•ˆçš„è¯å›¾æ‰«æï¼Œç”Ÿæˆå¥å­ä¸­æ±‰å­—æ‰€æœ‰å¯èƒ½å‡ºç°æˆè¯æƒ…å†µæ‰€æ„æˆçš„æœ‰å‘æ— ç¯å›¾ï¼ˆ<code>DAG</code>ï¼‰</li><li>é‡‡ç”¨åŠ¨æ€è§„åˆ’æŸ¥æ‰¾æœ€å¤§æ¦‚ç‡è·¯å¾„ï¼Œæ‰¾å‡ºåŸºäºè¯é¢‘æœ€å¤§åˆ‡åˆ†ç»„åˆ</li><li>å¯¹äºæœªç™»å½•è¯ï¼Œé‡‡ç”¨æ±‰å­—æˆè¯èƒ½åŠ›çš„<code>HMMæ¨¡å‹</code>ï¼Œé‡‡ç”¨<code>Viterbiç®—æ³•</code>è®¡ç®—</li><li>åŸºäº<code>Viterbiç®—æ³•</code>åšè¯æ€§æ ‡æ³¨</li><li>åŸºäº<code>TF-IDF</code>å’Œ<code>TextRankæ¨¡å‹</code>æŠ½å–å…³é”®è¯</li></ul><h2 id="æ•°æ®å¤ªå¤šäº†ï¼Œæ€ä¹ˆæŸ¥æ‰¾ï¼Ÿ"><a href="#æ•°æ®å¤ªå¤šäº†ï¼Œæ€ä¹ˆæŸ¥æ‰¾ï¼Ÿ" class="headerlink" title="æ•°æ®å¤ªå¤šäº†ï¼Œæ€ä¹ˆæŸ¥æ‰¾ï¼Ÿ"></a>æ•°æ®å¤ªå¤šäº†ï¼Œæ€ä¹ˆæŸ¥æ‰¾ï¼Ÿ</h2><p>å‡è®¾æˆ‘ä»¬æœåŠ¡å™¨åŒ…å«1000ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬è¦åœ¨è¿™äº›æ–‡ç« æ–‡ä»¶é‡Œé¢æ‰¾åˆ°åŒ…å«æœ‰<code>xxx</code>çš„å†…å®¹ï¼Œå¦‚æœä»å¤´å¼€å§‹éå†æ–‡ä»¶å†…å®¹ç„¶åå¯¹åŒ¹é…çš„åšä¸ªè®°å½•å’Œæ”¶é›†è¿”å›ï¼Œè¯»å–ä¸€ç¯‡æ–‡ç« æ‰€æ¶ˆè€—çš„æ—¶é—´å‡å®šä¸º50æ¯«ç§’ï¼Œæ¯ç¯‡æ–‡ç« æœç´¢æ¶ˆè€—0.1æ¯«ç§’ï¼Œé‚£è¿™æ ·æ˜¯ä¸æ˜¯å¤ªæµªè´¹æœåŠ¡å™¨èµ„æºäº†ï¼ï¼</p><p>ç»è¿‡ç®€å•çš„æ¨ç®—ä¼šæ˜æ˜¾å‘ç°ï¼Œè¿™ä¸ªæœç´¢çš„é€Ÿåº¦æ˜¯å®Œå…¨ä¸å¯èƒ½æ¥å—çš„ï¼Œäººå®¶<code>google</code>ï¼Œ<code>sogo</code>å¯éƒ½æ˜¯å‡ ç™¾æ¯«ç§’å–å‡ºä¸Šäº¿çš„åˆ—è¡¨æ‰€ä»¥ï¼Œä¸Šè¿°çš„æ–¹æ³•å®Œå…¨è¡Œä¸é€šï¼Œæˆ‘ä»¬éœ€è¦æ–°çš„æ–¹æ³•ã€‚</p><h2 id="å€’æ’ç´¢å¼•-è¯¥ä¸Šåœºäº†"><a href="#å€’æ’ç´¢å¼•-è¯¥ä¸Šåœºäº†" class="headerlink" title="å€’æ’ç´¢å¼• è¯¥ä¸Šåœºäº†"></a><code>å€’æ’ç´¢å¼•</code> è¯¥ä¸Šåœºäº†</h2><blockquote><p><code>å€’æ’ç´¢å¼•</code>ï¼ˆ<code>è‹±æ–‡ï¼šInverted Index</code>ï¼‰ï¼Œæ˜¯ä¸€ç§ç´¢å¼•æ–¹æ³•ï¼Œå¸¸è¢«ç”¨äºå…¨æ–‡æ£€ç´¢ç³»ç»Ÿä¸­çš„ä¸€ç§<code>å•è¯æ–‡æ¡£æ˜ å°„ç»“æ„</code>ã€‚ç°ä»£æœç´¢å¼•æ“ç»å¤§å¤šæ•°çš„ç´¢å¼•éƒ½æ˜¯åŸºäºå€’æ’ç´¢å¼•æ¥è¿›è¡Œæ„å»ºçš„ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨æœç´¢å¼•æ“æŸ¥æ‰¾ä¿¡æ¯æ—¶å¾€å¾€åªè¾“å…¥ä¿¡æ¯ä¸­çš„æŸä¸ªå±æ€§å…³é”®å­—ï¼Œå¦‚ä¸€äº›ç”¨æˆ·ä¸è®°å¾—æ­Œåï¼Œä¼šè¾“å…¥æ­Œè¯æ¥æŸ¥æ‰¾æ­Œåï¼Œè¾“å…¥æŸä¸ªèŠ‚ç›®å†…å®¹ç‰‡æ®µæ¥æŸ¥æ‰¾è¯¥èŠ‚ç›®ç­‰ç­‰ã€‚</p></blockquote><p><code>å€’æ’ç´¢å¼•</code>æ˜¯<code>å…³é”®è¯â€”â€”æ–‡æ¡£</code>å½¢å¼çš„ä¸€ç§æ˜ å°„ç»“æ„ï¼Œå®ç°äº†é€šè¿‡ç‰©å“å±æ€§ä¿¡æ¯å¯¹ç‰©å“è¿›è¡Œæ˜ å°„æ—¶ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½åˆ°ç›®æ ‡ä¿¡æ¯ï¼Œä»è€Œæå¤§é™ä½äº†ä¿¡æ¯è·å–éš¾åº¦ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goamak8fytj309q09qwf0.jpg" srcset="/img/loading.gif" alt=""></p><p>ç›¸ä¿¡å¤§å®¶éƒ½ä½¿ç”¨ğŸ‘†è¿™ä¸ªï¼Œå­—å…¸çš„ç›®å½•å’Œä¾§é¢éƒ½åšäº†ä¸€äº›ç‰¹æ®Šæ ‡è®°ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´å¿«æŸ¥æ‰¾åˆ°æŸäº›å†…å®¹ã€‚<code>å€’æ’ç´¢å¼•</code>ä¹Ÿæ˜¯è¿™æ ·çš„å¯¹æºæ•°æ®çš„å†…å®¹è¿›è¡Œç‰¹æ®Šçš„å¤„ç†æŠŠé‡Œé¢çš„ä¿¡æ¯åšä¸€ä¸ªç´¢å¼•è®°å½•ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goamle0eltj30i10d80ur.jpg" srcset="/img/loading.gif" alt="å€’æ’ç´¢å¼•å›¾"></p><p>ä¸€èˆ¬åœ°ï¼Œå½“æ¥å—åˆ°ç”¨æˆ·æŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œè¿›å…¥åˆ°å€’æ’ç´¢å¼•è¿›è¡Œæ£€ç´¢æ—¶ï¼Œåœ¨è¿”å›ç»“æœçš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>åœ¨åˆ†è¯ç³»ç»Ÿå¯¹ç”¨æˆ·è¯·æ±‚ç­‰åŸå§‹<code>Query</code>è¿›è¡Œåˆ†æï¼Œäº§ç”Ÿå¯¹åº”çš„<code>terms</code>ï¼›</li><li><code>terms</code>åœ¨å€’æ’ç´¢å¼•ä¸­çš„è¯é¡¹åˆ—è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„<code>terms</code>çš„ç»“æœåˆ—è¡¨ï¼›</li><li>å¯¹ç»“æœåˆ—è¡¨æ•°æ®è¿›è¡Œå¾®è¿ç®—ï¼Œå¦‚ï¼šè®¡ç®—æ–‡æ¡£é™æ€åˆ†ï¼Œæ–‡æ¡£ç›¸å…³æ€§ç­‰ï¼›</li><li>åŸºäºä¸Šè¿°è¿ç®—å¾—åˆ†å¯¹æ–‡æ¡£è¿›è¡Œç»¼åˆæ’åºï¼Œæœ€åè¿”å›ç»“æœç»™ç”¨æˆ·ã€‚</li></ul><p>æ„å»ºå€’æ’ç´¢å¼•æ˜¯æœç´¢å¼•æ“é‡Œé¢è‡³å…³é‡è¦çš„ä¸€ä¸ªæ­¥éª¤ã€‚ä»æŠ€æœ¯å±‚é¢å»åˆ†æï¼Œå¯¹äºæ„é€ ä¸€ä¸ªå€’æ’ç´¢å¼•ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li>Doc2termè¯é¡¹æ„é€ </li><li>å€’æ’è®°å½•è¡¨çš„æ„å»º</li></ul><h2 id="è¯é¡¹æ„é€ "><a href="#è¯é¡¹æ„é€ " class="headerlink" title="è¯é¡¹æ„é€ "></a>è¯é¡¹æ„é€ </h2><p><code>è¯é¡¹æ„é€ </code>æ˜¯åœ¨æ„å»ºç´¢å¼•è¿‡ç¨‹ä¸­å¿…ä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªæ­¥éª¤ï¼Œè¯é¡¹æ„é€ æ•ˆæœçš„å¥½åå¾€å¾€ä¼šç›´æ¥å½±å“åˆ°ç”¨æˆ·çš„æœç´¢ä½“éªŒï¼Œä»¥åŠæœç´¢ç»“æœçš„å¬å›ã€‚è¯¥è¿‡ç¨‹ä¸»è¦æ˜¯åˆ©ç”¨åˆ†è¯ç³»ç»Ÿå°†æ–‡æ¡£ä¸­çš„å„é¡¹å±æ€§çš„æ–‡æœ¬ä¿¡æ¯æ‹†åˆ†æˆä¸€äº›è¡¨æ„è¾ƒå¼ºä¸”é‡è¦çš„è¯æ±‡ï¼Œä¾¿äºç”¨æˆ·æŸ¥æ‰¾ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1goan3ri2onj30mx0epab6.jpg" srcset="/img/loading.gif" alt=""></p><p>ä¾‹å¦‚é—®é¢˜ï¼š</p><ul><li>é‡éŸ³åŠå˜éŸ³ç¬¦å·é—®é¢˜</li><li>å¤§å°å†™è½¬æ¢é—®é¢˜</li><li>ä¸­æ–‡å¤šéŸ³å­—é—®é¢˜</li><li>ç¾å¼è‹±è¯­é—®é¢˜</li></ul><p>ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼šæˆ‘ä»¬å¯¹åŒ¹é…çš„è¯è¯­è¿›è¡Œç»Ÿè®¡ï¼Œå¼•ç”¨æ¬¡æ•°è¶Šå¤šï¼Œé‚£ä¹ˆåŒ¹é…åº¦è¶Šé«˜ï¼Œå¯ä»¥è®¤ä¸ºè¶Šå‡†ç¡®ã€‚</p><h2 id="å°-ç»“"><a href="#å°-ç»“" class="headerlink" title="å° ç»“"></a>å° ç»“</h2><p>æœ¬æ–‡ä»‹ç»çš„åªæ˜¯ç®€å•çš„å…¨æ–‡æœç´¢å®ç°åŠåŸç†ï¼Œå¦‚æœè¦åšä¸“ä¸šçº§çš„æœç´¢å¼•æ“ï¼Œè¿™äº›çŸ¥è¯†æ˜¯å®Œå…¨ä¸å¤Ÿçš„ã€‚ä½ éœ€è¦çŸ¥é“çˆ¬è™«ï¼Œè‡ªç„¶è¯­è¨€åˆ†æå¤„ç†ï¼Œæ€ä¹ˆæé«˜æœç´¢å¤„ç†çš„é€Ÿåº¦ç­‰ç­‰ï¼Œæµ·é‡æ•°æ®çš„å­˜å‚¨ç­‰ç­‰çŸ¥è¯†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goçš„WebAssemblyåº”ç”¨</title>
    <link href="/2021/01/07/Go%E7%9A%84WebAssembly%E5%BA%94%E7%94%A8/"/>
    <url>/2021/01/07/Go%E7%9A%84WebAssembly%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmfcr3hkdjj31mx0u07oa.jpg" srcset="/img/loading.gif" alt="Go WebAssembly"></p><h2 id="ä»‹-ç»"><a href="#ä»‹-ç»" class="headerlink" title="ä»‹ ç»"></a>ä»‹ ç»</h2><p>  åœ¨ go 1.11 çš„æ—¶å€™ go å®˜æ–¹å‘ go å®éªŒæ€§çš„æ·»åŠ äº† WebAssembly æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´ golang å¯ä»¥ç¼–è¯‘ ä¸º wasm ä»¥ä¾› JavaScript è¿›è¡Œè°ƒç”¨ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘æƒ³è¯´ä¸€ä¸‹æˆ‘çš„æ„Ÿå—ï¼Œåœ¨ç¼–å†™ä»£ç æ—¶åº”è¯¥æ˜¯ä¸»è¦ç¼–å†™ go çš„ä»£ç ä¾› JavaScript è°ƒç”¨ è€Œä¸æ˜¯åœ¨ åœ¨ go ä¸­è°ƒç”¨ JavaScript ä»£ç ã€‚</p><p>ç›®å‰ go è¿˜åªæ˜¯å®éªŒæ€§çš„æ”¯æŒ wasm ä»¥åå¯èƒ½ä¼šå˜æ›´ï¼Œåé¢æˆ‘ä¼šå°½é‡è·Ÿè¿›ã€‚</p><p>å¦å¤–å¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œæ¨èä¸€æœ¬æŸ´æ ‘æ‰ã€ä¸å°”ç”·ä¸¤ä½å¤§ä½¬çš„ã€Š<code>WebAssembly æ ‡å‡†å…¥é—¨</code>ã€‹ï¼Œä¼°è®¡ä¹Ÿå¿«å‘å”®äº†ã€‚</p><h2 id="WebAssembly-ç®€ä»‹"><a href="#WebAssembly-ç®€ä»‹" class="headerlink" title="WebAssembly ç®€ä»‹"></a>WebAssembly ç®€ä»‹</h2><blockquote><p><a href="https://webassembly.org/" target="_blank" rel="noopener" title="WebAssembly">WebAssembly</a> æ˜¯ä¸€ç§æ–°å…´çš„ç½‘é¡µè™šæ‹Ÿæœºæ ‡å‡†ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡åŒ…æ‹¬é«˜å¯ç§»æ¤æ€§ã€é«˜å®‰å…¨æ€§ã€é«˜æ•ˆç‡ï¼ˆåŒ…æ‹¬è½½å…¥æ•ˆç‡å’Œè¿è¡Œæ•ˆç‡ï¼‰ã€å°½å¯èƒ½å°çš„ç¨‹åºä½“ç§¯ï¼ŒWebAssembly ç¨‹åºåœ¨ JavaScript ç¯å¢ƒä¸‹çš„ä½¿ç”¨æ–¹æ³•ã€WebAssembly æ±‡ç¼–è¯­è¨€å’ŒäºŒè¿›åˆ¶æ ¼å¼ã€‚å¦å¤–WebAssemblyæœ‰å¥½å‡ ä¸ªå¹²çˆ¹:ä¸‡ç»´ç½‘è”ç›Ÿã€ Mozillaã€å¾®è½¯ã€è°·æ­Œã€ è‹¹æœã€‚</p></blockquote><h2 id="Hello-Wasm"><a href="#Hello-Wasm" class="headerlink" title="Hello Wasm"></a>Hello Wasm</h2><p>ç”±äºç›®å‰åªæ˜¯å®éªŒæ€§çš„æ”¯æŒï¼Œåœ¨ç¼–å†™ä»£ç æ—¶ å¼•ç”¨ <code>syscall/js</code> ä¼šçˆ†çº¢ éœ€è¦åœ¨<code>goland</code>ä¸­å°†å˜é‡ç¯å¢ƒ æŒ‡å®šä¸º <code>OS=js ARCH=wasm goland</code> çš„è®¾ç½®åœ¨ <code>seting -&gt; Go -&gt; Build Tags &amp;&amp; Vendoring</code> ä¸­è¿›è¡Œæ›´æ”¹ã€‚</p><p>æµè§ˆå™¨ æˆ‘ä½¿ç”¨çš„æ˜¯ chrome åŒ…æ‹¬ js éƒ¨åˆ†æ¼”ç¤ºæˆ‘ä¹Ÿæ˜¯åœ¨ chrome ä¸‹è¿›è¡Œã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªé¡¹ç›® <code>hello-wasm-go</code></li></ol><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmf71jtq1tj30tn0krn1p.jpg" srcset="/img/loading.gif" alt="hello-wasm-go"></p><ol start="2"><li>åˆ›å»º main.go å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹</li></ol><pre><code>package mainimport &quot;fmt&quot;func main() {    fmt.Println(&quot;Hello, WebAssembly!&quot;)}</code></pre><ol start="3"><li>ç„¶åå°† main.go ç¼–è¯‘ä¸º main.wasm</li></ol><pre><code class="bash">GOOS=js GOARCH=wasm go build -o main.wasm</code></pre><ol start="4"><li>åˆ›å»º index.html å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹</li></ol><pre><code class="go">&lt;html&gt;&lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;/&gt;    &lt;script src=&quot;wasm_exec.js&quot;&gt;&lt;/script&gt;    &lt;script&gt;    const go = new Go();    WebAssembly.instantiateStreaming(fetch(&quot;main.wasm&quot;), go.importObject).then((result) =&gt; {        go.run(result.instance);    });    &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><ol start="5"><li>å°† JavaScript æ”¯æŒæ–‡ä»¶ç§»åŠ¨åˆ°æœ¬ç›®å½•</li></ol><pre><code class="bash">cp &quot;$(go env GOROOT)/misc/wasm/wasm_exec.js&quot; .</code></pre><p>ä¸‹è½½ go ç‰ˆçš„ ç®€å• web æœåŠ¡å™¨</p><pre><code class="bash">go get -v -u github.com/shurcooL/goexec</code></pre><p>ç„¶åè¿è¡Œå®ƒ</p><pre><code class="bash">goexec &#39;http.ListenAndServe(`:8080`, http.FileServer(http.Dir(`.`)))&#39;</code></pre><p>ç„¶åæ‰“å¼€ chrome è®¿é—® <code>http://127.0.0.1:8080/</code> å¹¶æŒ‰ä¸‹ F12 æ‰“å¼€ DevTools ä¸å‡ºæ„å¤–çš„è¯ä½ åº”è¯¥ä¼šçœ‹åˆ° æ§åˆ¶å°ä¸Šè¾“å‡º <code>Hello, WebAssembly!</code></p><p>æ¥ä¸‹æ¥å°±æ­£å¼å¼€å§‹äº†ï¼Œåœ¨æ¯æ¬¡æ›´æ”¹ go ä»£ç æ—¶ ä½ éœ€è¦å¯¹ go ä»£ç è¿›è¡Œé‡æ–°ç¼–è¯‘ï¼Œé‡å¯ <code>goexec</code> å¹¶å¯¹ç½‘é¡µè¿›è¡Œåˆ·æ–°ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmf7ft33buj31470mtdjt.jpg" srcset="/img/loading.gif" alt="GoWebAssembly"></p><h2 id="åœ¨jsé‡Œé¢è°ƒç”¨goçš„wasm"><a href="#åœ¨jsé‡Œé¢è°ƒç”¨goçš„wasm" class="headerlink" title="åœ¨jsé‡Œé¢è°ƒç”¨goçš„wasm"></a>åœ¨jsé‡Œé¢è°ƒç”¨goçš„wasm</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç©ä¸€ç‚¹ä¸ä¸€æ ·çš„ï¼Œgo è°ƒç”¨ JavaScript å‡½æ•°å¹¶ä¸”å›æ˜¾åˆ°å‰ç«¯é¡µé¢ï¼Œä¹Ÿå°±æ˜¯åœ¨å‰ç«¯è°ƒç”¨æˆ‘ä»¬ä½¿ç”¨goå†™çš„ä»£ç é€»è¾‘ã€‚</p><ol><li>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>main.go</code>å’Œ<code>index.html</code></li></ol><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2021/1/7 - 4:26 ä¸‹åˆ - UTC/GMT+08:00package mainimport (    &quot;fmt&quot;    &quot;syscall/js&quot;)// é€šè¿‡Goä»£ç æ“ä½œé¡µé¢domèŠ‚ç‚¹var (    document = js.Global().Get(&quot;document&quot;)    nameEle  = document.Call(&quot;getElementById&quot;, &quot;name&quot;)    helloEle = document.Call(&quot;getElementById&quot;, &quot;hello&quot;)    btnEle   = js.Global().Get(&quot;btn&quot;))func sayHello(this js.Value, args []js.Value) interface{} {    name := nameEle.Get(&quot;value&quot;).String()    if len(name) == 0 {        name = &quot;github.com/higker/hello-wasm-go&quot;    }    str := fmt.Sprintf(&quot;Hello,%s&quot;, name)    helloEle.Set(&quot;innerHTML&quot;, js.ValueOf(str))    return nil}func main() {    done := make(chan int, 0)    btnEle.Call(&quot;addEventListener&quot;, &quot;click&quot;, js.FuncOf(sayHello))    &lt;-done}</code></pre><p>ä¸‹é¢æ˜¯index.htmlå†…å®¹</p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;Hello WebAssembly For Golang&lt;/title&gt;&lt;/head&gt;&lt;body style=&quot;text-align: center&quot;&gt;    &lt;p&gt;You Name:&lt;/p&gt;    &lt;input id=&quot;name&quot; type=&quot;text&quot;&gt;    &lt;button id=&quot;btn&quot;&gt;Running&lt;/button&gt;    &lt;h1 id=&quot;hello&quot;&gt;&lt;/h1&gt;&lt;/body&gt;&lt;script src=&quot;wasm_exec.js&quot;&gt;&lt;/script&gt;&lt;script&gt;    const go = new Go();    WebAssembly.instantiateStreaming(fetch(&quot;main.wasm&quot;), go.importObject).then((result) =&gt; {        go.run(result.instance);    });&lt;/script&gt;&lt;/html&gt;</code></pre><ol start="2"><li><p>ç¼–è¯‘ä»£ç  <code>GOOS=js GOARCH=wasm go build -o main.wasm</code></p></li><li><p>å¤åˆ¶ä¾èµ–æ–‡ä»¶<code>cp &quot;$(go env GOROOT)/misc/wasm/wasm_exec.js&quot; .</code></p></li><li><p>å¯åŠ¨é™æ€æœåŠ¡å™¨ </p></li></ol><pre><code class="bash">goexec &#39;http.ListenAndServe(`:8080`, http.FileServer(http.Dir(`.`)))&#39;</code></pre><ol start="5"><li>ä½ ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨æ¥æµè§ˆã€‚</li></ol><h3 id="æ•ˆ-æœğŸ‘"><a href="#æ•ˆ-æœğŸ‘" class="headerlink" title="æ•ˆ æœğŸ‘"></a>æ•ˆ æœğŸ‘</h3><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmghf9sijmj30p80lw419.jpg" srcset="/img/loading.gif" alt="è¿è¡Œæ•ˆæœ"></p><h2 id="ç›¸å…³å‡½æ•°è§£æ"><a href="#ç›¸å…³å‡½æ•°è§£æ" class="headerlink" title="ç›¸å…³å‡½æ•°è§£æ"></a>ç›¸å…³å‡½æ•°è§£æ</h2><ul><li>é€šè¿‡ <code>js.Global().Get(&quot;btn&quot;)</code> æˆ– <code>document.Call(&quot;getElementById&quot;, &quot;hello&quot;)</code>ä¸¤ç§æ–¹å¼è·å–åˆ° DOM å…ƒç´ ã€‚</li><li>btnEle è°ƒç”¨ <code>addEventListener</code> ä¸º btn ç»‘å®šç‚¹å‡»äº‹ä»¶ <code>sayHello</code>ã€‚</li><li>helloEle è°ƒç”¨ <code>Set(&quot;innerHTML&quot;, ...)</code> æ¸²æŸ“è®¡ç®—ç»“æœã€‚</li><li>JavaScriptä»£ç ä¸­<code>WebAssembly.instantiateStreaming(....)</code>æ˜¯åŠ è½½æˆ‘ä»¬goä»£ç ç¼–è¯‘çš„wasmæ–‡ä»¶ï¼Œç„¶åç½‘é¡µå°±å…·å¤‡æˆ‘ä»¬åˆšæ‰ä½¿ç”¨goå†™çš„åŠŸèƒ½äº†ã€‚</li></ul><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmffesitljj30os04iq3e.jpg" srcset="/img/loading.gif" alt="WebAssemblyç”Ÿå‘½å‘¨æœŸ"></p><h2 id="åœ¨goé‡Œé¢è°ƒç”¨å…¶ä»–è¯­è¨€çš„wasm"><a href="#åœ¨goé‡Œé¢è°ƒç”¨å…¶ä»–è¯­è¨€çš„wasm" class="headerlink" title="åœ¨goé‡Œé¢è°ƒç”¨å…¶ä»–è¯­è¨€çš„wasm"></a>åœ¨goé‡Œé¢è°ƒç”¨å…¶ä»–è¯­è¨€çš„wasm</h2><p><strong>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬å†™çš„goä»£ç å¯ä»¥ç¼–è¯‘æˆwasmæ‰”ç»™æµè§ˆå™¨æ‰§è¡Œæˆ‘ä»¬çš„é€»è¾‘ï¼Œåä¹‹æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡goæ¥æ“ä½œå…¶ä»–è¯­è¨€ç¼–è¯‘çš„wasmæ–‡ä»¶ï¼Œå¹¶ä¸”è°ƒç”¨é‡Œé¢çš„å‡½æ•°ã€‚</strong></p><ol><li>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªä¾èµ–åº“</li><li>ç„¶åæˆ‘ä»¬å¼€å¯cgo</li><li>ç„¶åæŠŠæˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªtests.wasmæ–‡ä»¶<pre><code class="bash"># Enable cgo å¯åŠ¨cgoexport CGO_ENABLED=1; export CC=gcc;# æ‹‰å–æˆ‘ä»¬éœ€è¦çš„è§£æåº“github.com/wasmerio/go-ext-wasm</code></pre><blockquote><p>æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼Œå®˜æ–¹é‚£ä¸ªgithubä¸»é¡µæ˜¯è®©ä½ å»ä¸‹è½½<code>go get github.com/wasmerio/wasmer-go</code>ï¼Œå…¶å®ç›®å‰ä¸æ˜¯è¿™ä¸ªäº†ï¼Œæˆ‘æ„Ÿè§‰æ˜¯é‚£ä¸ªè€å¤–æ•…æ„é˜»æŒ¡æˆ‘ä»¬gopherå»å­¦ä¹ wasmçš„æ­¥ä¼ï¼Œæƒ³è®©æˆ‘ä»¬ç›´æ¥å…¥å‘rustï¼Œå•Šå“ˆå“ˆå“ˆï¼Œå¼€ä¸ªç©ç¬‘æ‹‰ï¼Œâœ…æ­£ç¡®æ–¹å¼å»ä¸‹è½½è¿™ä¸ªåŒ…<code>github.com/wasmerio/go-ext-wasm/wasmer</code>ï¼Œä¸è¿‡åœ¨ä½ ä»¬çš„çœ‹åˆ°è¿™ä¸ªæ–‡ç« çš„æ—¶å€™æˆ‘å·²ç»å‘èµ·prè¯·æ±‚å‡†å¤‡ä¿®å¤è¿™ä¸ªå‘ï¼Œå•Šå“ˆå“ˆ</p></blockquote></li></ol><p><em>é¡¹ç›®å®˜æ–¹åœ°å€</em><a href="https://github.com/wasmerio/wasmer-go" target="_blank" rel="noopener">https://github.com/wasmerio/wasmer-go</a></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmgj0b3w5gj30q00egwg9.jpg" srcset="/img/loading.gif" alt="æ“ä½œæ­¥éª¤æˆªå›¾"></p><ol start="4"><li>ç„¶ååœ¨æˆ‘ä»¬çš„<code>main.go</code>æ–‡ä»¶ä¸­å†™å…¥</li></ol><pre><code class="go">package mainimport (    &quot;fmt&quot;    wasm &quot;github.com/wasmerio/go-ext-wasm/wasmer&quot;)func main() {    // å°†WebAssemblyæ¨¡å—è¯»å–ä¸ºå­—èŠ‚    bytes, _ := wasm.ReadBytes(&quot;tests.wasm&quot;)    // å®ä¾‹åŒ–WebAssemblyæ¨¡å—    instance, _ := wasm.NewInstance(bytes)    defer instance.Close()    // ä»WebAssemblyå®ä¾‹è·å–`sum`å¯¼å‡ºçš„å‡½æ•°ã€‚    sum := instance.Exports[&quot;sum&quot;]    // ç”¨Goæ ‡å‡†å€¼è°ƒç”¨å¯¼å‡ºçš„å‡½æ•°ã€‚WebAssembly    // æ¨æ–­ç±»å‹ï¼Œå¹¶è‡ªåŠ¨è½¬æ¢å€¼    result, _ := sum(11, 11)    // ç»“æœ    fmt.Println(result) // 22!}</code></pre><ol start="5"><li>æ‰§è¡Œ<pre><code class="bash">$/Desktop/hello-wasm-go/rand_wasm:$ go run main.go 22</code></pre></li></ol><h2 id="å°-ç»“"><a href="#å°-ç»“" class="headerlink" title="å° ç»“"></a>å° ç»“</h2><p>ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œwasmåº”ç”¨æ¡ˆä¾‹ä¸æ­¢äºæ­¤ï¼Œä¾‹å¦‚å¾ˆå¤šç¬¬ä¸‰æ–¹çš„å‘é€çŸ­ä¿¡çš„APIæ¥å£SDKéƒ½æ˜¯ä¸åŒè¯­è¨€ç‰ˆæœ¬çš„ä»£ç å®ç°ï¼Œå¦‚æœæ¢æˆwasmï¼Œç›´æ¥å†™ä¸€å¥—ä»£ç ç¼–è¯‘æˆwasmï¼Œæä¾›ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä»–è¯­è¨€åŠ è½½è¿™ä¸ªwasmæ–‡ä»¶å°±å¯ä»¥äº†ï¼Œåªéœ€è¦ä¸€ä¸ªwasmè§£å†³äº†â€¦..</p><h3 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h3><ul><li><a href="http://github.com/higker/hello-wasm-go" target="_blank" rel="noopener">http://github.com/higker/hello-wasm-go</a></li><li><a href="https://golang.org/pkg/syscall/js" target="_blank" rel="noopener">https://golang.org/pkg/syscall/js</a></li><li><a href="https://github.com/golang/go/wiki/WebAssembly" target="_blank" rel="noopener">https://github.com/golang/go/wiki/WebAssembly</a></li></ul><h3 id="Javascriptçš„APIæ–‡æ¡£"><a href="#Javascriptçš„APIæ–‡æ¡£" class="headerlink" title="Javascriptçš„APIæ–‡æ¡£"></a>Javascriptçš„APIæ–‡æ¡£</h3><ul><li><a href="https://developer.mozilla.org/zh-cn/docs/web/javascript/reference/global_objects/webassembly/instantiatestreaming" target="_blank" rel="noopener">https://developer.mozilla.org/zh-cn/docs/web/javascript/reference/global_objects/webassembly/instantiatestreaming</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>webassembly</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¨‹åºå‘˜éƒ½åº”è¯¥æ‡‚çš„æ’åºç®—æ³•</title>
    <link href="/2020/11/07/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E5%BA%94%E8%AF%A5%E6%87%82%E7%9A%84%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"/>
    <url>/2020/11/07/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E5%BA%94%E8%AF%A5%E6%87%82%E7%9A%84%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p><strong>ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜åœ¨è°ˆåˆ°<code>ç®—æ³•</code>è¿™ä¸ªè¯çš„æ—¶å€™ï¼Œç¬¬ä¸€ååº”å°±æ˜¯é‚£äº›ä»¤äººå¤´ç–¼çš„LeetCodeé¢˜ç›®ï¼Œé‚£æœ¬ç‰‡æ–‡ç« æˆ‘ä»¬å°±è®²è®²ç¨‹åºå‘˜å‡ ä¸ªåŸºç¡€æ’åºç®—æ³•ã€‚</strong></p><ul><li>å†’æ³¡æ’åº</li><li>é€‰æ‹©æ’åº</li><li>é€‰æ‹©æ’åº</li><li>å¸Œå°”æ’åº</li><li>å¿«é€Ÿæ’åº</li><li>å½’å¹¶æ’åº</li></ul><p><strong>å¤æ‚åº¦å¯¹æ¯”å›¾</strong><br><img src="https://www.runoob.com/wp-content/uploads/2019/03/sort.png" srcset="/img/loading.gif" alt="ç®—æ³•å¤æ‚åº¦"></p><h2 id="1-å†’æ³¡æ’åº"><a href="#1-å†’æ³¡æ’åº" class="headerlink" title="1.å†’æ³¡æ’åº"></a>1.å†’æ³¡æ’åº</h2><ul><li>å¯¹æ— åºæ•°åˆ—è¿›è¡Œå®‰è£…æ¯2ä¸ªç›¸é‚»æ•°ä¸ºä¸€ç»„çš„æ¯”è¾ƒã€‚</li><li>å¦‚æœæ¯ç›¸é‚»çš„2ä¸ªæ•°,å·¦è¾¹æ¯”å³è¾¹å¤§ <code>left &gt; right</code>å°±äº¤æ¢çš„ä½ç½®ã€‚</li><li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚</li><li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚</li></ul><p><strong>åŠ¨å›¾è§£æ</strong><br><img src="https://www.runoob.com/wp-content/uploads/2019/03/bubbleSort.gif" srcset="/img/loading.gif" alt="bubble sort"></p><p><strong>ä»£ç å®ç°</strong></p><pre><code class="go">func Bubble(arr []int) {    for i := 0; i &lt; len(arr); i++ {        // å†’æ³¡æ˜¯æ¯æ¬¡ç›¸é‚»çš„2ä¸ªå…ƒç´ æ’        for j := 0; j &lt; len(arr)-1-i; j++ {            if arr[j] &gt; arr[j+1] {                arr[j], arr[j+1] = arr[j+1], arr[j]            }        }    }}</code></pre><h2 id="2-é€‰æ‹©æ’åº"><a href="#2-é€‰æ‹©æ’åº" class="headerlink" title="2. é€‰æ‹©æ’åº"></a>2. é€‰æ‹©æ’åº</h2><ul><li>é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ã€‚</li><li>å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚</li><li>é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</li></ul><p><strong>åŠ¨å›¾è§£æ</strong><br><img src="https://www.runoob.com/wp-content/uploads/2019/03/selectionSort.gif" srcset="/img/loading.gif" alt="selection sort"></p><p><strong>ä»£ç å®ç°</strong></p><pre><code class="go">// é€‰æ‹©æ’åº O(n^2)func Selection(arr []int) {    // è¿™é‡Œçš„å‡ä¸€æ˜¯å› ä¸ºéœ€è¦é€šè¿‡ä¸‹æ ‡æ–¹æ³•å…ƒç´  å…ƒç´ ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„    // å‡è®¾midæ˜¯æœ€å°å€¼ï¼Œç„¶åå’Œåé¢å…ƒç´ è¿›è¡Œæ¯”è¾ƒ    // å¦‚æœå‘ç°æœ‰æ¯”midå°çš„å…ƒç´ ï¼Œå°±æ›´æ–°midåæ ‡    for i := 0; i &lt; len(arr)-1; i++ {        min := i        for j := i + 1; j &lt; len(arr); j++ {            if arr[min] &gt; arr[j] {                min = j            }        }        // ä¸€è½®ç»“æŸä¹‹åäº¤æ¢2ä¸ªå…ƒç´ ä½ç½®        arr[i], arr[min] = arr[min], arr[i]    }}</code></pre><h2 id="3-æ’å…¥æ’åº"><a href="#3-æ’å…¥æ’åº" class="headerlink" title="3. æ’å…¥æ’åº"></a>3. æ’å…¥æ’åº</h2><ul><li>å°†æ— åºæ•°åˆ—çœ‹æˆä¸€ä¸ªæœ‰åºæ•°åˆ—(èŒƒå›´æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ )å’Œæ— åºæ•°åˆ—(èŒƒå›´å°±æ˜¯ç¬¬äºŒå…ƒç´ åˆ°æœ«å°¾å…ƒç´ )ã€‚</li><li>ç„¶åä»å¤´åˆ°å°¾æ‰«ææ— åºæ•°åˆ—ï¼ŒæŠŠæ‰«æåˆ°çš„å…ƒç´ æ’å…¥åˆ°æœ‰åºæ•°åˆ—çš„é€‚å½“ä½ç½®ã€‚</li><li>å¦‚æœå¾…æ’å…¥çš„å…ƒç´ ä¸æœ‰åºåºåˆ—ä¸­çš„æŸä¸ªå…ƒç´ ç›¸ç­‰ï¼Œåˆ™å°†å¾…æ’å…¥å…ƒç´ æ’å…¥åˆ°ç›¸ç­‰å…ƒç´ çš„åé¢ã€‚</li></ul><p><strong>åŠ¨å›¾è§£æ</strong><br><img src="https://www.runoob.com/wp-content/uploads/2019/03/insertionSort.gif" srcset="/img/loading.gif" alt="insertion sort"></p><p><strong>ä»£ç å®ç°</strong></p><pre><code class="go">func Insertion(numbers []int) {    for i := 1; i &lt; len(numbers); i++ {        pervIndex := i - 1        current := numbers[i]        // ç”¨ä¸Šä¸€ä¸ªå…ƒç´ æ¯”è¾ƒå½“å‰çš„å…ƒç´         for pervIndex &gt;= 0 &amp;&amp; numbers[pervIndex] &gt; current {            numbers[pervIndex+1] = numbers[pervIndex]            // å‘å·¦ç§»åŠ¨æ–¹ä¾¿ä¸‹æ¬¡æ¯”è¾ƒ            pervIndex -= 1        }        // å¦‚æœpervIndexæ²¡æœ‰å˜åŒ–è¯´æ˜å°±ä¸éœ€è¦æ“ä½œ        if pervIndex+1 != i {            numbers[pervIndex+1] = current        }    }}</code></pre><h2 id="4-å¸Œå°”æ’åº"><a href="#4-å¸Œå°”æ’åº" class="headerlink" title="4. å¸Œå°”æ’åº"></a>4. å¸Œå°”æ’åº</h2><ul><li>å¸Œå°”æ’åºå±äºç¼©å°å¢é‡æ’åºã€‚</li><li>å°†æ•°æ®åŒºåˆ†æˆç‰¹å®šé—´éš”çš„å‡ ä¸ªå°åŒºå—ã€‚</li><li>æ¯æ’å®Œä¸€è½®æ•°æ®æ¸è¿›å¼å˜æˆæœ‰åºçš„ã€‚</li><li>ä»¥æ’å…¥æ’åºæ³•æ’å®ŒåŒºå—å†…çš„æ•°æ®åå†æ¸æ¸å‡å°‘é—´éš”çš„è·ç¦»ã€‚</li></ul><p><strong>åŠ¨å›¾è§£æ</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gkh1hyq8a5g30qi0exkc0.gif" srcset="/img/loading.gif" alt="shell sort"></p><p><strong>ä»£ç å®ç°</strong></p><pre><code class="go">// å¸Œå°”æ’åº O(n log n)func Shell(arr []int) {    var pervIndex, current int    // 1.å…ˆæŠŠåŸæ•°æ®å®‰è£…è‡ªå®šä¹‰æ­¥é•¿åˆ†ç»„    for gap := len(arr) / 2; gap &gt; 0; gap /= 2 {        // 2.ç„¶ååˆ†å¥½ç»„çš„æ•°æ®è¿›è¡Œé€‰æ‹©æ’åº        for i := gap; i &lt; len(arr); i++ {            // å¸Œå°”æ’åº            pervIndex = i - gap            current = arr[i]            for pervIndex &gt;= 0 &amp;&amp; arr[pervIndex] &gt; current {                arr[pervIndex+gap] = arr[pervIndex]                pervIndex -= gap            }            if pervIndex+gap != i {                arr[pervIndex+gap] = current            }        }    }}</code></pre><h2 id="5-é€’å½’å‡½æ•°"><a href="#5-é€’å½’å‡½æ•°" class="headerlink" title="5. é€’å½’å‡½æ•°"></a>5. é€’å½’å‡½æ•°</h2><ul><li>é€’å½’å‡½æ•°å°±æ˜¯åœ¨å‡½æ•°é‡Œé¢è°ƒç”¨è‡ªå·±ã€‚</li><li>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªé˜¶ä¹˜ä¾‹å­</li></ul><pre><code class="go">// https://zh.wikipedia.org/wiki/%E9%9A%8E%E4%B9%98func factorial(n int) int {    if n == 1 {        return 1    }    return n * factorial(n-1)}</code></pre><h2 id="6-å½’å¹¶æ’åº"><a href="#6-å½’å¹¶æ’åº" class="headerlink" title="6. å½’å¹¶æ’åº"></a>6. å½’å¹¶æ’åº</h2><ul><li>è¯¥ç®—æ³•æ˜¯é‡‡ç”¨<code>åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰</code>çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚</li><li>å…ˆå°†ä¸€ä¸ªæ— åºæ•°åˆ—è¿›è¡Œåˆ†ç»„ã€‚</li><li>ç„¶åå­ç»„ä¹Ÿè¿›è¡Œåˆ†ç»„ã€‚</li><li>å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸ºäºŒè·¯å½’å¹¶ã€‚</li></ul><p><strong>åŠ¨å›¾è§£æ</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gkj9pvmv9wj31170qlh0x.jpg" srcset="/img/loading.gif" alt="merge sort"></p><p><strong>1.ä»£ç å®ç°</strong></p><pre><code class="java">package me.ibyte.algorithm.sort;import me.ibyte.algorithm.Sort;import java.util.Arrays;// Goå†™å¤šäº†æ¢Javaå†™ä¸€äº› æ€è·¯å’Œé€»è¾‘æ˜¯ä¸€æ ·çš„public class MergeSort implements Sort {    public Integer[] sort(Integer[] arr) {        // å–åˆ°ä¸­è½´ åˆ†ç»„        int middle = arr.length / 2;        if (arr.length &lt; 2) {            return arr;        }        // é€šè¿‡ä¸­è½´åˆ†å·¦å³ç»„        Integer[] left = Arrays.copyOfRange(arr, 0, middle);        Integer[] right = Arrays.copyOfRange(arr, middle, arr.length);        // é‡å¤åˆ†ç»„ ç›´åˆ°ä¸èƒ½åˆ†ç»„ä¸ºæ­¢å¹¶ä¸”è¿›è¡Œå°å—å½’å¹¶æ’åº        return merge(sort(left), sort(right));    }    private Integer[] merge(Integer[] left, Integer[] right) {        // å­˜æ”¾æ’åºå¥½çš„é›¶æ—¶æ•°ç»„        Integer[] result = new Integer[left.length + right.length];        int i = 0;        // ä¸ä¸ºç©ºå°±è¿›è¡Œæ’åº        while (left.length != 0 &amp;&amp; right.length != 0) {            if (left[0] &lt;= right[0]) {                result[i++] = left[0];                // æ’å¥½çš„å°±å‡å»                left = Arrays.copyOfRange(left, 1, left.length);            } else {                result[i++] = right[0];                right = Arrays.copyOfRange(right, 1, right.length);            }        }        // æ£€æµ‹å‰©ä¸‹çš„        while (left.length != 0) {            result[i++] = left[0];            left = Arrays.copyOfRange(left, 1, left.length);        }        while (right.length != 0) {            result[i++] = right[0];            right = Arrays.copyOfRange(right, 1, right.length);        }        return result;    }}</code></pre><p><strong>æºä»£ç æŸ¥çœ‹åœ°å€<a href="https://github.com/higker/java-algorithm/blob/main/src/main/java/me/ibyte/algorithm/sort/MergeSort.java" target="_blank" rel="noopener">æºä»£ç </a></strong></p><p><strong>2.Golangå®ç°å°±æƒ³å°è¯•ä¸€ä¸‹goç‰¹æ€§é«˜é˜¶å‡½æ•°</strong></p><pre><code class="go">func mergeSort(arr []int) []int {    var result []int    if len(arr) &lt; 2 {        return arr    }    middle := len(arr) / 2    // æ³¨æ„è¿™æ˜¯åˆ‡ç‰‡ åˆ‡å–çš„æ—¶å€™æ˜¯åŒ…å·¦ ä¸åŒ…å³    left := arr[:middle]    right := arr[middle:]    return func(left, right []int) []int {        // åˆ†ç»„ä¸èƒ½ä¿è¯å·¦å³å„ç»„æ•°æ®ä¸ªæ•°æ˜¯ä¸€æ ·çš„        for len(left) != 0 &amp;&amp; len(right) != 0 {            if left[0] &lt;= right[0] {                result = append(result, left[0])                left = left[1:]            } else {                result = append(result, right[0])                right = right[1:]            }        }        for len(left) != 0 {            result = append(result, left[0])            // ä¸æ–­å‡å°å‰©ä¸‹çš„            left = left[1:]        }        for len(right) != 0 {            result = append(result, right[0])            right = right[1:]        }        return result    }(mergeSort(left), mergeSort(right))}</code></pre><h2 id="7-å¿«é€Ÿæ’åº"><a href="#7-å¿«é€Ÿæ’åº" class="headerlink" title="7. å¿«é€Ÿæ’åº"></a>7. å¿«é€Ÿæ’åº</h2><ul><li>è¯¥ç®—æ³•æ˜¯é‡‡ç”¨<code>åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰</code>çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚</li><li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºæ¥ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†<code>pivot</code>ã€‚</li><li>é‡æ–°æ’åºæ•°åˆ—,æ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢,æ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢(ç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹)ï¼Œåœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹å,è¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ï¼Œè¿™ä¸ªç§°ä¸ºåˆ†åŒº<code>(partition)</code>æ“ä½œã€‚</li><li>é€’å½’åœ°<code>(recursive)</code>æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚</li></ul><p><strong>è§†é¢‘è§£æ</strong></p><iframe src="//player.bilibili.com/player.html?aid=62621532&bvid=BV1at411T75o&cid=108813206&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:600px;hight:400px" > </iframe><p><strong>ä»£ç å®ç°</strong></p><pre><code class="java">package me.ibyte.algorithm.sort;import me.ibyte.algorithm.Sort;// https://www.bilibili.com/video/BV1at411T75o?zwpublic class QuickSort implements Sort {    @Override    public Integer[] sort(Integer[] arr) {        return quickSort(arr,0,arr.length-1);    }    private  Integer[] quickSort(Integer[] arr, int left, int right) {        if (left &gt;= right) {            return arr;        }        // Lè®°å½•å¼€å§‹ä½ç½® Rè®°å½•å°¾å·´ä½ç½®        int pivot = arr[left],L=left,R=right;        while(left &lt; right){            while (left &lt; right &amp;&amp; arr[right] &gt;= pivot){                right--;            }            arr[left] = arr[right];            while(left &lt; right &amp;&amp; arr[left] &lt;= pivot){                left++;            }            arr[right] = arr[left];        }        arr[left] = pivot;        // L =0 left = æ˜¯ä¸­å¿ƒè½´å€¼çš„ä½ç½® -1 åˆ†å·¦å³ä½œç”¨        quickSort(arr,L,left-1);        quickSort(arr,left+1,R);        return  arr;    }}</code></pre><h2 id="ç®—æ³•å¯¹æ¯”"><a href="#ç®—æ³•å¯¹æ¯”" class="headerlink" title="ç®—æ³•å¯¹æ¯”"></a>ç®—æ³•å¯¹æ¯”</h2><p><strong>æ ¹æ®ä¸ªäººç”µè„‘é…ç½®ä¸åŒè€—æ—¶ä¸åŒï¼ï¼!</strong><br><strong>å¤„ç†å™¨: 2.3 GHz åŒæ ¸Intel Core i5</strong><br><strong>å†… å­˜:8 GB 2133 MHz LPDDR3</strong><br><strong>éšæœºæ•°æ®èŒƒå›´æ˜¯:<code>rand.Intn(99999) - 9999)</code></strong><br><strong>æµ‹è¯•è¿‡ç¨‹ä¸­åŒ…å«äº†éšæœºæ•°ç”Ÿæˆé€»è¾‘ä»£ç ï¼Œæ‰€æœ‰ç®—æ³•é€Ÿåº¦åº”è¯¥å‡å»éšæœºæ•°ç”Ÿæˆè€—æ—¶ï¼ˆå®é™…æ—¶é—´åº”è¯¥æ›´çŸ­ï¼‰ã€‚</strong></p><table><thead><tr><th>ç®—æ³•</th><th>æ•°é‡ç§¯</th><th>æ—¶é—´</th></tr></thead><tbody><tr><td>å†’æ³¡</td><td>10ä¸‡</td><td>14.118 seconds</td></tr><tr><td>é€‰æ‹©</td><td>10ä¸‡</td><td>8.862 seconds</td></tr><tr><td>æ’å…¥</td><td>10ä¸‡</td><td>1.69 seconds</td></tr><tr><td>å¸Œå°”</td><td>10ä¸‡</td><td>0.25 seconds</td></tr><tr><td>å¸Œå°”</td><td>100ä¸‡</td><td>0.509 seconds</td></tr><tr><td>å¸Œå°”</td><td>1000ä¸‡</td><td>3.314 seconds</td></tr><tr><td>å¸Œå°”</td><td>1äº¿</td><td>46s å·¦å³(5æ¬¡é‡å¤æµ‹è¯•ç»“æœ)</td></tr><tr><td>å½’å¹¶</td><td>100ä¸‡</td><td>0.752 seconds</td></tr><tr><td>å¿«é€Ÿ</td><td>100ä¸‡</td><td>0.109 seconds</td></tr></tbody></table><p><strong>æµ‹è¯•æºä»£ç é“¾æ¥<a href="https://github.com/higker/go-algorithm/blob/master/sort.go" target="_blank" rel="noopener">æŸ¥çœ‹æºä»£ç </a>,åˆ«å¿˜äº†<code>star</code>ğŸ˜¯ã€‚</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>sort</tag>
      
      <tag>algorithm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisé‚£äº›äº‹éšç¬”</title>
    <link href="/2020/08/04/Redis%E9%82%A3%E4%BA%9B%E4%BA%8B%E9%9A%8F%E7%AC%94/"/>
    <url>/2020/08/04/Redis%E9%82%A3%E4%BA%9B%E4%BA%8B%E9%9A%8F%E7%AC%94/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghew9a67sqj30jg07bt8y.jpg" srcset="/img/loading.gif" alt=""></p><p><strong><code>Redis</code>ï¼ˆ<code>Remote Dictionary Server</code>)ï¼Œå³<code>è¿œç¨‹å­—å…¸æœåŠ¡</code>ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€<code>Key-Valueæ•°æ®åº“</code>ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚ä»2010å¹´3æœˆ15æ—¥èµ·ï¼ŒRedisçš„å¼€å‘å·¥ä½œç”±VMwareä¸»æŒã€‚ä»2013å¹´5æœˆå¼€å§‹ï¼ŒRedisçš„å¼€å‘ç”±PivotalèµåŠ©ã€‚å®ƒé€šå¸¸è¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯ å­—ç¬¦ä¸²(String), å“ˆå¸Œ(Hash), åˆ—è¡¨(list), é›†åˆ(sets) å’Œ æœ‰åºé›†åˆ(sorted sets)ç­‰ç±»å‹ã€‚</strong></p><blockquote><p>éšç€æ—¶ä»£çš„å‘å±•ï¼Œç°åœ¨ç”¨æˆ·å¯¹åº”ç”¨ç½‘ç»œå“åº”é€Ÿåº¦æœ‰è¾ƒé«˜çš„å“åº”æ—¶é—´è¦æ±‚ï¼Œè€Œä¸”æ•°æ®å’Œç”¨æˆ·é‡å¾ˆå¤šï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼å¾ˆæ»¡è¶³è¿™äº›æ¡ä»¶ã€‚æœåŠ¡å™¨æ¶æ„ä¹Ÿåœ¨ä»å•ä½“åº”ç”¨å˜æˆå¤šå°æœåŠ¡å™¨çš„åˆ†å¸ƒå¼æ¶æ„ï¼Œä»è€Œå‡ºç°äº†ä¸€äº›æ•°æ®åŒæ­¥â€¦.ä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œ<code>redis</code>å°±æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜æ¥å­˜å‚¨æ•°æ®çš„NOSQlæ•°æ®åº“ï¼Œå®ƒæ¯”ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“æ›´å¼ºå¤§é€Ÿåº¦å¾ˆå¿«ã€‚</p></blockquote><h3 id="å…³ç³»å‹æ•°æ®åº“ç†è®º-ACID"><a href="#å…³ç³»å‹æ•°æ®åº“ç†è®º-ACID" class="headerlink" title="å…³ç³»å‹æ•°æ®åº“ç†è®º - ACID"></a>å…³ç³»å‹æ•°æ®åº“ç†è®º - ACID</h3><p>ACIDï¼Œæ˜¯æŒ‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰åœ¨å†™å…¥æˆ–æ›´æ–°èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä¿è¯äº‹åŠ¡ï¼ˆtransactionï¼‰æ˜¯æ­£ç¡®å¯é çš„ï¼Œæ‰€å¿…é¡»å…·å¤‡çš„å››ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆatomicityï¼Œæˆ–ç§°ä¸å¯åˆ†å‰²æ€§ï¼‰ã€ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆisolationï¼Œåˆç§°ç‹¬ç«‹æ€§ï¼‰ã€æŒä¹…æ€§ï¼ˆdurabilityï¼‰ã€‚</p><ul><li><strong>A â€“ Atomicity â€“ åŸå­æ€§</strong></li></ul><p>ä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰è¢«æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</p><ul><li><strong>C â€“ Consistency â€“ ä¸€è‡´æ€§</strong><br>åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚</li><li><strong>I â€“ Isolation â€“ éš”ç¦»æ€§</strong><br>æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</li><li><strong>D â€“ Durability â€“ æŒä¹…æ€§</strong><br>äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ul><p><strong>å…³ç³»å‹æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š</strong></p><p>å®¹æ˜“ç†è§£: äºŒç»´è¡¨ç»“æ„æ˜¯éå¸¸è´´è¿‘é€»è¾‘ä¸–ç•Œä¸€ä¸ªæ¦‚å¿µï¼Œå…³ç³»æ¨¡å‹ç›¸å¯¹ç½‘çŠ¶ã€å±‚æ¬¡ç­‰å…¶ä»–æ¨¡å‹æ¥è¯´æ›´å®¹æ˜“ç†è§£ï¼›<br>ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼ˆäº‹åŠ¡å¤„ç†ï¼‰<br>ç”±äºä»¥æ ‡å‡†åŒ–ä¸ºå‰æï¼Œæ•°æ®æ›´æ–°çš„å¼€é”€å¾ˆå°ï¼ˆç›¸åŒçš„å­—æ®µåŸºæœ¬ä¸Šéƒ½åªæœ‰ä¸€å¤„ï¼‰<br>æ”¯æŒSQLï¼Œå¯ä»¥è¿›è¡ŒJoinç­‰å¤æ‚æŸ¥è¯¢ï¼ˆå‡ å¼ è¡¨ä¹‹é—´ï¼‰</p><p><strong>å…³ç³»å‹æ•°æ®åº“çš„ä¸è¶³ï¼š</strong></p><ul><li><p>ä¸æ“…é•¿çš„å¤„ç†</p></li><li><p>å¤§é‡æ•°æ®çš„å†™å…¥å¤„ç†</p></li><li><p>ä¸ºæœ‰æ•°æ®æ›´æ–°çš„è¡¨åšç´¢å¼•æˆ–è¡¨ç»“æ„ï¼ˆschemaï¼‰å˜æ›´</p></li><li><p>å­—æ®µä¸å›ºå®šæ—¶åº”ç”¨</p></li><li><p>å¯¹ç®€å•æŸ¥è¯¢éœ€è¦å¿«é€Ÿè¿”å›ç»“æœçš„å¤„ç†</p></li></ul><h3 id="éå…³ç³»æ•°æ®åº“"><a href="#éå…³ç³»æ•°æ®åº“" class="headerlink" title="éå…³ç³»æ•°æ®åº“"></a>éå…³ç³»æ•°æ®åº“</h3><p>ç»“æ„ä¸å›ºå®šï¼Œé›†åˆå†…æ•°æ®å­—æ®µå¯ä»¥ä¸ä¸€æ ·ï¼Œè‡ªç”±åº¦é«˜ï¼Œå¯ä»¥å‡å°‘ä¸€äº›æ—¶é—´å’Œç©ºé—´çš„å¼€é”€ã€‚</p><p><strong>å››å¤§ç±»å‹ï¼š</strong></p><ul><li>é”®å€¼å¯¹å­˜å‚¨ï¼ˆkey-valueï¼‰</li><li>æ–‡æ¡£å­˜å‚¨ï¼ˆdocument storeï¼šmongodbï¼‰</li><li>åŸºäºåˆ—çš„æ•°æ®åº“ï¼ˆcolumn-orientedï¼‰ï¼Œè¿˜æœ‰å°±æ˜¯å›¾å½¢æ•°æ®åº“ï¼ˆgraph databaseï¼‰</li></ul><p><strong>ä¸»æµçš„éå…³ç³»å‹æ•°æ®åº“æœ‰ Redisã€MongoDBã€Cloudant</strong></p><p><strong>ç‰¹å¾ï¼š</strong></p><ul><li>1ã€ä½¿ç”¨é”®å€¼å¯¹å­˜å‚¨æ•°æ®ï¼›</li><li>2ã€åˆ†å¸ƒå¼ï¼›</li><li>3ã€ä¸€èˆ¬ä¸æ”¯æŒACIDç‰¹æ€§ï¼›</li><li>4ã€éå…³ç³»å‹æ•°æ®åº“ä¸¥æ ¼ä¸Šä¸æ˜¯ä¸€ç§æ•°æ®åº“ï¼Œåº”è¯¥æ˜¯ä¸€ç§æ•°æ®ç»“æ„åŒ–å­˜å‚¨æ–¹æ³•çš„é›†åˆã€‚</li><li>5ã€Redisæ˜¯å•çº¿ç¨‹åŠ ioå¤šè·¯å¤ç”¨çš„</li></ul><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>1ã€æ— éœ€ç»è¿‡sqlå±‚çš„è§£æï¼Œè¯»å†™æ€§èƒ½å¾ˆé«˜ï¼›</li><li>2ã€åŸºäºé”®å€¼å¯¹ï¼Œæ•°æ®æ²¡æœ‰è€¦åˆæ€§ï¼Œå®¹æ˜“æ‰©å±•ï¼›</li><li>3ã€å­˜å‚¨æ•°æ®çš„æ ¼å¼ï¼šnosqlçš„å­˜å‚¨æ ¼å¼æ˜¯key,valueå½¢å¼ã€æ–‡æ¡£å½¢å¼ã€å›¾ç‰‡å½¢å¼ç­‰ç­‰ï¼Œæ–‡æ¡£å½¢å¼ã€å›¾ç‰‡å½¢å¼ç­‰ç­‰ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“åˆ™åªæ”¯æŒåŸºç¡€ç±»å‹ã€‚</li><li>4ã€ä¸æ”¯æŒACID</li><li>5ã€ä¸æ˜¯æ ‡å‡†çš„SQL</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>1ã€ä¸æä¾›sqlæ”¯æŒï¼Œå­¦ä¹ å’Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ï¼›</li><li>2ã€æ— äº‹åŠ¡å¤„ç†ï¼Œé™„åŠ åŠŸèƒ½biå’ŒæŠ¥è¡¨ç­‰æ”¯æŒä¹Ÿä¸å¥½ï¼›</li></ul><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><ul><li>String: å­—ç¬¦ä¸²</li><li>Hash: æ•£åˆ— (å“ˆå¸Œè¡¨)</li><li>List: åˆ—è¡¨  (é“¾è¡¨)</li><li>Set: é›†åˆ</li><li>ZSet: æœ‰åºä¸é‡å¤é›†åˆ</li><li>è¿˜æœ‰æ–°åŠ çš„é‡Œåœ°ç†ä½ç½®ç­‰ç±»å‹</li></ul><p><strong>Stringå¸¸ç”¨å‘½ä»¤ä¾‹å­:<code>set key value [EX seconds|PX milliseconds] [NX|XX] [KEEPTTL]</code></strong><br>| å‘½ä»¤            | ä½œç”¨                   |<br>| â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”- |<br>| key             | å­˜å‚¨keyåå­—            |<br>| value           | å°±æ˜¯å¯ä»¥å¯¹åº”çš„å­˜å‚¨çš„å€¼ |<br>| EX seconds      | è¶…æ—¶æ—¶é—´ç§’å•ä½         |<br>| PX milliseconds | è¿‡æœŸæ—¶é—´æ¯«ç§’å•ä½       |<br>| NX              | keyä¸å­˜åœ¨æ‰èƒ½æˆåŠŸè®¾ç½®  |<br>| XX              | keyå­˜å‚¨æ‰åšæ›´æ–°        |</p><h3 id="ç‰¹ç‚¹å’Œç¼ºç‚¹"><a href="#ç‰¹ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="ç‰¹ç‚¹å’Œç¼ºç‚¹"></a>ç‰¹ç‚¹å’Œç¼ºç‚¹</h3><ul><li>å†…å­˜å­˜å‚¨ï¼Œè¯»å†™æ“ä½œå¿«</li><li>æ•ˆç‡é«˜ï¼Œå¯ç”¨äºé«˜é€Ÿç¼“å­˜</li><li>å‘å¸ƒè®¢é˜…ç³»ç»Ÿ</li><li>åœ°å›¾ä¿¡æ¯åˆ†æ</li><li>è®¡æ—¶å™¨ï¼Œè®¡æ•°å™¨ï¼ˆæµè§ˆé‡!ï¼‰</li><li>æµé‡é™æµï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ¶ˆå³°</li><li><code>æ–­ç”µå†…å­˜æ•°æ®ä¸¢å¤±ï¼ˆæ‰€æœ‰æŒä¹…åŒ–å¾ˆé‡è¦ï¼‰</code></li><li><code>RDBï¼ŒAOF æŒä¹…åŒ–ç­–ç•¥</code></li></ul><h3 id="å®‰è£…Redis"><a href="#å®‰è£…Redis" class="headerlink" title="å®‰è£…Redis"></a>å®‰è£…Redis</h3><p><strong>1. Linuxè§£å†³å®‰è£…ä¸€äº›ä¾èµ–é—®é¢˜</strong></p><pre><code class="bash">yum groups install Development Tools</code></pre><p><strong>2. ä¸‹è½½è§£å‹ç¼–è¯‘å®‰è£…</strong></p><pre><code class="bash">$ wget http://download.redis.io/releases/redis-5.0.5.tar.gz$ tar xzf redis-5.0.5.tar.gz$ cd redis-5.0.5$ make</code></pre><p>è¿›å…¥åˆ°è§£å‹åçš„ src ç›®å½•ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯åŠ¨Redis:</p><p><code>$ src/redis-server</code></p><p>æ‚¨å¯ä»¥ä½¿ç”¨å†…ç½®çš„å®¢æˆ·ç«¯ä¸Redisè¿›è¡Œäº¤äº’:</p><pre><code class="bash">$ src/redis-cliredis&gt; set foo barOKredis&gt; get foo&quot;bar&quot;</code></pre><p>okå¤§åŠŸå‘Šæˆã€‚</p><h3 id="é…ç½®Redis-confæ–‡ä»¶"><a href="#é…ç½®Redis-confæ–‡ä»¶" class="headerlink" title="é…ç½®Redis.confæ–‡ä»¶"></a>é…ç½®<code>Redis.conf</code>æ–‡ä»¶</h3><p><strong>å¸¸ç”¨çš„å‚æ•°</strong><br><a href="https://www.runoob.com/redis/redis-conf.html" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹å¸¸ç”¨çš„é…ç½®å‚æ•°èµ„æ–™</a></p><h3 id="RedisåŸºæœ¬æµ‹è¯•redis-benchmark"><a href="#RedisåŸºæœ¬æµ‹è¯•redis-benchmark" class="headerlink" title="RedisåŸºæœ¬æµ‹è¯•redis-benchmark"></a><code>Redis</code>åŸºæœ¬æµ‹è¯•<code>redis-benchmark</code></h3><pre><code class="bash">1    -h    æŒ‡å®šæœåŠ¡å™¨ä¸»æœºå    127.0.0.12    -p    æŒ‡å®šæœåŠ¡å™¨ç«¯å£    63793    -s    æŒ‡å®šæœåŠ¡å™¨ socket    4    -c    æŒ‡å®šå¹¶å‘è¿æ¥æ•°    505    -n    æŒ‡å®šè¯·æ±‚æ•°    100006    -d    ä»¥å­—èŠ‚çš„å½¢å¼æŒ‡å®š SET/GET å€¼çš„æ•°æ®å¤§å°    27    -k    1=keep alive 0=reconnect    18    -r    SET/GET/INCR ä½¿ç”¨éšæœº key, SADD ä½¿ç”¨éšæœºå€¼    9    -P    é€šè¿‡ç®¡é“ä¼ è¾“ &lt;numreq&gt; è¯·æ±‚    110    -q    å¼ºåˆ¶é€€å‡º redisã€‚ä»…æ˜¾ç¤º query/sec å€¼    11    --csv    ä»¥ CSV æ ¼å¼è¾“å‡º    12    -l    ç”Ÿæˆå¾ªç¯ï¼Œæ°¸ä¹…æ‰§è¡Œæµ‹è¯•    13    -t    ä»…è¿è¡Œä»¥é€—å·åˆ†éš”çš„æµ‹è¯•å‘½ä»¤åˆ—è¡¨ã€‚    14    -I    Idle æ¨¡å¼ã€‚ä»…æ‰“å¼€ N ä¸ª idle è¿æ¥å¹¶ç­‰å¾…ã€‚    </code></pre><h3 id="æ€§èƒ½æµ‹è¯•å®ä¾‹"><a href="#æ€§èƒ½æµ‹è¯•å®ä¾‹" class="headerlink" title="æ€§èƒ½æµ‹è¯•å®ä¾‹"></a>æ€§èƒ½æµ‹è¯•å®ä¾‹</h3><p><strong>ä»¥ä¸‹å®ä¾‹æˆ‘ä»¬ä½¿ç”¨äº†å¤šä¸ªå‚æ•°æ¥æµ‹è¯• redis æ€§èƒ½ï¼š</strong></p><pre><code class="bash">$ redis-benchmark -h 127.0.0.1 -p 6379 -t set,lpush -n 10000 -qSET: 146198.83 requests per secondLPUSH: 145560.41 requests per second</code></pre><h3 id="RedisæŒä¹…åŒ–ç­–ç•¥"><a href="#RedisæŒä¹…åŒ–ç­–ç•¥" class="headerlink" title="RedisæŒä¹…åŒ–ç­–ç•¥"></a>RedisæŒä¹…åŒ–ç­–ç•¥</h3><ul><li>RDB é€šè¿‡å†…å­˜å¿«ç…§å½¢å¼æŒä¹…åŒ–ï¼ŒæŠŠæ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªdump.rdbæ–‡ä»¶ä¸­ï¼Œä¿å­˜ç­–ç•¥æ˜¯é€šè¿‡å®šæ—¶å¤‡ä»½ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ç­–ç•¥ <code>save second count</code>ç­–ç•¥ï¼Œå¹¶ä¸”åœ¨é€šè¿‡å…³æœºå‘½ä»¤å…³æœºæ—¶ä¹Ÿä¼šè‡ªåŠ¨ä¿å­˜ï¼Œå¯ä»¥å¼€å¯å‹ç¼©æ¨¡å¼ã€‚</li><li>AOF æ˜¯æŠŠåœ¨Redisè¿è¡Œä¸­æ‰€åšå†™æ“ä½œçš„å‘½ä»¤é€šè¿‡æ—¥å¿—çš„å½¢å¼ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå°±æ˜¯å‘½ä»¤é›†åˆã€‚</li></ul><p><strong>RDBçš„ä¼˜ç‚¹ï¼š</strong></p><p>å¯¹æ€§èƒ½å½±å“æœ€å°ã€‚å¦‚å‰æ–‡æ‰€è¿°ï¼ŒRedisåœ¨ä¿å­˜RDBå¿«ç…§æ—¶ä¼šforkå‡ºå­è¿›ç¨‹è¿›è¡Œï¼Œå‡ ä¹ä¸å½±å“Rediså¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„æ•ˆç‡ã€‚æ¯æ¬¡å¿«ç…§ä¼šç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„æ•°æ®å¿«ç…§æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è¾…ä»¥å…¶ä»–æ‰‹æ®µä¿å­˜å¤šä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§ï¼ˆä¾‹å¦‚æŠŠæ¯å¤©0ç‚¹çš„å¿«ç…§å¤‡ä»½è‡³å…¶ä»–å­˜å‚¨åª’ä»‹ä¸­ï¼‰ï¼Œä½œä¸ºéå¸¸å¯é çš„ç¾éš¾æ¢å¤æ‰‹æ®µã€‚ä½¿ç”¨RDBæ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤æ¯”ä½¿ç”¨AOFè¦å¿«å¾ˆå¤šã€‚</p><p><strong>RDBçš„ç¼ºç‚¹ï¼š</strong></p><p>å¿«ç…§æ˜¯å®šæœŸç”Ÿæˆçš„ï¼Œæ‰€ä»¥åœ¨Redis crashæ—¶æˆ–å¤šæˆ–å°‘ä¼šä¸¢å¤±ä¸€éƒ¨åˆ†æ•°æ®ã€‚å¦‚æœæ•°æ®é›†éå¸¸å¤§ä¸”CPUä¸å¤Ÿå¼ºï¼ˆæ¯”å¦‚å•æ ¸CPUï¼‰ï¼ŒRedisåœ¨forkå­è¿›ç¨‹æ—¶å¯èƒ½ä¼šæ¶ˆè€—ç›¸å¯¹è¾ƒé•¿çš„æ—¶é—´ï¼Œå½±å“Rediså¯¹å¤–æä¾›æœåŠ¡çš„èƒ½åŠ›ã€‚</p><p><strong>AOFçš„ä¼˜ç‚¹ï¼š</strong></p><p>æœ€å®‰å…¨ï¼Œåœ¨å¯ç”¨appendfsync alwaysæ—¶ï¼Œä»»ä½•å·²å†™å…¥çš„æ•°æ®éƒ½ä¸ä¼šä¸¢å¤±ï¼Œä½¿ç”¨åœ¨å¯ç”¨appendfsync everysecä¹Ÿè‡³å¤šåªä¼šä¸¢å¤±1ç§’çš„æ•°æ®ã€‚AOFæ–‡ä»¶åœ¨å‘ç”Ÿæ–­ç”µç­‰é—®é¢˜æ—¶ä¹Ÿä¸ä¼šæŸåï¼Œå³ä½¿å‡ºç°äº†æŸæ¡æ—¥å¿—åªå†™å…¥äº†ä¸€åŠçš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨redis-check-aofå·¥å…·è½»æ¾ä¿®å¤ã€‚AOFæ–‡ä»¶æ˜“è¯»ï¼Œå¯ä¿®æ”¹ï¼Œåœ¨è¿›è¡Œäº†æŸäº›é”™è¯¯çš„æ•°æ®æ¸…é™¤æ“ä½œåï¼Œåªè¦AOFæ–‡ä»¶æ²¡æœ‰rewriteï¼Œå°±å¯ä»¥æŠŠAOFæ–‡ä»¶å¤‡ä»½å‡ºæ¥ï¼ŒæŠŠé”™è¯¯çš„å‘½ä»¤åˆ é™¤ï¼Œç„¶åæ¢å¤æ•°æ®ã€‚</p><p><strong>AOFçš„ç¼ºç‚¹ï¼š</strong></p><p>AOFæ–‡ä»¶é€šå¸¸æ¯”RDBæ–‡ä»¶æ›´å¤§æ€§èƒ½æ¶ˆè€—æ¯”RDBé«˜æ•°æ®æ¢å¤é€Ÿåº¦æ¯”RDBæ…¢</p><p>æ•°æ®æŒä¹…åŒ–å¼•å‘çš„å»¶è¿Ÿ</p><p>Redisçš„æ•°æ®æŒä¹…åŒ–å·¥ä½œæœ¬èº«å°±ä¼šå¸¦æ¥å»¶è¿Ÿï¼Œéœ€è¦æ ¹æ®æ•°æ®çš„å®‰å…¨çº§åˆ«å’Œæ€§èƒ½è¦æ±‚åˆ¶å®šåˆç†çš„æŒä¹…åŒ–ç­–ç•¥ï¼š</p><p>AOF + fsync alwaysçš„è®¾ç½®è™½ç„¶èƒ½å¤Ÿç»å¯¹ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œä½†æ¯ä¸ªæ“ä½œéƒ½ä¼šè§¦å‘ä¸€æ¬¡fsyncï¼Œä¼šå¯¹Redisçš„æ€§èƒ½æœ‰æ¯”è¾ƒæ˜æ˜¾çš„å½±å“AOF + fsync every secondæ˜¯æ¯”è¾ƒå¥½çš„æŠ˜ä¸­æ–¹æ¡ˆï¼Œæ¯ç§’fsyncä¸€æ¬¡AOF + fsync neverä¼šæä¾›AOFæŒä¹…åŒ–æ–¹æ¡ˆä¸‹çš„æœ€ä¼˜æ€§èƒ½ä½¿ç”¨RDBæŒä¹…åŒ–é€šå¸¸ä¼šæä¾›æ¯”ä½¿ç”¨AOFæ›´é«˜çš„æ€§èƒ½ï¼Œä½†éœ€è¦æ³¨æ„RDBçš„ç­–ç•¥é…ç½®æ¯ä¸€æ¬¡RDBå¿«ç…§å’ŒAOF Rewriteéƒ½éœ€è¦Redisä¸»è¿›ç¨‹è¿›è¡Œforkæ“ä½œã€‚forkæ“ä½œæœ¬èº«å¯èƒ½ä¼šäº§ç”Ÿè¾ƒé«˜çš„è€—æ—¶ï¼Œä¸CPUå’ŒRediså ç”¨çš„å†…å­˜å¤§å°æœ‰å…³ã€‚æ ¹æ®å…·ä½“çš„æƒ…å†µåˆç†é…ç½®RDBå¿«ç…§å’ŒAOF Rewriteæ—¶æœºï¼Œé¿å…è¿‡äºé¢‘ç¹çš„forkå¸¦æ¥çš„å»¶è¿Ÿ</p><p>Redisåœ¨forkå­è¿›ç¨‹æ—¶éœ€è¦å°†å†…å­˜åˆ†é¡µè¡¨æ‹·è´è‡³å­è¿›ç¨‹ï¼Œä»¥å ç”¨äº†24GBå†…å­˜çš„Rediså®ä¾‹ä¸ºä¾‹ï¼Œå…±éœ€è¦æ‹·è´24GB / 4kB * 8 = 48MBçš„æ•°æ®ã€‚åœ¨ä½¿ç”¨å•Xeon 2.27Ghzçš„ç‰©ç†æœºä¸Šï¼Œè¿™ä¸€forkæ“ä½œè€—æ—¶216msã€‚</p><p>å¯ä»¥é€šè¿‡INFOå‘½ä»¤è¿”å›çš„latest_fork_usecå­—æ®µæŸ¥çœ‹ä¸Šä¸€æ¬¡forkæ“ä½œçš„è€—æ—¶ï¼ˆå¾®ç§’ï¼‰</p><p>ä¸è¿‡å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸‹ï¼Œå»ºè®®è‡³å°‘å¼€å¯RDBæ–¹å¼çš„æ•°æ®æŒä¹…åŒ–ã€‚Redis å¯¹äºæ•°æ®å¤‡ä»½æ˜¯éå¸¸å‹å¥½çš„ï¼Œ å› ä¸ºä½ å¯ä»¥åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å¯¹ RDB æ–‡ä»¶è¿›è¡Œå¤åˆ¶ï¼š RDB æ–‡ä»¶ä¸€æ—¦è¢«åˆ›å»ºï¼Œ å°±ä¸ä¼šè¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚ å½“æœåŠ¡å™¨è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ RDB æ–‡ä»¶æ—¶ï¼Œ å®ƒå…ˆå°†æ–‡ä»¶çš„å†…å®¹ä¿å­˜åœ¨ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶é‡Œé¢ï¼Œ å½“ä¸´æ—¶æ–‡ä»¶å†™å…¥å®Œæ¯•æ—¶ï¼Œ ç¨‹åºæ‰ä½¿ç”¨ rename(2) åŸå­åœ°ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢åŸæ¥çš„ RDB æ–‡ä»¶ã€‚</p><h3 id="Redisåˆ†å¸ƒå¼å‡ ç§æ–¹æ¡ˆ"><a href="#Redisåˆ†å¸ƒå¼å‡ ç§æ–¹æ¡ˆ" class="headerlink" title="Redisåˆ†å¸ƒå¼å‡ ç§æ–¹æ¡ˆ"></a>Redisåˆ†å¸ƒå¼å‡ ç§æ–¹æ¡ˆ</h3><ul><li>ä¸»ä»æ¨¡å¼</li><li>å“¨å…µæ¨¡å¼</li><li>é›†ç¾¤æ¨¡å¼</li></ul><h3 id="å¸¸ç”¨çš„å‘½ä»¤ğŸ““"><a href="#å¸¸ç”¨çš„å‘½ä»¤ğŸ““" class="headerlink" title="å¸¸ç”¨çš„å‘½ä»¤ğŸ““"></a>å¸¸ç”¨çš„å‘½ä»¤ğŸ““</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>SELECT n</code></td><td>é€‰æ‹©æ•°æ®åº“</td></tr><tr><td><code>KEYS *</code></td><td>æŸ¥çœ‹KEYåˆ—è¡¨</td></tr><tr><td><code>DEL KEY</code></td><td>åˆ é™¤æŒ‡å®šKEY</td></tr><tr><td><code>TYPE KEY</code></td><td>æŸ¥çœ‹KEYç±»å‹</td></tr><tr><td><code>EXISTS KEY</code></td><td>æ£€æŸ¥KEYæ˜¯å¦å­˜åœ¨</td></tr><tr><td><code>SET KEY VALUE</code></td><td>è®¾ç½®KEYå’Œå€¼</td></tr><tr><td><code>GET KEY</code></td><td>è·å–KEYçš„å€¼</td></tr><tr><td><code>DBSIZE</code></td><td>æŸ¥çœ‹DBå¤§å°</td></tr><tr><td><code>FLUSHDB</code></td><td>æ¸…ç©ºå½“å‰DB</td></tr><tr><td><code>FLUSHALL</code></td><td>æ¸…ç©ºæ‰€æœ‰DB</td></tr><tr><td><code>FLUSHALL</code></td><td>æ¸…ç©ºæ‰€æœ‰DB</td></tr><tr><td><code>EXPIRE KEY S</code></td><td>è®¾ç½®KEYå¤šä¹…åˆ°æœŸ/ç§’</td></tr><tr><td><code>INCR KEY</code></td><td>KEYå€¼è‡ªåŠ 1</td></tr><tr><td><code>DECR KEY</code></td><td>KEYå€¼è‡ªå‡1</td></tr><tr><td><code>INCRBY KEY 5</code></td><td>è®¾ç½®KEYå€¼è‡ªå¢é‡</td></tr><tr><td><code>GETRANGE KEY 1 5</code></td><td>è·å–KEYæŒ‡å®šåŒºé—´çš„å€¼</td></tr><tr><td><code>STRLEN KEY</code></td><td>è·å–KEYå€¼é•¿åº¦</td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…è°ˆåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</title>
    <link href="/2020/05/27/%E6%B5%85%E8%B0%88%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    <url>/2020/05/27/%E6%B5%85%E8%B0%88%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä»€ä¹ˆæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä»€ä¹ˆæ¶ˆæ¯é˜Ÿåˆ—?"></a>ä»€ä¹ˆæ¶ˆæ¯é˜Ÿåˆ—?</h2><p><code>æ¶ˆæ¯é˜Ÿåˆ—</code>è¿™ä¸ªè¯é™Œç”Ÿäººä¸€å¬æŒ–æ§½å¥½ç‰›é€¼å•Šå¥½é«˜å¤§ä¸Šå•Šï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šç®€ç§°å®ƒä¸º<code>MQ(Message Queue)</code>ï¼Œå—¯ï¼Œå°±æ˜¯å¾ˆç›´ç™½çš„ç®€å†™ã€‚</p><ul><li>é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„</li><li>æ¶ˆæ¯é˜Ÿåˆ—<code>ï¼ˆMessageQueueï¼‰</code>æ˜¯ä¸€ç§åº”ç”¨é—´çš„é€šä¿¡æ–¹å¼</li><li>æ¶ˆæ¯å¯ä»¥éå¸¸ç®€å•ï¼Œæ¯”å¦‚åªåŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ›´å¤æ‚ï¼Œå¯èƒ½åŒ…å«åµŒå…¥å¯¹è±¡</li><li>æ¶ˆæ¯å‘é€è€… å¯ä»¥å‘é€ä¸€ä¸ªæ¶ˆæ¯è€Œæ— é¡»ç­‰å¾…å“åº”ã€‚æ¶ˆæ¯å‘é€è€… å°†æ¶ˆæ¯å‘é€åˆ°ä¸€æ¡ è™šæ‹Ÿçš„é€šé“ï¼ˆä¸»é¢˜ æˆ– é˜Ÿåˆ—ï¼‰ä¸Šï¼Œæ¶ˆæ¯æ¥æ”¶è€… åˆ™ è®¢é˜… æˆ–æ˜¯ ç›‘å¬ è¯¥é€šé“ã€‚ä¸€æ¡ä¿¡æ¯å¯èƒ½æœ€ç»ˆè½¬å‘ç»™ ä¸€ä¸ªæˆ–å¤šä¸ª æ¶ˆæ¯æ¥æ”¶è€…ï¼Œè¿™äº›æ¥æ”¶è€…éƒ½æ— éœ€å¯¹ æ¶ˆæ¯å‘é€è€… åšå‡º åŒæ­¥å›åº”ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯ å¼‚æ­¥çš„ã€‚</li></ul><blockquote><p>ç»´åŸºç™¾ç§‘ä¸Šæ˜¯è¿™ä¹ˆæè¿°çš„: åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æˆ–åŒä¸€è¿›ç¨‹çš„ä¸åŒçº¿ç¨‹é—´çš„é€šä¿¡æ–¹å¼ï¼Œè½¯ä»¶çš„è´®åˆ—ç”¨æ¥å¤„ç†ä¸€ç³»åˆ—çš„è¾“å…¥ï¼Œé€šå¸¸æ˜¯æ¥è‡ªç”¨æˆ·ã€‚æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†å¼‚æ­¥çš„é€šä¿¡åè®®ï¼Œæ¯ä¸€ä¸ªè´®åˆ—ä¸­çš„çºªå½•åŒ…å«è¯¦ç»†è¯´æ˜çš„æ•°æ®ï¼ŒåŒ…å«å‘ç”Ÿçš„æ—¶é—´ï¼Œè¾“å…¥è®¾å¤‡çš„ç§ç±»ï¼Œä»¥åŠç‰¹å®šçš„è¾“å…¥å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šæ¶ˆæ¯çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¸éœ€è¦åŒæ—¶ä¸æ¶ˆæ¯é˜Ÿåˆ—äº¤äº’ã€‚</p></blockquote><p><strong>æˆ‘<code>SDing</code>ä¸ªäººæ€»ç»“å°±æ˜¯: æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„æ•°æ®å­˜å‚¨å®¹å™¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä¸åŒçš„ç¨‹åºä¹‹é—´è¿›è¡Œæ•°æ®çš„é€šè®¯ã€‚</strong></p><h2 id="å‘å¸ƒ-è®¢é˜…"><a href="#å‘å¸ƒ-è®¢é˜…" class="headerlink" title="å‘å¸ƒ/è®¢é˜…"></a>å‘å¸ƒ/è®¢é˜…</h2><p>è¯´åˆ°æ¶ˆæ¯é˜Ÿåˆ—å°±è¦è¯´åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢æœ€å¸¸ç”¨çš„æ–¹å¼å°±æ˜¯å‘å¸ƒå’Œè®¢é˜…äº†ã€‚</p><blockquote><p>ç»´åŸºç™¾ç§‘ä¸Šæ˜¯è¿™ä¹ˆæè¿°çš„: åœ¨è½¯ä»¶æ¶æ„ä¸­ï¼Œå‘å¸ƒ-è®¢é˜…æ˜¯ä¸€ç§æ¶ˆæ¯èŒƒå¼ï¼Œæ¶ˆæ¯çš„å‘é€è€…ä¸ä¼šå°†æ¶ˆæ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„æ¥æ”¶è€…ã€‚è€Œæ˜¯å°†å‘å¸ƒçš„æ¶ˆæ¯åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ï¼Œæ— éœ€äº†è§£å“ªäº›è®¢é˜…è€…å¯èƒ½å­˜åœ¨ã€‚åŒæ ·çš„ï¼Œè®¢é˜…è€…å¯ä»¥è¡¨è¾¾å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªç±»åˆ«çš„å…´è¶£ï¼Œåªæ¥æ”¶æ„Ÿå…´è¶£çš„æ¶ˆæ¯ï¼Œæ— éœ€äº†è§£å“ªäº›å‘å¸ƒè€…å­˜åœ¨ã€‚ å‘å¸ƒ/è®¢é˜…æ˜¯æ¶ˆæ¯é˜Ÿåˆ—èŒƒå¼çš„å…„å¼Ÿï¼Œé€šå¸¸æ˜¯æ›´å¤§çš„é¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚ </p></blockquote><ul><li>æ¶ˆæ¯ç”Ÿäº§è€… ï¼ˆç”Ÿäº§æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œï¼‰</li><li>æ¶ˆæ¯ä¸­é—´ä»¶ <code>(Kafka,Nsq,RabbitMQ)</code></li><li>æ¶ˆæ¯æ¶ˆè´¹è€…  (ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢æ‹¿å–è®¢é˜…çš„æ¶ˆæ¯)</li></ul><p><strong>æˆ‘çš„ä¸€å¥è¯æ€»ç»“å°±æ˜¯: æ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…å°±æ˜¯ä¸€ä¸ªæ¶æ„æ–¹å¼ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ç¨‹åºä¹‹é—´è·å–è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œè§£è€¦æ¨¡å¼ã€‚</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf7dwe18p4j30hj07vaaq.jpg" srcset="/img/loading.gif" alt="æ¶ˆæ¯é˜Ÿåˆ—"></p><p>å¯ä»¥çœ‹çœ‹è¿™ä¸ªå€”é‡‘çš„æ–‡ç« :<a href="https://juejin.im/post/5cb025fb5188251b0351ef48" target="_blank" rel="noopener">æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦</a> or <a href="https://juejin.im/post/5b41fe36e51d45191252e79e" target="_blank" rel="noopener">æ¶ˆæ¯é˜Ÿåˆ—è¯¦è§£</a></p><h2 id="å¸¸è§ä¸­é—´ä»¶"><a href="#å¸¸è§ä¸­é—´ä»¶" class="headerlink" title="å¸¸è§ä¸­é—´ä»¶"></a>å¸¸è§ä¸­é—´ä»¶</h2><ol><li>NSQ</li><li>Kafka</li><li>ZeroMQ</li><li>MetaMQ</li><li>RabbitMQ</li><li>RocketMQ</li><li>ActiveMQ</li><li>Redis (ä¸»è¦æ˜¯ç¼“å­˜ä½†æ˜¯ä¹Ÿå¯ä»¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—)</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Code-Serveræ­å»º</title>
    <link href="/2020/05/26/Code-Server%E6%90%AD%E5%BB%BA/"/>
    <url>/2020/05/26/Code-Server%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf5z665ly1j30dc06o74k.jpg" srcset="/img/loading.gif" alt=""></p><blockquote><p>åœ¨æˆ‘ä»¬å¼€å‘è°ƒè¯•ç¨‹åºçš„æ—¶å€™æˆ‘ä»¬çš„ä¸€äº›ç¨‹åºéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä½†æ˜¯å¾ˆå¤šé…ç½®æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬ä¿®æ”¹èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä½¿ç”¨æˆ‘ä»¬å¯ä»¥é€šè¿‡vscodeæœåŠ¡å™¨ç‰ˆæœ¬è¿›è¡Œå¼€å‘ã€‚</p></blockquote><h2 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h2><p>å®‰è£…å¯ä»¥é€šè¿‡è¿™ä¸ª<code>https://github.com/cdr/code-server</code>ä»“åº“ä¸Šé¢çš„æ–‡ä»¶æ¥ã€‚</p><p><strong>æ ¹æ®è‡ªå·±å¯¹åº”çš„ç³»ç»Ÿç‰ˆæœ¬å®‰è£…</strong></p><h3 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian, Ubuntu"></a>Debian, Ubuntu</h3><pre><code class="shell">curl -sSOL https://github.com/cdr/code-server/releases/download/v3.3.1/code-server_3.3.1_amd64.debsudo dpkg -i code-server_3.3.1_amd64.debsystemctl --user enable --now code-server# Now visit http://127.0.0.1:8080. Your password is in ~/.config/code-server/config.yaml</code></pre><h3 id="Fedora-Red-Hat-SUSE"><a href="#Fedora-Red-Hat-SUSE" class="headerlink" title="Fedora, Red Hat, SUSE"></a>Fedora, Red Hat, SUSE</h3><pre><code class="shell">curl -sSOL https://github.com/cdr/code-server/releases/download/v3.3.1/code-server-3.3.1-amd64.rpmsudo yum install -y code-server-3.3.1-amd64.rpmsystemctl --user enable --now code-server# Now visit http://127.0.0.1:8080. Your password is in ~/.config/code-server/config.yaml</code></pre><h3 id="Arch-Linux"><a href="#Arch-Linux" class="headerlink" title="Arch Linux"></a>Arch Linux</h3><pre><code class="shell"># Installs code-server from the AUR using yay.yay -S code-serversystemctl --user enable --now code-server# Now visit http://127.0.0.1:8080. Your password is in ~/.config/code-server/config.yaml# Installs code-server from the AUR with plain makepkg.git clone https://aur.archlinux.org/code-server.gitcd code-servermakepkg -sisystemctl --user enable --now code-server</code></pre><p>é»˜è®¤è®¿é—®åœ°å€: <code>http://127.0.0.1:8080</code>. é»˜è®¤å¯†ç é…ç½®:<code>~/.config/code-server/config.yaml</code></p><h3 id="Firewall-wall-setting-port"><a href="#Firewall-wall-setting-port" class="headerlink" title="Firewall wall setting port"></a>Firewall wall setting port</h3><p>  <code>â€“permanent</code> æ·»åŠ è¿™ä¸ªå‚æ•°é˜²ç«å¢™æ°¸ä¹…ç”Ÿæ•ˆ. </p><p>  é»˜è®¤ç«¯å£æ˜¯ 8080.</p><pre><code>$: firewall-cmd --zone=public --add-port=8080/tcp --permanent# åˆ·æ–°é…ç½®$: firewall-cmd --reload</code></pre><h3 id="Edit-config-file"><a href="#Edit-config-file" class="headerlink" title="Edit config file"></a>Edit config file</h3><p>  ä½¿ç”¨ <code>vi</code> æ‰“å¼€é…ç½®æ–‡ä»¶<code>~/.config/code-server/config.yaml</code></p><pre><code>$: vi  ~/.config/code-server/config.yaml</code></pre><p>  ä½¿ç”¨é”®ç›˜<code>i</code> é”®è¿›å…¥insertæ¨¡å¼</p><pre><code> bind-addr: 127.0.0.1:8080        auth: password password: 706039b9fa******b847cec0c cert: false ~ ~ -- INSERT --</code></pre><p>   <code>bind-addr</code> ä¿®æ”¹ä¸º <code>0.0.0.0:8080</code> (è¿™æ ·å°±å¯ä»¥è¿œç¨‹è®¿é—®)<br>   <code>password</code> ä¿®æ”¹ä¸ºä½ è‡ªå®šä¹‰å¯†ç </p><p>  æŒ‰é”®ç›˜ä¸Šçš„<code>esc</code> é”®è¾“å…¥<code>: wq</code> ä¿å­˜é€€å‡ºæ–‡ä»¶</p><h3 id="å¯åŠ¨æœåŠ¡å™¨"><a href="#å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨æœåŠ¡å™¨"></a>å¯åŠ¨æœåŠ¡å™¨</h3><pre><code>$: /usr/bin/code-server</code></pre><p>output:</p><pre><code>[root@vultr ~]# /usr/bin/code-serverinfo  Wrote default config file to ~/.config/code-server/config.yamlinfo  Using config file ~/.config/code-server/config.yamlinfo  Using user-data-dir ~/.local/share/code-serverinfo  code-server 3.3.1 6f1309795e1cb930edba68cdc7c3dcaa01da0ab3info  HTTP server listening on http://127.0.0.1:8080info      - Using password from ~/.config/code-server/config.yamlinfo      - To disable use `--auth none`info    - Not serving HTTPS</code></pre><p><strong>ä¸éœ€è¦å¯†ç å¯ä»¥æ·»åŠ  <code>-auth none</code> å‚æ•°</strong></p><p> <strong>or  start by designated user</strong></p><pre><code>$:  systemctl --user enable --now code-server</code></pre><p> <strong>now visit <a href="http://your.server.address:8080" target="_blank" rel="noopener">http://your.server.address:8080</a>. Good luck~</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>vscode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Azureä¸Šå®‰è£…Kafka</title>
    <link href="/2020/05/25/Azure%E4%B8%8A%E5%AE%89%E8%A3%85Kafka/"/>
    <url>/2020/05/25/Azure%E4%B8%8A%E5%AE%89%E8%A3%85Kafka/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf4liai3d3j30k008jt9d.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="ä»€ä¹ˆæ˜¯Kafka"><a href="#ä»€ä¹ˆæ˜¯Kafka" class="headerlink" title="ä»€ä¹ˆæ˜¯Kafka?"></a>ä»€ä¹ˆæ˜¯Kafka?</h2><p>Kafka æ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥å¤„ç†æ¶ˆè´¹è€…åœ¨ç½‘ç«™ä¸­çš„æ‰€æœ‰åŠ¨ä½œæµæ•°æ®ã€‚ è¿™ç§åŠ¨ä½œï¼ˆç½‘é¡µæµè§ˆï¼Œæœç´¢å’Œå…¶ä»–ç”¨æˆ·çš„è¡ŒåŠ¨ï¼‰æ˜¯åœ¨ç°ä»£ç½‘ç»œä¸Šçš„è®¸å¤šç¤¾ä¼šåŠŸèƒ½çš„ä¸€ä¸ªå…³é”®å› ç´ ã€‚ è¿™äº›æ•°æ®é€šå¸¸æ˜¯ç”±äºååé‡çš„è¦æ±‚è€Œé€šè¿‡å¤„ç†æ—¥å¿—å’Œæ—¥å¿—èšåˆæ¥è§£å†³ã€‚<br>å¯¹äºåƒ Hadoop ä¸€æ ·çš„æ—¥å¿—æ•°æ®å’Œç¦»çº¿åˆ†æç³»ç»Ÿï¼Œä½†åˆè¦æ±‚å®æ—¶å¤„ç†çš„é™åˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚Kafka çš„ç›®çš„æ˜¯é€šè¿‡ Hadoop çš„å¹¶è¡ŒåŠ è½½æœºåˆ¶æ¥ç»Ÿä¸€çº¿ä¸Šå’Œç¦»çº¿çš„æ¶ˆæ¯å¤„ç†ï¼Œä¹Ÿæ˜¯ä¸ºäº†é€šè¿‡é›†ç¾¤æ¥æä¾›å®æ—¶çš„æ¶ˆæ¯ã€‚<br>Kafka æ˜¯ç”± Apache è½¯ä»¶åŸºé‡‘ä¼šå¼€å‘çš„ä¸€ä¸ªå¼€æºæµå¤„ç†å¹³å°ï¼Œç”± Scala å’Œ Java ç¼–å†™ã€‚<br>Kafka æœ€åˆæ˜¯ç”±é¢†è‹±å¼€å‘ï¼Œå¹¶éšåäº 2011 å¹´åˆå¼€æºï¼Œå¹¶äº 2012 å¹´ 10 æœˆ 23 æ—¥ç”± Apache Incubator å­µåŒ–å‡ºç«™ã€‚2014 å¹´ 11 æœˆï¼Œå‡ ä¸ªæ›¾åœ¨é¢†è‹±ä¸º Kafka å·¥ä½œçš„å·¥ç¨‹å¸ˆï¼Œåˆ›å»ºäº†åä¸º Confluent çš„æ–°å…¬å¸ï¼Œå¹¶ç€çœ¼äº Kafkaã€‚æ ¹æ® 2014 å¹´ Quora çš„å¸–å­ï¼ŒJay Kreps ä¼¼ä¹å·²ç»å°†å®ƒä»¥ä½œå®¶å¼—æœ—èŒ¨Â·å¡å¤«å¡å‘½åã€‚Kreps é€‰æ‹©å°†è¯¥ç³»ç»Ÿä»¥ä¸€ä¸ªä½œå®¶å‘½åæ˜¯å› ä¸ºï¼Œå®ƒæ˜¯â€œä¸€ä¸ªç”¨äºä¼˜åŒ–å†™ä½œçš„ç³»ç»Ÿâ€ï¼Œè€Œä¸”ä»–å¾ˆå–œæ¬¢å¡å¤«å¡çš„ä½œå“ã€‚</p><p><strong>Kafka å­˜å‚¨çš„æ¶ˆæ¯æ¥è‡ªä»»æ„å¤šè¢«ç§°ä¸ºâ€œç”Ÿäº§è€…â€ï¼ˆProducerï¼‰çš„è¿›ç¨‹ã€‚æ•°æ®ä»è€Œå¯ä»¥è¢«åˆ†é…åˆ°ä¸åŒçš„â€œåˆ†åŒºâ€ï¼ˆPartitionï¼‰ã€ä¸åŒçš„â€œTopicâ€ä¸‹ã€‚åœ¨ä¸€ä¸ªåˆ†åŒºå†…ï¼Œè¿™äº›æ¶ˆæ¯è¢«ç´¢å¼•å¹¶è¿åŒæ—¶é—´æˆ³å­˜å‚¨åœ¨ä¸€èµ·ã€‚å…¶å®ƒè¢«ç§°ä¸ºâ€œæ¶ˆè´¹è€…â€ï¼ˆConsumerï¼‰çš„è¿›ç¨‹å¯ä»¥ä»åˆ†åŒºæŸ¥è¯¢æ¶ˆæ¯ã€‚Kafka è¿è¡Œåœ¨ä¸€ä¸ªç”±ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤ä¸Šï¼Œå¹¶ä¸”åˆ†åŒºå¯ä»¥è·¨é›†ç¾¤ç»“ç‚¹åˆ†å¸ƒã€‚</strong></p><p><strong>Kafka é«˜æ•ˆåœ°å¤„ç†å®æ—¶æµå¼æ•°æ®ï¼Œå¯ä»¥å®ç°ä¸ Stormã€HBase å’Œ Spark çš„é›†æˆã€‚ä½œä¸ºèšç±»éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨ä¸Šï¼ŒKafka å¤„ç†å®ƒæ‰€æœ‰çš„å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿä½¿ç”¨äº†å››ä¸ª APIï¼Œå³ç”Ÿäº§è€… APIã€æ¶ˆè´¹è€… APIã€Stream API å’Œ Connector APIã€‚å®ƒèƒ½å¤Ÿä¼ é€’å¤§è§„æ¨¡æµå¼æ¶ˆæ¯ï¼Œè‡ªå¸¦å®¹é”™åŠŸèƒ½ï¼Œå·²ç»å–ä»£äº†ä¸€äº›ä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿï¼Œå¦‚ JMSã€AMQP ç­‰ã€‚</strong></p><p><strong>Kafka æ¶æ„çš„ä¸»è¦æœ¯è¯­åŒ…æ‹¬ Topicã€Record å’Œ Brokerã€‚Topic ç”± Record ç»„æˆï¼ŒRecord æŒæœ‰ä¸åŒçš„ä¿¡æ¯ï¼Œè€Œ Broker åˆ™è´Ÿè´£å¤åˆ¶æ¶ˆæ¯ã€‚Kafka æœ‰å››ä¸ªä¸»è¦ APIï¼š</strong></p><ul><li>ç”Ÿäº§è€… APIï¼šæ”¯æŒåº”ç”¨ç¨‹åºå‘å¸ƒ Record æµã€‚</li><li>æ¶ˆè´¹è€… APIï¼šæ”¯æŒåº”ç”¨ç¨‹åºè®¢é˜… Topic å’Œå¤„ç† Record æµã€‚</li><li>Stream APIï¼šå°†è¾“å…¥æµè½¬æ¢ä¸ºè¾“å‡ºæµï¼Œå¹¶äº§ç”Ÿç»“æœã€‚</li><li>Connector APIï¼šæ‰§è¡Œå¯é‡ç”¨çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… APIï¼Œå¯å°† Topic é“¾æ¥åˆ°ç°æœ‰åº”ç”¨ç¨‹åºã€‚</li></ul><p><strong>ç›¸å…³æœ¯è¯­</strong></p><ul><li>Topic ç”¨æ¥å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç±»ï¼Œæ¯ä¸ªè¿›å…¥åˆ° Kafka çš„ä¿¡æ¯éƒ½ä¼šè¢«æ”¾åˆ°ä¸€ä¸ª Topic ä¸‹</li><li>Broker ç”¨æ¥å®ç°æ•°æ®å­˜å‚¨çš„ä¸»æœºæœåŠ¡å™¨</li><li>Partition æ¯ä¸ª Topic ä¸­çš„æ¶ˆæ¯ä¼šè¢«åˆ†ä¸ºè‹¥å¹²ä¸ª Partitionï¼Œä»¥æé«˜æ¶ˆæ¯çš„å¤„ç†æ•ˆç‡</li><li>Producer æ¶ˆæ¯çš„ç”Ÿäº§è€…</li><li>Consumer æ¶ˆæ¯çš„æ¶ˆè´¹è€…</li><li>Consumer Group æ¶ˆæ¯çš„æ¶ˆè´¹ç¾¤ç»„</li></ul><p>ç”±äºå…¶å¹¿æ³›é›†æˆåˆ°ä¼ä¸šçº§åŸºç¡€è®¾æ–½ä¸­ï¼Œç›‘æµ‹ Kafka åœ¨è§„æ¨¡è¿è¡Œä¸­çš„æ€§èƒ½æˆä¸ºä¸€ä¸ªæ—¥ç›Šé‡è¦çš„é—®é¢˜ã€‚ç›‘æµ‹ç«¯åˆ°ç«¯æ€§èƒ½ï¼Œè¦æ±‚è·Ÿè¸ªæ‰€æœ‰æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ Brokerã€æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ã€‚é™¤æ­¤ä¹‹å¤–è¿˜è¦ç›‘æµ‹ ZooKeeperï¼ŒKafka ç”¨å®ƒæ¥åè°ƒå„ä¸ªæ¶ˆè´¹è€…ã€‚å½“å‰æœ‰ä¸€äº›ç›‘æµ‹å¹³å°å¯ä»¥è·Ÿè¸ªå¡å¤«å¡çš„æ€§èƒ½ï¼Œæœ‰å¼€æºçš„ï¼Œå¦‚é¢†è‹±çš„ Burrowï¼›ä¹Ÿæœ‰ä»˜è´¹çš„ï¼Œå¦‚ Datadogã€‚é™¤äº†è¿™äº›å¹³å°ä¹‹å¤–ï¼Œæ”¶é›† Kafka çš„æ•°æ®ä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·æ¥è¿›è¡Œï¼Œè¿™äº›å·¥å…·ä¸€èˆ¬éœ€è¦ Javaï¼ŒåŒ…æ‹¬ JConsoleã€‚</p><h2 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h2><p>Kafakaæ˜¯åŸºäºæ˜¯JVMè¿è¡Œçš„ç¨‹åºï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦å…ˆå®‰è£…JDKæˆ–è€…JREã€‚<code>(è¿™é‡Œå°±çœ‹åˆ°äº†æˆ‘ä»¬çš„Golangä¼˜åŠ¿ï¼ï¼ï¼ï¼ç›´æ¥ç¼–è¯‘äºŒè¿›åˆ¶å•Šå“ˆå“ˆå“ˆ~)</code></p><p><strong>éœ€è¦Java 1.7æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥å¦‚ä¸‹å®‰è£…OpenJDK 8</strong></p><pre><code class="shell">sudo yum install -y java-1.13.0-openjdk-devel</code></pre><p><strong>å®‰è£…äº†OpenJDK 8åï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ç»“æœã€‚</strong></p><pre><code class="shell">java -version</code></pre><p><strong>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè¾“å‡ºåº”ä¸æ­¤ç±»ä¼¼ã€‚</strong></p><pre><code class="shelL">openjdk version &quot;1.8.0_252&quot;OpenJDK Runtime Environment (build 1.8.0_252-b09)OpenJDK 64-Bit Server VM (build 25.252-b09, mixed mode)</code></pre><p><strong>æœ€åï¼Œè®¾ç½®JAVA_HOMEç¯å¢ƒå˜é‡ã€‚</strong></p><pre><code class="shell">echo &quot;JAVA_HOME=$(readlink -f /usr/bin/java | sed &quot;s:bin/java::&quot;)&quot; | sudo tee -a /etc/profilesource /etc/profile</code></pre><p><strong>å®‰è£…Kafka</strong></p><pre><code class="shell">wget https://downloads.apache.org/kafka/2.4.1/kafka_2.12-2.4.1.tgz</code></pre><p><strong>è§£å‹åˆ°optç›®å½•</strong></p><pre><code class="SHELL"> tar -xvf kafka_2.12-2.4.1.tgz -C /opt/</code></pre><p>è¿›å…¥Kafkaç›®å½•</p><p><code>cd /opt/kafka_2.11-0.9.0.1</code><br>å¯åŠ¨ZookeeperæœåŠ¡å™¨</p><p><code>bin/zookeeper-server-start.sh -daemon config/zookeeper.properties</code></p><p>ä¿®æ”¹KafkaæœåŠ¡å™¨çš„é…ç½®</p><p> <code>vi bin/kafka-server-start.sh</code></p><p>æ ¹æ®æ‚¨çš„ç‰¹å®šç³»ç»Ÿå‚æ•°è°ƒæ•´å†…å­˜ä½¿ç”¨é‡ã€‚</p><p><code>export KAFKA_HEAP_OPTS=&quot;-Xmx1G -Xms1G&quot;</code></p><p>æ›¿æ¢ä¸ºï¼š</p><p><code>export KAFKA_HEAP_OPTS=&quot;-Xmx256M -Xms128M&quot;</code></p><p>ä¿å­˜é€€å‡ºï¼š</p><p><code>:wq</code></p><p>å¯åŠ¨KafkaæœåŠ¡å™¨</p><p><code>bin/kafka-server-start.sh config/server.properties</code></p><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€äº›æœ‰å…³KafkaæœåŠ¡å™¨çŠ¶æ€çš„æ¶ˆæ¯ï¼Œæœ€åä¸€æ¡å°†æ˜¾ç¤ºï¼š</p><p><code>INFO [Kafka Server 0], started (kafka.server.KafkaServer)</code></p><p>è¿™æ„å‘³ç€æ‚¨å·²ç»å¯åŠ¨äº†KafkaæœåŠ¡å™¨ã€‚</p><p>åœ¨æ–°çš„SSHè¿æ¥ä¸­åˆ›å»ºä¸»é¢˜â€œæµ‹è¯•â€</p><p>æ‰“å¼€ä¸€ä¸ªæ–°çš„SSHè¿æ¥ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸»é¢˜â€œ testâ€ï¼š</p><pre><code class="shell">cd /opt/kafka_2.11-0.9.0.1bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</code></pre><p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ä¸»é¢˜ï¼š</p><pre><code class="shell">bin/kafka-topics.sh --list --zookeeper localhost:2181</code></pre><p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¾“å‡ºå°†æ˜¾ç¤ºä¸ºï¼š</p><pre><code class="shell">test</code></pre><p>ä½¿ç”¨ä¸»é¢˜â€œæµ‹è¯•â€ç”Ÿæˆæ¶ˆæ¯</p><pre><code class="shell">bin/kafka-console-producer.sh --broker-list localhost:9092 </code></pre><p><code>--topic test</code><br>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è¾“å…¥ä»»æ„æ•°é‡çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼š</p><pre><code class="shell">Welcome aboard!Bonjour!</code></pre><p>å¦‚æœæ‚¨æ”¶åˆ°ä¸â€WARN Error while fetching metadata with correlation idâ€è¾“å…¥æ¶ˆæ¯æ—¶ç±»ä¼¼çš„é”™è¯¯ï¼Œåˆ™éœ€è¦server.propertiesä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯æ›´æ–°æ–‡ä»¶ï¼š</p><pre><code class="shell">port = 9092advertised.host.name = localhost </code></pre><p>æ‰“å¼€ç¬¬ä¸‰ä¸ªSSHè¿æ¥ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre><code class="shell">cd /opt/kafka_2.11-0.9.0.1bin/kafka-console-consumer.sh --zookeeper localhost:9092 --topic test --from-beginning</code></pre><ul><li>æ‚¨å…ˆå‰ç”Ÿæˆçš„æ¶ˆæ¯å°†æ˜¾ç¤ºåœ¨ç¬¬ä¸‰ä¸ªSSHè¿æ¥ä¸­ã€‚å½“ç„¶ï¼Œå¦‚æœæ‚¨ç°åœ¨ä»ç¬¬äºŒä¸ªSSHè¿æ¥è¾“å…¥æ›´å¤šæ¶ˆæ¯ï¼Œæ‚¨å°†ç«‹å³åœ¨ç¬¬ä¸‰ä¸ªSSHè¿æ¥ä¸Šçœ‹åˆ°å®ƒä»¬ã€‚</li></ul><p>æœ€åï¼Œæ‚¨å¯ä»¥åœ¨æ¯ä¸ªSSHè¿æ¥ä¸ŠæŒ‰Ctrl + Cç»„åˆé”®ä»¥åœæ­¢è¿™äº›è„šæœ¬ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Centos7</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NSQä¹‹å¼¹å°„èµ·æ­¥</title>
    <link href="/2020/05/19/NSQ%E4%B9%8B%E5%BC%B9%E5%B0%84%E8%B5%B7%E6%AD%A5/"/>
    <url>/2020/05/19/NSQ%E4%B9%8B%E5%BC%B9%E5%B0%84%E8%B5%B7%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gey1a5ssbvj30p00dw77v.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="NSQæ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ"><a href="#NSQæ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ" class="headerlink" title="NSQæ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ"></a><code>NSQ</code>æ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ</h2><p><strong><code>NSQ</code>æ˜¯<code>Go</code>è¯­è¨€ç¼–å†™çš„ä¸€ä¸ªå¼€æºçš„å®æ—¶åˆ†å¸ƒå¼å†…å­˜æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…¶æ€§èƒ½ååˆ†ä¼˜å¼‚ã€‚ NSQçš„ä¼˜åŠ¿æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</strong></p><ul><li><code>NSQ</code>æå€¡åˆ†å¸ƒå¼å’Œåˆ†æ•£çš„æ‹“æ‰‘ï¼Œæ²¡æœ‰å•ç‚¹æ•…éšœï¼Œæ”¯æŒå®¹é”™å’Œé«˜å¯ç”¨æ€§ï¼Œå¹¶æä¾›å¯é çš„æ¶ˆæ¯äº¤ä»˜ä¿è¯</li><li><code>NSQ</code>æ”¯æŒæ¨ªå‘æ‰©å±•ï¼Œæ²¡æœ‰ä»»ä½•é›†ä¸­å¼ä»£ç†ã€‚</li><li><code>NSQ</code>æ˜“äºé…ç½®å’Œéƒ¨ç½²ï¼Œå¹¶ä¸”å†…ç½®äº†ç®¡ç†ç•Œé¢ã€‚</li></ul><h2 id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—?"></a>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—?</h2><p>é€šä¿—åœ°è§£é‡Šä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½ æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼šä½ åˆ°æŠ¥ç¤¾è®¢é˜…äº†ä¸€ä»½æŠ¥çº¸ï¼ŒæŠ¥ç¤¾æ¯æ—¥ç”Ÿäº§ä¸€ä»½æ–°æŠ¥çº¸ï¼Œä¾¿å°†æ–°æŠ¥çº¸å‘å¾€é‚®å±€å¹¶å‘Šè¯‰é‚®å±€ä½ çš„åœ°å€ï¼Œé‚®é€’å‘˜å°†ä½ çš„æŠ¥çº¸é€å¾€ä½ çš„é‚®ç®±ï¼Œä½ ä¾¿å¯ä»¥æ„‰å¿«åœ°é˜…è¯»ä»Šå¤©çš„æ—¶äº‹æ–°é—»äº†ã€‚å½“ç„¶ï¼Œå¯èƒ½ä¸€ä¸ªäººè®¢é˜…äº†å¥½å‡ å®¶æŠ¥ç¤¾ï¼Œä¸€å®¶æŠ¥ç¤¾ä¹Ÿå¯ä»¥è¢«å¤šä¸ªäººè®¢é˜…ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å°±æ‹…ä»»äº†ï¼Œé‚®ç®±ã€é‚®å±€ã€é‚®é€’å‘˜çš„è§’è‰²ã€‚</p><h2 id="æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨ï¼Ÿ"><a href="#æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨ï¼Ÿ"></a>æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨ï¼Ÿ</h2><ul><li>æ˜¯å‡å°‘ç›¸åº”æ‰€éœ€çš„æ—¶é—´å’Œå‰Šå³°</li><li>é™ä½ç³»ç»Ÿè€¦åˆæ€§è§£è€¦æˆ–æå‡ç³»ç»Ÿçš„å¯æ‹“å±•æ€§ï¼‰</li></ul><p><strong>å¦‚å›¾ä¸‹åœºæ™¯:</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gextpsdc8qj313e0u0wja.jpg" srcset="/img/loading.gif" alt="nsq"><br><strong>é€šè¿‡ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å°†ä¸åŒçš„ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼Œé™ä½ç³»ç»Ÿé—´çš„è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„å¥å£®æ€§ã€‚åç»­æœ‰å…¶ä»–ä¸šåŠ¡è¦ä½¿ç”¨è®¢å•æ•°æ®å¯ç›´æ¥è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ã€‚</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gextqm9slzj30wi0jg409.jpg" srcset="/img/loading.gif" alt="nsq"><br><strong>è¿˜å¯ä»¥å¸®å¤§å¹¶å‘åšæµé‡æŠ—å‹å¤„ç†ï¼Œç±»ä¼¼ç§’æ€ï¼ˆå¤§ç§’ï¼‰ç­‰åœºæ™¯ä¸‹ï¼ŒæŸä¸€æ—¶é—´å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„è¯·æ±‚ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿä¸ºåç«¯å¤„ç†è¯·æ±‚æä¾›ä¸€å®šçš„ç¼“å†²åŒºï¼Œä¿è¯åç«¯æœåŠ¡çš„ç¨³å®šæ€§ã€‚</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gextrsvl7uj30xc08uwf9.jpg" srcset="/img/loading.gif" alt="nsq"></p><h2 id="å¼€å§‹NSQå¼¹å°„èµ·æ­¥ğŸš€"><a href="#å¼€å§‹NSQå¼¹å°„èµ·æ­¥ğŸš€" class="headerlink" title="å¼€å§‹NSQå¼¹å°„èµ·æ­¥ğŸš€"></a>å¼€å§‹<code>NSQ</code>å¼¹å°„èµ·æ­¥ğŸš€</h2><p><strong>NSQå·¥ä½œæ¨¡å¼ğŸ‘‡</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gexu2qzvroj31480u0792.jpg" srcset="/img/loading.gif" alt="nsq"></p><p><code>Topic</code>å’Œ<code>Channel</code><br>æ¯ä¸ª<code>nsqd</code>å®ä¾‹æ—¨åœ¨ä¸€æ¬¡å¤„ç†å¤šä¸ªæ•°æ®æµã€‚è¿™äº›æ•°æ®æµç§°ä¸º<code>â€œtopicsâ€</code>ï¼Œä¸€ä¸ª<code>topic</code>å…·æœ‰1ä¸ªæˆ–å¤šä¸ª<code>â€œchannelsâ€</code>ã€‚æ¯ä¸ª<code>channel</code>éƒ½ä¼šæ”¶åˆ°<code>topic</code>æ‰€æœ‰æ¶ˆæ¯çš„å‰¯æœ¬ï¼Œå®é™…ä¸Šä¸‹æ¸¸çš„æœåŠ¡æ˜¯é€šè¿‡å¯¹åº”çš„<code>channel</code>æ¥æ¶ˆè´¹<code>topic</code>æ¶ˆæ¯ã€‚</p><p><code>topic</code>å’Œ<code>channel</code>ä¸æ˜¯é¢„å…ˆé…ç½®çš„ã€‚<code>topic</code>åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºï¼Œæ–¹æ³•æ˜¯å°†å…¶å‘å¸ƒåˆ°æŒ‡å®š<code>topic</code>ï¼Œæˆ–è€…è®¢é˜…æŒ‡å®š<code>topic</code>ä¸Šçš„<code>channel</code>ã€‚<code>channel</code>æ˜¯é€šè¿‡è®¢é˜…æŒ‡å®šçš„<code>channel</code>åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºçš„ã€‚</p><p><code>topic</code>å’Œ<code>channel</code>éƒ½ç›¸äº’ç‹¬ç«‹åœ°ç¼“å†²æ•°æ®ï¼Œé˜²æ­¢ç¼“æ…¢çš„æ¶ˆè´¹è€…å¯¼è‡´å…¶ä»–<code>chennel</code>çš„ç§¯å‹ï¼ˆåŒæ ·é€‚ç”¨äº<code>topic</code>çº§åˆ«ï¼‰ã€‚</p><p><code>channel</code>å¯ä»¥å¹¶ä¸”é€šå¸¸ä¼šè¿æ¥å¤šä¸ªå®¢æˆ·ç«¯ã€‚å‡è®¾æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯éƒ½å¤„äºå‡†å¤‡æ¥æ”¶æ¶ˆæ¯çš„çŠ¶æ€ï¼Œåˆ™æ¯æ¡æ¶ˆæ¯å°†è¢«ä¼ é€’åˆ°éšæœºå®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼š<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gexw4g26pog30bo07tjry.gif" srcset="/img/loading.gif" alt="nsq"><br>æ€»è€Œè¨€ä¹‹ï¼Œæ¶ˆæ¯æ˜¯ä»<code>topic -&gt; channel</code>ï¼ˆæ¯ä¸ª<code>channel</code>æ¥æ”¶è¯¥<code>topic</code>çš„æ‰€æœ‰æ¶ˆæ¯çš„å‰¯æœ¬ï¼‰å¤šæ’­çš„ï¼Œä½†æ˜¯ä»<code>channel -&gt; consumers</code>å‡åŒ€åˆ†å¸ƒï¼ˆæ¯ä¸ªæ¶ˆè´¹è€…æ¥æ”¶è¯¥<code>channel</code>çš„ä¸€éƒ¨åˆ†æ¶ˆæ¯ï¼‰ã€‚<br><strong>NSQæ¥æ”¶å’Œå‘é€æ¶ˆæ¯æµç¨‹</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gexu6v1zghj30fc07paah.jpg" srcset="/img/loading.gif" alt=""><br><strong>NSQç‰¹æ€§</strong><br>æ¶ˆæ¯é»˜è®¤ä¸æŒä¹…åŒ–ï¼Œå¯ä»¥é…ç½®æˆæŒä¹…åŒ–æ¨¡å¼ã€‚nsqé‡‡ç”¨çš„æ–¹å¼æ—¶å†…å­˜+ç¡¬ç›˜çš„æ¨¡å¼ï¼Œå½“å†…å­˜åˆ°è¾¾ä¸€å®šç¨‹åº¦æ—¶å°±ä¼šå°†æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚</p><ul><li>å¦‚æœå°†<code>--mem-queue-size</code>è®¾ç½®ä¸º0ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯å°†ä¼šå­˜å‚¨åˆ°ç£ç›˜ã€‚</li><li>æœåŠ¡å™¨é‡å¯æ—¶ä¹Ÿä¼šå°†å½“æ—¶åœ¨å†…å­˜ä¸­çš„æ¶ˆæ¯æŒä¹…åŒ–ã€‚</li><li>æ¯æ¡æ¶ˆæ¯è‡³å°‘ä¼ é€’ä¸€æ¬¡ã€‚</li><li>æ¶ˆæ¯ä¸ä¿è¯æœ‰åºã€‚</li></ul><h3 id="å¼€å§‹ä½¿ç”¨NSQ"><a href="#å¼€å§‹ä½¿ç”¨NSQ" class="headerlink" title="å¼€å§‹ä½¿ç”¨NSQ"></a>å¼€å§‹ä½¿ç”¨<code>NSQ</code></h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…NSQçš„<code>nsqlookupd</code>ç»„ä»¶ä¹Ÿå°±æ˜¯<code>nsqd</code>ç¨‹åº,æµè§ˆå™¨æ‰“å¼€<a href="https://nsq.io/deployment/installing.html" target="_blank" rel="noopener">å®˜æ–¹ä¸‹è½½é¡µé¢</a>å³å¯å¾—åˆ°ä½ å¯¹åº”æ“ä½œç³»ç»Ÿçš„ç¨‹åºã€‚<br><strong><code>nsqd</code>æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒæ¥æ”¶ã€æ’é˜Ÿå¹¶å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</strong></p><h3 id="nsqlookupdç»„ä»¶"><a href="#nsqlookupdç»„ä»¶" class="headerlink" title="nsqlookupdç»„ä»¶"></a><code>nsqlookupd</code>ç»„ä»¶</h3><p><code>nsqlookupd</code>ç›¸å½“äºé›†ç¾¤çš„ç®¡ç†å‘˜æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆå¯åŠ¨å®ƒ</p><pre><code class="shell">$ nsqlookupd</code></pre><h3 id="nsqdç»„ä»¶"><a href="#nsqdç»„ä»¶" class="headerlink" title="nsqdç»„ä»¶"></a><code>nsqd</code>ç»„ä»¶</h3><p>å¯åŠ¨ <code>nsqd</code>ï¼Œå®ƒç›¸å½“äºé›†ç¾¤ä¸‹çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸»è¦å¹²æ´»çš„</p><pre><code class="shell">$ nsqd --lookupd-tcp-address=127.0.0.1:4160</code></pre><p><strong><code>nsqlookupd</code>æ˜¯ç»´æŠ¤æ‰€æœ‰<code>nsqd</code>çŠ¶æ€ã€æä¾›æœåŠ¡å‘ç°çš„å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒèƒ½ä¸ºæ¶ˆè´¹è€…æŸ¥æ‰¾ç‰¹å®š<code>topic</code>ä¸‹çš„<code>nsqd</code>æä¾›äº†è¿è¡Œæ—¶çš„è‡ªåŠ¨å‘ç°æœåŠ¡ã€‚ å®ƒä¸ç»´æŒæŒä¹…çŠ¶æ€ï¼Œä¹Ÿä¸éœ€è¦ä¸ä»»ä½•å…¶ä»–<code>nsqlookupd</code>å®ä¾‹åè°ƒä»¥æ»¡è¶³æŸ¥è¯¢ã€‚å› æ­¤æ ¹æ®ä½ ç³»ç»Ÿçš„å†—ä½™è¦æ±‚å°½å¯èƒ½å¤šåœ°éƒ¨ç½²<code>nsqlookupd</code>èŠ‚ç‚¹ã€‚å®ƒä»¬æ¶ˆè€—çš„èµ„æºå¾ˆå°‘ï¼Œå¯ä»¥ä¸å…¶ä»–æœåŠ¡å…±å­˜ã€‚æˆ‘ä»¬çš„å»ºè®®æ˜¯ä¸ºæ¯ä¸ªæ•°æ®ä¸­å¿ƒè¿è¡Œè‡³å°‘3ä¸ªé›†ç¾¤ã€‚</strong></p><h3 id="nsqadminç»„ä»¶"><a href="#nsqadminç»„ä»¶" class="headerlink" title="nsqadminç»„ä»¶"></a><code>nsqadmin</code>ç»„ä»¶</h3><p>ä¸€ä¸ªå®æ—¶ç›‘æ§é›†ç¾¤çŠ¶æ€ã€æ‰§è¡Œå„ç§ç®¡ç†ä»»åŠ¡çš„Webç®¡ç†å¹³å°ã€‚ å¯åŠ¨<code>nsqadmin</code>ï¼ŒæŒ‡å®š<code>nsqlookupd</code>åœ°å€:</p><pre><code class="shell"> ./nsqadmin -lookupd-http-address=127.0.0.1:4161</code></pre><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€<code>http://127.0.0.1:4171/</code>è®¿é—®å¦‚ä¸‹ç®¡ç†ç•Œé¢ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gexvk9mzt7j31c00u0b29.jpg" srcset="/img/loading.gif" alt="nsq"></p><h3 id="æµ‹è¯•æ¶ˆæ¯"><a href="#æµ‹è¯•æ¶ˆæ¯" class="headerlink" title="æµ‹è¯•æ¶ˆæ¯"></a>æµ‹è¯•æ¶ˆæ¯</h3><p>å‘é€ä¸€æ¡æ¶ˆæ¯</p><pre><code class="shell">$ curl -d &#39;hello world 1&#39; &#39;http://127.0.0.1:4151/pub?topic=test&#39;</code></pre><p>å³å¯çœ‹åˆ°æ”¶åˆ°äº†æ¶ˆæ¯<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gexvqdbqrrj31740u0k9x.jpg" srcset="/img/loading.gif" alt="nsq"><br>æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜çš„æ–‡ä»¶é‡Œ</p><pre><code class="shell">$ nsq_to_file --topic=test --output-dir=/tmp --lookupd-http-address=127.0.0.1:4161</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gexvtcplxej312i0u07c5.jpg" srcset="/img/loading.gif" alt="nsq"><br>æ–‡ä»¶å†…å®¹<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gexvukbk33j31ja0m614z.jpg" srcset="/img/loading.gif" alt="nsq"></p><p><strong>å¥½äº†å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ä½ å¯ä»¥åˆ°æœ¬åšå®¢çš„å…³äºé¡µé¢æ·»åŠ æˆ‘å¾®ä¿¡æˆ–è€…åœ¨Githubè”ç³»æˆ‘ï¼Œä¸€èµ·æ¨åŠ¨Golangåœ¨ä¸­å›½è¿™ç‰‡åœŸåœ°ç”Ÿæ ¹å‘èŠ½é•¿æˆå¤§æ ‘ï¼ï¼ï¼Good luck!</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>NSQ</tag>
      
      <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gohperæˆé•¿ç§˜ç±</title>
    <link href="/2020/05/17/Gohper%E7%9A%84300%E9%97%AE/"/>
    <url>/2020/05/17/Gohper%E7%9A%84300%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gevv4s06cej30dw04zjs2.jpg" srcset="/img/loading.gif" alt=""></p><blockquote><p>è¿™æ˜¯æˆ‘ä¸ªäºº<code>Denn</code>æ•´ç†çš„ä¸€å¥—Golangå­¦ä¹ ç›®å½•<br> âœ… è¡¨ç¤ºæˆ‘å·²ç»å®Œæˆçš„<br> ğŸ¤·â€â™€ï¸ è¡¨ç¤ºæˆ‘äº†è§£è¿‡æ²¡æœ‰æ·±å…¥<br> åŠ æ²¹å„ä½å°‘å¹´ğŸ»</p></blockquote><h1 id="ç›®å½•æ ‘ğŸŒ²"><a href="#ç›®å½•æ ‘ğŸŒ²" class="headerlink" title="ç›®å½•æ ‘ğŸŒ²"></a>ç›®å½•æ ‘ğŸŒ²</h1><ul><li>å¸¸é‡å’Œå˜é‡çš„å…³ç³» âœ…</li><li>åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹  âœ…</li><li>ç¨‹åºçš„è¿ç®—ç¬¦  âœ…</li><li>ç¨‹åºæ§åˆ¶æµç¨‹  âœ…</li><li>æ•°ç»„çš„ä½¿ç”¨  âœ…</li><li><code>slice</code>ã€<code>map</code>ã€<code>channel</code>çš„ä½¿ç”¨  âœ…</li><li>å‡½æ•°å¼ç¼–ç¨‹  âœ…</li><li>ç»“æ„ä½“å’ŒæŒ‡é’ˆ  âœ…</li><li>é¢å‘æ¥å£ç¼–ç¨‹  âœ…</li><li>åŒ…å’Œç›®å½•çš„æ¦‚å¿µ  âœ…</li><li>åå°„å’Œä¸å®‰å…¨ç¼–ç¨‹ ğŸ¤·â€â™€ï¸</li><li>æµ‹è¯•åŒ…çš„ä½¿ç”¨  âœ…</li><li>å¸¸ç”¨çš„å†…ç½®çš„ä½¿ç”¨  âœ…</li><li><code>Goroutine</code>å’Œ<code>Comtext</code>  âœ…</li><li>ç½‘ç»œç¼–ç¨‹å’Œæ•°æ®åº“ç¼–ç¨‹  âœ…<ul><li><code>Gin</code></li><li><code>Gorm</code></li><li><code>gRPC</code> </li><li><code>Redis</code></li><li><code>Nsq</code></li><li><code>Kafka</code></li><li><code>MongoDB</code></li><li><code>Etcd</code></li><li><code>ElasticSearch</code></li><li><code>......è¿˜æœ‰è·Ÿå¤šéœ€è¦ä¸æ–­åŠªåŠ›ğŸƒâ€â™€ï¸</code></li></ul></li><li>ç®—æ³•å’Œæ•°æ®ç»“æ„è¡¥ä¸€è¡¥</li><li>æ‰¾ä¸€äº›è®¡ç®—æœºç»„æˆå’Œè®¡ç®—æœºåŸºç¡€è§†é¢‘çœ‹çœ‹~</li><li>Good Luckï¼ï¼ï¼</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ€§èƒ½åˆ†æä¹‹PProf</title>
    <link href="/2020/05/16/Go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B9%8BPProf/"/>
    <url>/2020/05/16/Go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B9%8BPProf/</url>
    
    <content type="html"><![CDATA[<h2 id="PProfæ˜¯ä¸ªå•¥ï¼Ÿï¼Ÿï¼Ÿ"><a href="#PProfæ˜¯ä¸ªå•¥ï¼Ÿï¼Ÿï¼Ÿ" class="headerlink" title="PProfæ˜¯ä¸ªå•¥ï¼Ÿï¼Ÿï¼Ÿ"></a>PProfæ˜¯ä¸ªå•¥ï¼Ÿï¼Ÿï¼Ÿ</h2><p><code>pprof</code>æ˜¯ç”¨äºå¯è§†åŒ–å’Œåˆ†ææ€§èƒ½åˆ†ææ•°æ®çš„å·¥å…·,<code>pprof</code>ä»¥ <code>profile.proto</code> è¯»å–åˆ†ææ ·æœ¬çš„é›†åˆï¼Œå¹¶ç”ŸæˆæŠ¥å‘Šä»¥å¯è§†åŒ–å¹¶å¸®åŠ©åˆ†ææ•°æ®ï¼ˆæ”¯æŒæ–‡æœ¬å’Œå›¾å½¢æŠ¥å‘Šï¼‰<br><code>profile.proto</code> æ˜¯ä¸€ä¸ª<code>Protocol Buffer v3</code>çš„æè¿°æ–‡ä»¶ï¼Œå®ƒæè¿°äº†ä¸€ç»„ <code>callstack</code>å’Œ <code>symbolization</code>ä¿¡æ¯ï¼Œ ä½œç”¨æ˜¯è¡¨ç¤ºç»Ÿè®¡åˆ†æçš„ä¸€ç»„é‡‡æ ·çš„è°ƒç”¨æ ˆï¼Œæ˜¯å¾ˆå¸¸è§çš„ <code>stacktrace</code>é…ç½®æ–‡ä»¶æ ¼å¼ã€‚</p><ol><li>æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼<ul><li><code>Report generation</code>ï¼šæŠ¥å‘Šç”Ÿæˆ</li><li><code>Interactive terminal use</code>ï¼šäº¤äº’å¼ç»ˆç«¯ä½¿ç”¨</li><li><code>Web interface</code>ï¼š<code>Web</code> ç•Œé¢</li></ul></li><li>å¯ä»¥åšä»€ä¹ˆ<ul><li><code>CPU Profiling</code>ï¼š<code>CPU</code> åˆ†æï¼ŒæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡é‡‡é›†æ‰€ç›‘å¬çš„åº”ç”¨ç¨‹åº <code>CPU</code>ï¼ˆå«å¯„å­˜å™¨ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ç¡®å®šåº”ç”¨ç¨‹åºåœ¨ä¸»åŠ¨æ¶ˆè€— <code>CPU</code> å‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½®</li><li><code>Memory Profiling</code>ï¼šå†…å­˜åˆ†æï¼Œåœ¨åº”ç”¨ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç”¨äºç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ£€æŸ¥å†…å­˜æ³„æ¼</li><li><code>Block Profiling</code>ï¼šé˜»å¡åˆ†æï¼Œè®°å½• <code>goroutine</code> é˜»å¡ç­‰å¾…åŒæ­¥ï¼ˆåŒ…æ‹¬å®šæ—¶å™¨é€šé“ï¼‰çš„ä½ç½®</li><li><code>Mutex Profiling</code>ï¼šäº’æ–¥é”åˆ†æï¼ŒæŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ</li></ul></li></ol><h2 id="ä¸€ä¸ªä¾‹å­ğŸŒ°"><a href="#ä¸€ä¸ªä¾‹å­ğŸŒ°" class="headerlink" title="ä¸€ä¸ªä¾‹å­ğŸŒ°"></a>ä¸€ä¸ªä¾‹å­ğŸŒ°</h2><p><strong>æƒ³è¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œé¦–å…ˆç©ç›®åœ¨ Go è‡ªèº«æä¾›çš„å·¥å…·é“¾æ¥ä½œä¸ºåˆ†æä¾æ®ï¼Œæœ¬æ–‡å°†å¸¦ä½ å­¦ä¹ ã€ä½¿ç”¨ Go åèŠ±å›­ï¼Œæ¶‰åŠå¦‚ä¸‹ï¼š</strong></p><ul><li><code>runtime/pprof</code>ï¼šé‡‡é›†ç¨‹åºï¼ˆ<code>é Server</code>ï¼‰çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ</li><li><code>net/http/pprof</code>ï¼šé‡‡é›† <code>HTTP Server</code> çš„è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ</li></ul><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2020/5/16 - 12:53 ä¸‹åˆpackage mainimport (    &quot;flag&quot;    &quot;fmt&quot;    &quot;os&quot;    &quot;runtime/pprof&quot;    &quot;time&quot;)// ä¸€æ®µæœ‰é—®é¢˜çš„ä»£ç func logicCode() {    var c chan int    for {        select {        case v := &lt;-c:            fmt.Printf(&quot;recv from chan, value:%v\n&quot;, v)        default:        }    }}func main() {    var isCPUPprof bool    var isMemPprof bool    flag.BoolVar(&amp;isCPUPprof, &quot;cpu&quot;, false, &quot;turn cpu pprof on&quot;)    flag.BoolVar(&amp;isMemPprof, &quot;mem&quot;, false, &quot;turn mem pprof on&quot;)    flag.Parse()    if isCPUPprof {         file, err := os.Create(&quot;./cpu.pprof&quot;)        if err != nil {            fmt.Printf(&quot;create cpu pprof failed, err:%v\n&quot;, err)            return        }        pprof.StartCPUProfile(file)        defer pprof.StopCPUProfile()    }    for i := 0; i &lt; 8; i++ {        go logicCode()    }    time.Sleep(20 * time.Second)    if isMemPprof {        file, err := os.Create(&quot;./mem.pprof&quot;)        if err != nil {            fmt.Printf(&quot;create mem pprof failed, err:%v\n&quot;, err)            return        }        pprof.WriteHeapProfile(file)        file.Close()    }}</code></pre><p><strong>å¯ä»¥çœ‹åˆ°ğŸ‘†ä¸Šé¢çš„é‚£ä¸ª<code>select</code>ä»£ç å—é‡Œé¢çš„channelæ²¡æœ‰åˆå§‹åŒ–ï¼Œä¼šä¸€ç›´é˜»å¡ç€ã€‚è¿™æ ·ä¸€ä¸ªç®€å•çš„ä»£ç å¯ä»¥é€šè¿‡æˆ‘ä»¬è‚‰çœ¼å‡ºæ¥äº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¤æ‚çš„æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨<code>pprof</code>å·¥å…·äº†ã€‚</strong></p><pre><code class="shell">$: go tool pprof cpu.pprof Type: cpuTime: May 16, 2020 at 12:59pm (CST)Duration: 20.14s, Total samples = 56.90s (282.48%)Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)(pprof) top3Showing nodes accounting for 51.91s, 91.23% of 56.90s totalDropped 7 nodes (cum &lt;= 0.28s)Showing top 3 nodes out of 4      flat  flat%   sum%        cum   cum%    23.04s 40.49% 40.49%     45.18s 79.40%  runtime.selectnbrecv    17.26s 30.33% 70.83%     18.93s 33.27%  runtime.chanrecv    11.61s 20.40% 91.23%     56.83s 99.88%  main.logicCode //âè¿™é‡Œå·²ç»é€šè¿‡å·¥å…·åˆ†æå‡ºæ¥äº†ï¼ï¼ï¼</code></pre><p><strong>å·¥å…·å°±å¯ä»¥åˆ†æå‡ºæ¥äº†æˆ‘ä»¬çš„<code>logicCode</code>å‡½æ•°æœ‰é—®é¢˜ï¼</strong></p><pre><code class="shell">$: go tool pprof cpu.pprof Type: cpuTime: May 16, 2020 at 12:59pm (CST)Duration: 20.14s, Total samples = 56.90s (282.48%)Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)(pprof) top3Showing nodes accounting for 51.91s, 91.23% of 56.90s totalDropped 7 nodes (cum &lt;= 0.28s)Showing top 3 nodes out of 4      flat  flat%   sum%        cum   cum%    23.04s 40.49% 40.49%     45.18s 79.40%  runtime.selectnbrecv    17.26s 30.33% 70.83%     18.93s 33.27%  runtime.chanrecv    11.61s 20.40% 91.23%     56.83s 99.88%  main.logicCode(pprof) list logicCodeTotal: 56.90sROUTINE ======================== main.logicCode in /Users/ding/Documents/GO_CODE_DEV/src/Lets_Go/lets_37_pprof/main.go    11.61s     56.83s (flat, cum) 99.88% of Total         .          .     16:// ä¸€æ®µæœ‰é—®é¢˜çš„ä»£ç          .          .     17:func logicCode() {         .          .     18:   var c chan int         .          .     19:   for {         .          .     20:           select {    11.61s     56.83s     21:           case v := &lt;-c:         .          .     22:                   fmt.Printf(&quot;recv from chan, value:%v\n&quot;, v)         .          .     23:           default:         .          .     24:         .          .     25:           }         .          .     26:   }(pprof) </code></pre><p><strong>é€šè¿‡<code>list funcName</code>å°±å¯ä»¥å®šä½åˆ°å“ªè¡Œä»£ç çš„é—®é¢˜äº†ï¼å½“ç„¶<code>PProf</code>å·¥å…·çš„ç”¨é€”å¤šçš„æ˜¯è¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘è¿™ç¯‡åšæ–‡å°±å†™åˆ°è¿™é‡Œï¼Œæœ‰å…´è¶£çš„åé¢å†æ›´æ–°ï¼Œæˆ–è€…å…³æ³¨æˆ‘çš„å…¬ä¼—å·:<code>go_code</code>è°¢è°¢é‡Œé¢æœ‰å¹²è´§å“¦<del>~</del>ğŸ¤©</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>PPorf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Testing of Golang</title>
    <link href="/2020/05/15/Testing-of-Golang/"/>
    <url>/2020/05/15/Testing-of-Golang/</url>
    
    <content type="html"><![CDATA[<h2 id="GoLangçš„å•å…ƒæµ‹è¯•"><a href="#GoLangçš„å•å…ƒæµ‹è¯•" class="headerlink" title="GoLangçš„å•å…ƒæµ‹è¯•"></a>GoLangçš„å•å…ƒæµ‹è¯•</h2><p>åœ¨æˆ‘ä»¬å†™ä»£ç çš„è¿‡ç¨‹ä¸­è¦å…»æˆä¸€ä¸ªå†™æ³¨é‡Šå’Œå†™å•å…ƒæµ‹è¯•çš„ä¹ æƒ¯ï¼Œè¿™æ ·å¯ä»¥æé«˜æˆ‘ä»¬çš„ä»£ç å¥å£®æ€§å’Œå¯è¯»æ€§ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹<code>golang</code>çš„<code>test</code>è¿™ä¸ªå·¥å…·ã€‚</p><h2 id="go-testå‘½ä»¤ä»‹ç»"><a href="#go-testå‘½ä»¤ä»‹ç»" class="headerlink" title="go testå‘½ä»¤ä»‹ç»"></a><code>go test</code>å‘½ä»¤ä»‹ç»</h2><p>Goè¯­è¨€ä¸­çš„æµ‹è¯•ä¾èµ–<code>go test</code>å‘½ä»¤ã€‚ç¼–å†™æµ‹è¯•ä»£ç å’Œç¼–å†™æ™®é€šçš„Goä»£ç è¿‡ç¨‹æ˜¯ç±»ä¼¼çš„ï¼Œå¹¶ä¸éœ€è¦å­¦ä¹ æ–°çš„è¯­æ³•ã€è§„åˆ™æˆ–å·¥å…·ã€‚</p><p><code>go test</code>å‘½ä»¤æ˜¯ä¸€ä¸ªæŒ‰ç…§ä¸€å®šçº¦å®šå’Œç»„ç»‡çš„æµ‹è¯•ä»£ç çš„é©±åŠ¨ç¨‹åºã€‚åœ¨åŒ…ç›®å½•å†…ï¼Œæ‰€æœ‰ä»¥<code>_test.go</code>ä¸ºåç¼€åçš„æºä»£ç æ–‡ä»¶éƒ½æ˜¯<code>go test</code>æµ‹è¯•çš„ä¸€éƒ¨åˆ†ï¼Œä¸ä¼šè¢«<code>go build</code>ç¼–è¯‘åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚</p><p>åœ¨<code>*_test.go</code>æ–‡ä»¶ä¸­æœ‰ä¸‰ç§ç±»å‹çš„å‡½æ•°ï¼Œå•å…ƒæµ‹è¯•å‡½æ•°ã€åŸºå‡†æµ‹è¯•å‡½æ•°å’Œç¤ºä¾‹å‡½æ•°ã€‚</p><table><thead><tr><th>ç±»å‹</th><th>æ ¼å¼</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>æµ‹è¯•å‡½æ•°</td><td>å‡½æ•°åå‰ç¼€ä¸º<code>Test</code></td><td>æµ‹è¯•ç¨‹åºçš„ä¸€äº›é€»è¾‘è¡Œä¸ºæ˜¯å¦æ­£ç¡®</td></tr><tr><td>åŸºå‡†å‡½æ•°</td><td>å‡½æ•°åå‰ç¼€ä¸º<code>Benchmark</code></td><td>æµ‹è¯•å‡½æ•°çš„æ€§èƒ½</td></tr><tr><td>ç¤ºä¾‹å‡½æ•°</td><td>å‡½æ•°åå‰ç¼€ä¸º<code>Example</code></td><td>ä¸ºæ–‡æ¡£æä¾›ç¤ºä¾‹æ–‡æ¡£</td></tr></tbody></table><h2 id="æµ‹è¯•å‡½æ•°"><a href="#æµ‹è¯•å‡½æ•°" class="headerlink" title="æµ‹è¯•å‡½æ•°"></a>æµ‹è¯•å‡½æ•°</h2><blockquote><p>åŸºæœ¬æµ‹è¯•çš„ä¸€äº›æ–¹æ³•è¯´æ˜åœ¨æ–‡æ¡£é‡Œ:<a href="https://studygolang.com/static/pkgdoc/pkg/testing.htm" target="_blank" rel="noopener">https://studygolang.com/static/pkgdoc/pkg/testing.htm</a></p></blockquote><p><strong>æœ¬æµ‹è¯•çš„å‡½æ•°<code>math.go</code></strong></p><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2020/5/15 - 4:16 ä¸‹åˆpackage lets_36_testingfunc init() {    Math := make(map[string]func(n, m int) int, 4)    Math[&quot;add&quot;] = Add    Math[&quot;sub&quot;] = Sub    Math[&quot;multi&quot;] = Multi    Math[&quot;div&quot;] = Div}func Add(n, m int) int {    return n + m}func Sub(n, m int) int {    return n - m}func Multi(n, m int) int {    return n * m}func Div(n, m int) int {    return n / m}</code></pre><p><strong>æµ‹è¯•å‡½æ•°<code>math_test.go</code>éµå¾ªå®˜æ–¹å‘½åè§„èŒƒ</strong></p><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2020/5/15 - 4:21 ä¸‹åˆpackage lets_36_testingimport &quot;testing&quot;func TestMath(t *testing.T) {    // è‡ªå®šä¹‰æµ‹è¯•ç»“æ„ä½“    type MathCase struct {        n, m, result int    }    // è‡ªå®šä¹‰å­æµ‹è¯•map    testGroup := map[string]MathCase{        &quot;add&quot;:   {1, 2, 3},        &quot;sub&quot;:   {3, 1, 2},        &quot;multi&quot;: {3, 2, 6},        &quot;div&quot;:   {6, 2, 3},    }    // æµ‹è¯•æ‰§è¡Œå‡½æ•°    for name, mathCase := range testGroup {        t.Run(name, func(t *testing.T) {            s := -1            switch name {            case &quot;add&quot;:                s = Add(mathCase.n, mathCase.m)            case &quot;sub&quot;:                s = Sub(mathCase.n, mathCase.m)            case &quot;multi&quot;:                s = Multi(mathCase.n, mathCase.m)            case &quot;div&quot;:                s = Div(mathCase.n, mathCase.m)            default:                t.Fatalf(&quot;No executable testing name :%s&quot;, name)            }            if mathCase.result != s {                t.Fatalf(&quot; add computer result errorï¼Œ want %d , got %d&quot;, mathCase.result, s)            }        })    }}</code></pre><p><strong>åœ¨è‡ªå·±çš„terminalè¾“å…¥<code>go test</code>å³å¯çœ‹åˆ°æµ‹è¯•ç»“æœ</strong></p><pre><code class="go">=== RUN   TestMath=== RUN   TestMath/sub=== RUN   TestMath/multi=== RUN   TestMath/div=== RUN   TestMath/add--- PASS: TestMath (0.00s)    --- PASS: TestMath/sub (0.00s)    --- PASS: TestMath/multi (0.00s)    --- PASS: TestMath/div (0.00s)    --- PASS: TestMath/add (0.00s)PASSok      command-line-arguments  0.004s</code></pre><blockquote><p>å¦‚æœæ˜¯å­æµ‹è¯•å¯ä»¥åŠ  <code>-run=funcName/TestCase</code>æ¥è¿›è¡Œå­æµ‹è¯•</p></blockquote><h2 id="æµ‹è¯•è¦†ç›–ç‡"><a href="#æµ‹è¯•è¦†ç›–ç‡" class="headerlink" title="æµ‹è¯•è¦†ç›–ç‡"></a>æµ‹è¯•è¦†ç›–ç‡</h2><p>æµ‹è¯•è¦†ç›–ç‡æ˜¯ä½ çš„ä»£ç è¢«æµ‹è¯•å¥—ä»¶è¦†ç›–çš„ç™¾åˆ†æ¯”ã€‚é€šå¸¸æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯è¯­å¥çš„è¦†ç›–ç‡ï¼Œä¹Ÿå°±æ˜¯åœ¨æµ‹è¯•ä¸­è‡³å°‘è¢«è¿è¡Œä¸€æ¬¡çš„ä»£ç å æ€»ä»£ç çš„æ¯”ä¾‹ã€‚Goæä¾›å†…ç½®åŠŸèƒ½æ¥æ£€æŸ¥ä½ çš„ä»£ç è¦†ç›–ç‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>go test -cover</code>æ¥æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼Œä¾‹å¦‚ï¼š</p><pre><code class="go">$: go test -coverPASScoverage: 100.0% of statementsok      Lets_Go/lets_36_testing 0.004s</code></pre><p><strong>å¯ä»¥çœ‹åˆ°æˆ‘çš„ä»£ç æµ‹è¯•è¦†ç›–ç‡æ˜¯ç™¾åˆ†ä¹‹ç™¾çš„~</strong></p><p>Goè¿˜æä¾›äº†ä¸€ä¸ªé¢å¤–çš„<code>go test -cover -coverprofile</code>å‚æ•°ï¼Œç”¨æ¥å°†è¦†ç›–ç‡ç›¸å…³çš„è®°å½•ä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œ:</p><pre><code class="go">$: go test -cover -coverprofile=testInfo.out[50 50 50 50 50 50]PASScoverage: 100.0% of statementsok      Lets_Go/lets_36_testing 0.005s</code></pre><p><strong>è¿™æ ·æˆ‘ä»¬å°±æŠŠæµ‹è¯•çš„ä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªæŒ‡å®šçš„<code>testInfo.out</code>æ–‡ä»¶é‡Œé¢äº†,ç„¶åæˆ‘ä»¬é€šè¿‡goè¯­è¨€å†…ç½®<code>tool</code>å·¥å…·å°±å¯ä»¥ç”Ÿäº§å¯è§†åŒ–çš„ä»£ç è¦†ç›–ç‡æ£€æŸ¥è§†å›¾äº†ï¼Œä½¿ç”¨å‘½ä»¤<code>go tool cover -html=testInfo.out</code>ä¾‹å¦‚:</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1getd9mki8bj313u0u0dve.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="åŸºå‡†æµ‹è¯•"><a href="#åŸºå‡†æµ‹è¯•" class="headerlink" title="åŸºå‡†æµ‹è¯•"></a>åŸºå‡†æµ‹è¯•</h2><p>åŸºå‡†æµ‹è¯•æ˜¯ç»™ä½ çš„ç¨‹åºåšè¿è¡Œæ€§èƒ½çš„æµ‹è¯•,ä»¥Benchmarkä¸ºå‰ç¼€ï¼Œéœ€è¦ä¸€ä¸ª*testing.Bç±»å‹çš„å‚æ•°bï¼ŒåŸºå‡†æµ‹è¯•å¿…é¡»è¦æ‰§è¡Œb.Næ¬¡ï¼Œè¿™æ ·çš„æµ‹è¯•æ‰æœ‰å¯¹ç…§æ€§ï¼Œb.Nçš„å€¼æ˜¯ç³»ç»Ÿæ ¹æ®å®é™…æƒ…å†µå»è°ƒæ•´çš„ï¼Œä»è€Œä¿è¯æµ‹è¯•çš„ç¨³å®šæ€§ã€‚</p><pre><code class="go">func BenchmarkAdd(b *testing.B) {    for i:=0;i&lt;b.N;i++ {        Add(i, b.N)        //fmt.Println(add)    }}</code></pre><p><strong>å¢åŠ <code>-bench</code>å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ<code>go test -bench=Add</code>å‘½ä»¤æ‰§è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹</strong></p><pre><code class="go">$: go test -bench=Addgoos: darwingoarch: amd64pkg: Lets_Go/lets_36_testingBenchmarkAdd-4          1000000000               0.281 ns/opPASSok      Lets_Go/lets_36_testing 0.320s</code></pre><p><strong>å…¶ä¸­BenchmarkAdd-4è¡¨ç¤ºå¯¹Splitå‡½æ•°è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œæ•°å­—4è¡¨ç¤ºGOMAXPROCSçš„å€¼ï¼Œè¿™ä¸ªå¯¹äºå¹¶å‘åŸºå‡†æµ‹è¯•å¾ˆé‡è¦ã€‚10000000å’Œ203ns/opè¡¨ç¤ºæ¯æ¬¡è°ƒç”¨Addå‡½æ•°è€—æ—¶0.281nsï¼Œè¿™ä¸ªç»“æœæ˜¯10000000æ¬¡è°ƒç”¨çš„å¹³å‡å€¼ã€‚</strong></p><p>è¿˜å¯ä»¥æ·»åŠ <code>-benchmem</code>å‚æ•°æ¥æŸ¥çœ‹è¢«æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ:</p><pre><code class="go">$: go test -bench=Add -benchmemgoos: darwingoarch: amd64pkg: Lets_Go/lets_36_testingBenchmarkAdd-4          1000000000               0.292 ns/op           0 B/op          0 allocs/opPASSok      Lets_Go/lets_36_testing 0.335s</code></pre><p><strong><code>0 B/op</code>è¡¨ç¤ºæ¯æ¬¡æ“ä½œå†…å­˜åˆ†é…äº†<code>0</code>å­—èŠ‚ï¼Œ<code>0 allocs/op</code>åˆ™è¡¨ç¤ºæ¯æ¬¡æ“ä½œè¿›è¡Œäº†<code>0</code>æ¬¡å†…å­˜åˆ†é…,å› ä¸ºæˆ‘å†™çš„å°±æ˜¯ä¸€ä¸ªç®€å•åŠ æ³•å‡½æ•°ğŸ˜</strong></p><blockquote><p>Good luckğŸ˜œ~</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sync.Mutex&amp;RWMutexç¬”è®°</title>
    <link href="/2020/05/12/sync-Mutex-RWMutex%E7%AC%94%E8%AE%B0/"/>
    <url>/2020/05/12/sync-Mutex-RWMutex%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="Go-ä¸­é”çš„ä½¿ç”¨"><a href="#Go-ä¸­é”çš„ä½¿ç”¨" class="headerlink" title="Go ä¸­é”çš„ä½¿ç”¨"></a>Go ä¸­é”çš„ä½¿ç”¨</h2><ol><li>äº’æ–¥é”</li><li>è¯»å†™é”</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepy9opn7vj30ge0gq3yz.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="äº’æ–¥é”"><a href="#äº’æ–¥é”" class="headerlink" title="äº’æ–¥é”"></a>äº’æ–¥é”</h2><p>å¹¶å‘ç¨‹åºå¯¹å…¬å…±èµ„æºè®¿é—®çš„é™åˆ¶æœ€å¸¸è§çš„å°±æ˜¯ä½¿ç”¨äº’æ–¥é”çš„æ–¹å¼ã€‚åœ¨Goä¸­ï¼Œsync.Mutex æä¾›äº†äº’æ–¥é”çš„å®ç°ã€‚</p><p>ç®€å•ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre><code class="go">func main() {var mutex sync.Mutexcount := 0for r := 0; r &lt; 50; r++ {   go func() {           mutex.Lock()           count += 1           mutex.Unlock()       }()   }   time.Sleep(time.Second)   fmt.Println(&quot;the count is : &quot;, count)}</code></pre><p>å½“æ‰§è¡Œäº† <code>mutex.Lock()</code> æ“ä½œåï¼Œå¦‚æœæœ‰å¦å¤–ä¸€ä¸ª <code>goroutine</code> åˆæ‰§è¡Œäº†ä¸Šé”æ“ä½œï¼Œé‚£ä¹ˆè¯¥æ“ä½œè¢«è¢«é˜»å¡ï¼Œç›´åˆ°è¯¥äº’æ–¥é”æ¢å¤åˆ°è§£é”çŠ¶æ€ã€‚</p><h2 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h2><p>é¡¾åæ€ä¹‰ï¼Œè¯»å†™é”æ˜¯å¯¹è¯»å†™æ“ä½œè¿›è¡ŒåŠ é”ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¤šä¸ªè¯»æ“ä½œä¹‹é—´ä¸å­˜åœ¨äº’æ–¥å…³ç³»ï¼Œè¿™æ ·æé«˜äº†å¯¹å…±äº«èµ„æºçš„è®¿é—®æ•ˆç‡ã€‚</p><p>Goä¸­è¯»å†™é”ç”± <code>sync.RWMutex</code>æä¾›ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><p><code>func (rw *RWMutex) Lock()</code></p></li><li><p><code>func (rw *RWMutex) RLock()</code></p></li><li><p><code>func (rw *RWMutex) RLocker() Locker</code></p></li><li><p><code>func (rw *RWMutex) RUnlock()</code></p></li><li><p><code>func (rw *RWMutex) Unlock()</code></p></li></ul><p>å…¶ä¸­ <code>Lock()</code> å³â€œå†™é”å®šâ€ï¼Œè°ƒç”¨äº†â€œå†™é”å®šâ€åï¼Œä¸èƒ½æœ‰å…¶ä»–<code>goroutine</code>è¿›è¡Œè¯»æˆ–è€…å†™æ“ä½œã€‚ <code>Unlock()</code> å³â€œå†™è§£é”â€ï¼Œè°ƒç”¨äº†â€œå†™è§£é”â€åä¼šå”¤é†’æ‰€æœ‰å› ä¸ºè¦è¿›è¡Œâ€œè¯»é”å®šï¼ˆå³:<code>RLock()</code>ï¼‰â€ è€Œè¢«é˜»å¡çš„ <code>goroutine</code>ã€‚</p><p><code>RLock()</code>ä¸ºâ€œè¯»é”å®šâ€ï¼Œè°ƒç”¨â€œè¯»é”å®šâ€åï¼Œä¸èƒ½æœ‰å…¶ä»–<code>goroutine</code>è¿›è¡Œå†™æ“ä½œï¼Œä½†æ˜¯å¯ä»¥è¿›è¡Œè¯»æ“ä½œã€‚<code>RUnlock()</code> ä¸ºâ€œè¯»è§£é”â€ï¼Œè°ƒç”¨â€œè¯»è§£é”â€åï¼Œä¼šå”¤é†’ä¸€ä¸ªå› ä¸ºè¦è¿›è¡Œâ€œå†™é”å®šâ€è€Œè¢«é˜»å¡çš„<code>goroutine</code>ã€‚</p><p>ç®€å•ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre><code class="go">package mainimport (&quot;fmt&quot;&quot;sync&quot;&quot;time&quot;)func main() {    var mutex sync.RWMutex    arr := []int{1, 2, 3}    go func() {       fmt.Println(&quot;Try to lock writing operation.&quot;)       mutex.Lock()       fmt.Println(&quot;Writing operation is locked.&quot;)       arr = append(arr, 4)       fmt.Println(&quot;Try to unlock writing operation.&quot;)       mutex.Unlock()       fmt.Println(&quot;Writing operation is unlocked.&quot;)   }()   go func() {       fmt.Println(&quot;Try to lock reading operation.&quot;)       mutex.RLock()       fmt.Println(&quot;The reading operation is locked.&quot;)       fmt.Println(&quot;The len of arr is : &quot;, len(arr))       fmt.Println(&quot;Try to unlock reading operation.&quot;)       mutex.RUnlock()       fmt.Println(&quot;The reading operation is unlocked.&quot;)   }()   time.Sleep(time.Second * 2)   return}</code></pre><p>è¿è¡Œä»¥ä¸Šç¤ºä¾‹ï¼Œè§‚å¯Ÿè¾“å‡ºç»“æœï¼Œä½ å°†èƒ½å¤Ÿæ¯”è¾ƒç›´è§‚çš„æ„Ÿå—åˆ°è¯»å†™é”çš„ä½œç”¨ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>è¯»å†™é”</tag>
      
      <tag>Mutex</tag>
      
      <tag>RWMutex</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TCPé»åŒ…</title>
    <link href="/2020/05/11/TCP%E9%BB%8F%E5%8C%85/"/>
    <url>/2020/05/11/TCP%E9%BB%8F%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯TCPç²˜åŒ…"><a href="#ä»€ä¹ˆæ˜¯TCPç²˜åŒ…" class="headerlink" title="ä»€ä¹ˆæ˜¯TCPç²˜åŒ…?"></a>ä»€ä¹ˆæ˜¯TCPç²˜åŒ…?</h2><ol><li>é€šå¸¸æˆ‘åœ¨è‡ªå·±å†™ç¨‹åºçš„æ—¶å€™å†™ä¸€ä¸ªåŸºäº<code>tcp</code>åè®®é€šè®¯çš„ç¨‹åºæ—¶å°±ä¼šå‘ç”Ÿè¿™ç§é—®é¢˜ã€‚</li><li>æˆ‘ä»¬åœ¨<code>Client</code>ç«¯å¿«é€Ÿå‘é€æ•°æ®åŒ…å¹¶ä¸”è¿™ä¸ªåŒ…æ•°æ®æ˜¯éšæœº,æ—¶é—´é—´éš”ä¹Ÿå¾ˆçŸ­,ç„¶å<code>tcp</code>çš„<code>Server</code>æ‹¿åˆ°æ•°æ®å°±ä¼šæ˜¯æˆ‘ä»¬ä¹‹å‰<code>Client</code>å‘é€çš„å¤šæ¡æ•°æ®åŒ…åˆåœ¨çš„ä¸€èµ·çš„ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸èƒ½åŒºåˆ†å…·ä½“æ˜¯å“ªä¸ªæ•°æ®åŒ…çš„ã€‚</li><li>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ç§åŸå› å°±æ˜¯å› ä¸º<code>tcp</code>åœ¨ä¼ è¾“çš„æ˜¯<code>å­—èŠ‚æµåè®®</code>ã€‚<blockquote><p>ä¸Šé¢æ˜¯æˆ‘ä¸ªäººè‡ªå­¦ä¹ è¿‡ç¨‹ä¸­æ€»ç»“çš„å¤§å®¶å¯ä»¥çœ‹çœ‹è¿™ä¸ªé“¾æ¥ä¸Šçš„è§£é‡Š:<br><a href="https://www.liwenzhou.com/posts/Go/15_socket/" target="_blank" rel="noopener">https://www.liwenzhou.com/posts/Go/15_socket/</a></p></blockquote></li></ol><h2 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°ç²˜åŒ…"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°ç²˜åŒ…" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°ç²˜åŒ…"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°ç²˜åŒ…</h2><p>ä¸»è¦åŸå› å°±æ˜¯tcpæ•°æ®ä¼ é€’æ¨¡å¼æ˜¯æµæ¨¡å¼ï¼Œåœ¨ä¿æŒé•¿è¿æ¥çš„æ—¶å€™å¯ä»¥è¿›è¡Œå¤šæ¬¡çš„æ”¶å’Œå‘ã€‚</p><p>â€œç²˜åŒ…â€å¯å‘ç”Ÿåœ¨å‘é€ç«¯ä¹Ÿå¯å‘ç”Ÿåœ¨æ¥æ”¶ç«¯ï¼š</p><ul><li>ç”±Nagleç®—æ³•é€ æˆçš„å‘é€ç«¯çš„ç²˜åŒ…ï¼šNagleç®—æ³•æ˜¯ä¸€ç§æ”¹å–„ç½‘ç»œä¼ è¾“æ•ˆç‡çš„ç®—æ³•ã€‚ç®€å•æ¥è¯´å°±æ˜¯å½“æˆ‘ä»¬æäº¤ä¸€æ®µæ•°æ®ç»™TCPå‘é€æ—¶ï¼ŒTCPå¹¶ä¸ç«‹åˆ»å‘é€æ­¤æ®µæ•°æ®ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€å°æ®µæ—¶é—´çœ‹çœ‹åœ¨ç­‰å¾…æœŸé—´æ˜¯å¦è¿˜æœ‰è¦å‘é€çš„æ•°æ®ï¼Œè‹¥æœ‰åˆ™ä¼šä¸€æ¬¡æŠŠè¿™ä¸¤æ®µæ•°æ®å‘é€å‡ºå»ã€‚</li><li>æ¥æ”¶ç«¯æ¥æ”¶ä¸åŠæ—¶é€ æˆçš„æ¥æ”¶ç«¯ç²˜åŒ…ï¼šTCPä¼šæŠŠæ¥æ”¶åˆ°çš„æ•°æ®å­˜åœ¨è‡ªå·±çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åé€šçŸ¥åº”ç”¨å±‚å–æ•°æ®ã€‚å½“åº”ç”¨å±‚ç”±äºæŸäº›åŸå› ä¸èƒ½åŠæ—¶çš„æŠŠTCPçš„æ•°æ®å–å‡ºæ¥ï¼Œå°±ä¼šé€ æˆTCPç¼“å†²åŒºä¸­å­˜æ”¾äº†å‡ æ®µæ•°æ®ã€‚</li></ul><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geosakdma0j30on0brabp.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="é€šè¿‡Goè¯­è¨€å®ç°"><a href="#é€šè¿‡Goè¯­è¨€å®ç°" class="headerlink" title="é€šè¿‡Goè¯­è¨€å®ç°"></a>é€šè¿‡Goè¯­è¨€å®ç°</h2><blockquote><p>server.go</p></blockquote><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2020/5/11 - 7:14 ä¸‹åˆpackage mainimport (    &quot;fmt&quot;    &quot;net&quot;)func main() {    listen, err := net.Listen(&quot;tcp&quot;, &quot;localhost:9598&quot;)    if err != nil {        fmt.Println(&quot;create tcp server fail.&quot;,err)        return    }    var msg [1024]byte    for{        accept, err := listen.Accept()        if err != nil {            fmt.Println(&quot;tcp accept fail&quot;,err)            return        }        n , _ := accept.Read(msg[:])        fmt.Println(string(msg[:n]))    }}</code></pre><blockquote><p>client.go</p></blockquote><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2020/5/11 - 7:58 ä¸‹åˆpackage mainimport (    &quot;fmt&quot;    &quot;net&quot;    &quot;time&quot;)func main() {    dial, err := net.Dial(&quot;tcp&quot;, &quot;localhost:9598&quot;)    if err != nil {        fmt.Println(&quot;connection tcp server fail.&quot;,err)    }    for i:=0;i&lt;10;i++ {        dial.Write([]byte(&quot;Hello&quot; + time.Now().Format(&quot;2006-01-02 15:04:05.0000&quot;)))    }}</code></pre><blockquote><p>OutPut</p></blockquote><pre><code> ~/Documents/GO_CODE_DEV/src/Lets_Go/lets_33_tcp_é»åŒ…  master âœš  â†µ 1 î‚° go run server.goHello2020-05-11 20:16:13.5448Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449Hello2020-05-11 20:16:13.5449</code></pre><p><strong>å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ•°æ®åŒ…éƒ½è¢«é»åœ¨ä¸€èµ·äº†ï¼ï¼ï¼ï¼è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„tcpé»åŒ…ã€‚</strong></p><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><blockquote><p>å‡ºç°é»åŒ…çš„åŸå› æ˜¯å› ä¸ºæœåŠ¡å™¨ç«¯æˆ–è€…æ¶ˆæ¯æ¥å—è€…ä¸çŸ¥é“æˆ‘ä»¬æ¯æ¬¡å‘é€çš„æ•°æ®åŒ…å¤§å°ï¼ï¼æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ•°æ®åŒ…æ ¼å¼æ¥è§£å†³ã€‚å°±åƒæˆ‘ä»¬å‡ºå»çº¦åˆ«äººåƒé¥­ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä¿©å…ˆå•†é‡å¥½å»å“ªé‡Œåœ°æ–¹å‡ ç‚¹â€¦..(ä¾‹å­æœ‰ç‚¹æŠ½è±¡ä¸å¥½ç†è§£å•Šå“ˆå“ˆå“ˆ)</p></blockquote><blockquote><p>protocol.go</p></blockquote><pre><code class="go">package mainimport (    &quot;bufio&quot;    &quot;bytes&quot;    &quot;encoding/binary&quot;)// Encode å°†æ¶ˆæ¯ç¼–ç func Encode(message string) ([]byte, error) {    // è¯»å–æ¶ˆæ¯çš„é•¿åº¦ï¼Œè½¬æ¢æˆint32ç±»å‹ï¼ˆå 4ä¸ªå­—èŠ‚ï¼‰    var length = int32(len(message))    // åˆ›å»ºç¼“å†²åŒº    var pkg = new(bytes.Buffer)    // å†™å…¥æ¶ˆæ¯å¤´ â€œå°ç«¯æ–¹å¼å†™å…¥å­˜å‚¨â€è¿™é‡Œæˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šçœ‹åˆ«äººå†™çš„ä¾‹å­,ç”¨å°±å®Œäº‹äº†    err := binary.Write(pkg, binary.LittleEndian, length)    if err != nil {        return nil, err    }    // åœ¨åŒ…å¤´åé¢ è¿½åŠ  å†™å…¥æ¶ˆæ¯å®ä½“    err = binary.Write(pkg, binary.LittleEndian, []byte(message))    if err != nil {        return nil, err    }    return pkg.Bytes(), nil}// Decode è§£ç æ¶ˆæ¯func Decode(reader *bufio.Reader) (string, error) {    // è¯»å–æ¶ˆæ¯çš„é•¿åº¦    lengthByte, _ := reader.Peek(4) // è¯»å–å‰4ä¸ªå­—èŠ‚çš„æ•°æ®    lengthBuff := bytes.NewBuffer(lengthByte)    var length int32    err := binary.Read(lengthBuff, binary.LittleEndian, &amp;length)    if err != nil {        return &quot;&quot;, err    }    // Bufferedè¿”å›ç¼“å†²ä¸­ç°æœ‰çš„å¯è¯»å–çš„å­—èŠ‚æ•°ã€‚    if int32(reader.Buffered()) &lt; length+4 {        return &quot;&quot;, err    }    // è¯»å–çœŸæ­£çš„æ¶ˆæ¯æ•°æ®    pack := make([]byte, int(4+length))    _, err = reader.Read(pack)    if err != nil {        return &quot;&quot;, err    }    return string(pack[4:]), nil}</code></pre><p><strong>æ¥ä¸‹æ¥åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„Decodeå’ŒEncodeå‡½æ•°å¤„ç†æ•°æ®ã€‚ä¸‹é¢æœ‰æˆ‘çš„æºä»£ç ä»“åº“,Good Luck~ğŸ˜œ</strong><br><strong><a href="https://github.com/higker/Lets_Go/tree/master/lets_33_tcp_%E9%BB%8F%E5%8C%85" target="_blank" rel="noopener">https://github.com/higker/Lets_Go/tree/master/lets_33_tcp_%E9%BB%8F%E5%8C%85</a></strong></p><h2 id="é™„åŠ çŸ¥è¯†ç‚¹"><a href="#é™„åŠ çŸ¥è¯†ç‚¹" class="headerlink" title="é™„åŠ çŸ¥è¯†ç‚¹"></a>é™„åŠ çŸ¥è¯†ç‚¹</h2><blockquote><p>ä¸ºä»€ä¹ˆudpä¸ä¼šç²˜åŒ…?<br><a href="https://zhuanlan.zhihu.com/p/41709589?utm_source=wechat_session" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/41709589?utm_source=wechat_session</a></p></blockquote><p>1.TCPåè®®æ˜¯é¢å‘æµçš„åè®®ï¼ŒUDPæ˜¯é¢å‘æ¶ˆæ¯çš„åè®®</p><p>UDPæ®µéƒ½æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ä»¥æ¶ˆæ¯ä¸ºå•ä½æå–æ•°æ®ï¼Œä¸èƒ½ä¸€æ¬¡æå–ä»»æ„å­—èŠ‚çš„æ•°æ®</p><p>UDPå…·æœ‰ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œï¼Œåœ¨æ¯ä¸ªUDPåŒ…ä¸­å°±æœ‰äº†æ¶ˆæ¯å¤´ï¼ˆæ¶ˆæ¯æ¥æºåœ°å€ï¼Œç«¯å£ç­‰ä¿¡æ¯ï¼‰ï¼Œè¿™æ ·å¯¹äºæ¥æ”¶ç«¯æ¥è¯´å°±å®¹æ˜“è¿›è¡ŒåŒºåˆ†å¤„ç†äº†ã€‚ä¼ è¾“åè®®æŠŠæ•°æ®å½“ä½œä¸€æ¡ç‹¬ç«‹çš„æ¶ˆæ¯åœ¨ç½‘ä¸Šä¼ è¾“ï¼Œæ¥æ”¶ç«¯åªèƒ½æ¥æ”¶ç‹¬ç«‹çš„æ¶ˆæ¯ã€‚æ¥æ”¶ç«¯ä¸€æ¬¡åªèƒ½æ¥æ”¶å‘é€ç«¯å‘å‡ºçš„ä¸€ä¸ªæ•°æ®åŒ…,å¦‚æœä¸€æ¬¡æ¥å—æ•°æ®çš„å¤§å°å°äºå‘é€ç«¯ä¸€æ¬¡å‘é€çš„æ•°æ®å¤§å°ï¼Œå°±ä¼šä¸¢å¤±ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå³ä½¿ä¸¢å¤±ï¼Œæ¥å—ç«¯ä¹Ÿä¸ä¼šåˆ†ä¸¤æ¬¡å»æ¥æ”¶</p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>tcp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è°ˆè°ˆå¹¶å‘å’Œå¹¶è¡Œ</title>
    <link href="/2020/05/08/%E8%B0%88%E8%B0%88%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C/"/>
    <url>/2020/05/08/%E8%B0%88%E8%B0%88%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ</h2><p> å°±æ˜¯åœ¨ä¸€æ®µæ—¶é—´é‡Œæ¥å›åˆ‡æ¢åšå¤šä¸ªäº‹æƒ…ï¼Œå°±åƒä¸€ä¸ªå¿«é€’å‘˜åœ¨ä¸€åˆ†é’Ÿå†…é€å®Œæˆ‘çš„å¿«é€’åˆç»§ç»­å»é€çš„å¿«é€’ï¼Œå¹²æ´»çš„å°±åªè¦ä¸€ä¸ªå¿«é€’å‘˜(è¿™ä¸ªä¾‹å­æœ‰ç‚¹ä¸å¥½è¿˜æ˜¯çœ‹ä¸‹é¢å›¾ç‰‡å§)ã€‚<code>å¹¶å‘(concurrency)</code>ï¼šæŒ‡åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œï¼Œä½†å¤šä¸ªè¿›ç¨‹æŒ‡ä»¤è¢«å¿«é€Ÿçš„è½®æ¢æ‰§è¡Œï¼Œä½¿å¾—åœ¨å®è§‚ä¸Šå…·æœ‰å¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œçš„æ•ˆæœï¼Œä½†åœ¨å¾®è§‚ä¸Šå¹¶ä¸æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œåªæ˜¯æŠŠæ—¶é—´åˆ†æˆè‹¥å¹²æ®µï¼Œä½¿å¤šä¸ªè¿›ç¨‹å¿«é€Ÿäº¤æ›¿çš„æ‰§è¡Œã€‚<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gelclh44mgj308704j74e.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="ä»€ä¹ˆå¹¶è¡Œï¼Ÿ"><a href="#ä»€ä¹ˆå¹¶è¡Œï¼Ÿ" class="headerlink" title="ä»€ä¹ˆå¹¶è¡Œï¼Ÿ"></a>ä»€ä¹ˆå¹¶è¡Œï¼Ÿ</h2><p>åœ¨åŒä¸€æ—¶åˆ»å†…å¤„ç†å¤šä¸ªäº‹æƒ…ï¼Œå°±åƒä¸€ä¸ª2ä¸ªå¿«é€’å‘˜åœ¨åŒæ—¶æ—¶é—´å†…åˆ†åˆ«ç»™ä½ æˆ‘é€å¿«é€’ã€‚(ä»–ä»¬2ä¸ªåœ¨åŒä¸€ä¸ªæ—¶é—´å†…åŒæ—¶å¹²æ´»ï¼Œæ•ˆç‡é«˜)ã€‚<code>å¹¶è¡Œ(parallel)ï¼š</code>æŒ‡åœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šæ¡æŒ‡ä»¤åœ¨å¤šä¸ªå¤„ç†å™¨ä¸ŠåŒæ—¶æ‰§è¡Œã€‚æ‰€ä»¥æ— è®ºä»å¾®è§‚è¿˜æ˜¯ä»å®è§‚æ¥çœ‹ï¼ŒäºŒè€…éƒ½æ˜¯ä¸€èµ·æ‰§è¡Œçš„ã€‚<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geldwbtva1j308p04mgln.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>å¹¶è¡Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­å­˜åœ¨ï¼Œè€Œå¹¶å‘å¯ä»¥åœ¨å•å¤„ç†å™¨å’Œå¤šå¤„ç†å™¨ç³»ç»Ÿä¸­éƒ½å­˜åœ¨ï¼Œå¹¶å‘èƒ½å¤Ÿåœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­å­˜åœ¨æ˜¯å› ä¸ºå¹¶å‘æ˜¯å¹¶è¡Œçš„å‡è±¡ï¼Œå¹¶è¡Œè¦æ±‚ç¨‹åºèƒ½å¤ŸåŒæ—¶æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œè€Œå¹¶å‘åªæ˜¯è¦æ±‚ç¨‹åºå‡è£…åŒæ—¶æ‰§è¡Œå¤šä¸ªæ“ä½œï¼ˆæ¯ä¸ªå°æ—¶é—´ç‰‡æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œå¤šä¸ªæ“ä½œå¿«é€Ÿåˆ‡æ¢æ‰§è¡Œï¼‰ã€‚</p><p>å½“æœ‰å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œæ—¶ï¼Œå¦‚æœç³»ç»Ÿåªæœ‰ä¸€ä¸ª CPUï¼Œåˆ™å®ƒæ ¹æœ¬ä¸å¯èƒ½çœŸæ­£åŒæ—¶è¿›è¡Œä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹ï¼Œå®ƒåªèƒ½æŠŠ CPU è¿è¡Œæ—¶é—´åˆ’åˆ†æˆè‹¥å¹²ä¸ªæ—¶é—´æ®µï¼Œå†å°†æ—¶é—´æ®µåˆ†é…ç»™å„ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåœ¨ä¸€ä¸ªæ—¶é—´æ®µçš„çº¿ç¨‹ä»£ç è¿è¡Œæ—¶,å…¶å®ƒçº¿ç¨‹å¤„äºæŒ‚èµ·çŠ¶æ€.è¿™ç§æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶å‘ï¼ˆConcurrentï¼‰ã€‚</p><p>å½“ç³»ç»Ÿæœ‰ä¸€ä¸ªä»¥ä¸Š CPU æ—¶ï¼Œåˆ™çº¿ç¨‹çš„æ“ä½œæœ‰å¯èƒ½éå¹¶å‘ã€‚å½“ä¸€ä¸ª CPU æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ª CPU å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªçº¿ç¨‹äº’ä¸æŠ¢å  CPU èµ„æºï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œï¼Œè¿™ç§æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶è¡Œï¼ˆParallelï¼‰ã€‚<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geld285ybjj30i40ea750.jpg" srcset="/img/loading.gif" alt=""></p><p><strong>çœ‹å›¾éå¸¸å®¹æ˜“ç†è§£ï¼š</strong><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geld3btporj30o909faaz.jpg" srcset="/img/loading.gif" alt=""><br>ä¸Šå›¾ä¸­å°†ä¸€ä¸ªä»»åŠ¡ä¸­çš„ä¸‰ä¸ªæ­¥éª¤å–æŸ´ã€è¿æŸ´ã€å¸æŸ´åˆ’åˆ†æˆäº†ç‹¬ç«‹çš„å°ä»»åŠ¡ï¼Œæœ‰å–æŸ´çš„è€é¼ ï¼Œæœ‰è¿æŸ´çš„è€é¼ ï¼Œæœ‰å¸æŸ´çƒ§ç«çš„è€é¼ ã€‚<br>å¦‚æœä¸Šå›¾ä¸­æ‰€æœ‰çš„è€é¼ éƒ½æ˜¯åŒä¸€åªï¼Œé‚£ä¹ˆæ˜¯ä¸²è¡Œå¹¶å‘çš„ï¼Œå¦‚æœæ˜¯ä¸åŒçš„å¤šåªè€é¼ ï¼Œé‚£ä¹ˆæ˜¯å¹¶è¡Œå¹¶å‘çš„ã€‚</p><h4 id="å¹¶è¡Œå’Œä¸²è¡Œï¼š"><a href="#å¹¶è¡Œå’Œä¸²è¡Œï¼š" class="headerlink" title="å¹¶è¡Œå’Œä¸²è¡Œï¼š"></a>å¹¶è¡Œå’Œä¸²è¡Œï¼š</h4><ul><li>ä¸²è¡Œï¼šä¸€æ¬¡åªèƒ½å–å¾—ä¸€ä¸ªä»»åŠ¡å¹¶æ‰§è¡Œè¿™ä¸€ä¸ªä»»åŠ¡</li><li>å¹¶è¡Œï¼šå¯ä»¥åŒæ—¶é€šè¿‡å¤šè¿›ç¨‹/å¤šçº¿ç¨‹çš„æ–¹å¼å–å¾—å¤šä¸ªä»»åŠ¡ï¼Œå¹¶ä»¥å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹çš„æ–¹å¼åŒæ—¶æ‰§è¡Œè¿™äº›ä»»åŠ¡</li><li>æ³¨æ„ç‚¹ï¼š<ul><li>å¦‚æœæ˜¯å•è¿›ç¨‹/å•çº¿ç¨‹çš„å¹¶è¡Œï¼Œé‚£ä¹ˆæ•ˆç‡æ¯”ä¸²è¡Œæ›´å·®</li><li>å¦‚æœåªæœ‰å•æ ¸cpuï¼Œå¤šè¿›ç¨‹å¹¶è¡Œå¹¶æ²¡æœ‰æé«˜æ•ˆç‡</li><li>ä»ä»»åŠ¡é˜Ÿåˆ—ä¸Šçœ‹ï¼Œç”±äºåŒæ—¶ä»é˜Ÿåˆ—ä¸­å–å¾—å¤šä¸ªä»»åŠ¡å¹¶æ‰§è¡Œï¼Œç›¸å½“äºå°†ä¸€ä¸ªé•¿ä»»åŠ¡é˜Ÿåˆ—å˜æˆäº†çŸ­é˜Ÿåˆ—</li></ul></li></ul><h3 id="å¹¶å‘ï¼š"><a href="#å¹¶å‘ï¼š" class="headerlink" title="å¹¶å‘ï¼š"></a>å¹¶å‘ï¼š</h3><ul><li>å¹¶å‘æ˜¯ä¸€ç§ç°è±¡ï¼šåŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºæˆ–å¤šä¸ªä»»åŠ¡éœ€è¦è¢«å¤„ç†çš„ç°è±¡</li><li>è¿™äº›ä»»åŠ¡å¯èƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œå’ŒCPUæ ¸å¿ƒæ•°æ— å…³ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦å’ŒCPUä¸Šä¸‹æ–‡åˆ‡æ¢è¾¾åˆ°çš„ç»“æœ</li><li>è§£å†³å¤§å¹¶å‘çš„ä¸€ä¸ªæ€è·¯æ˜¯å°†å¤§ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªå°ä»»åŠ¡ï¼š</li><li>å¯èƒ½è¦ä½¿ç”¨ä¸€äº›æ•°æ®ç»“æ„æ¥é¿å…åˆ‡åˆ†æˆå¤šä¸ªå°ä»»åŠ¡å¸¦æ¥çš„é—®é¢˜</li><li>å¯ä»¥å¤šè¿›ç¨‹/å¤šçº¿ç¨‹å¹¶è¡Œçš„æ–¹å¼å»æ‰§è¡Œè¿™äº›å°ä»»åŠ¡è¾¾åˆ°é«˜æ•ˆç‡</li><li>æˆ–è€…ä»¥å•è¿›ç¨‹/å•çº¿ç¨‹é…åˆå¤šè·¯å¤ç”¨æ‰§è¡Œè¿™äº›å°ä»»åŠ¡æ¥è¾¾åˆ°é«˜æ•ˆç‡</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>è®¡ç®—æœºçŸ¥è¯†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goä¹‹é«˜é˜¶å‡½æ•°</title>
    <link href="/2020/04/24/Go%E4%B9%8B%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/"/>
    <url>/2020/04/24/Go%E4%B9%8B%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°??ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°??ï¼Ÿ</h1><p>ä¸€ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ç§å‡½æ•°å°±ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ï¼Œç¼–å†™é«˜é˜¶å‡½æ•°ï¼Œå°±æ˜¯è®©å‡½æ•°çš„å‚ï¼Œèƒ½å¤Ÿæ¥æ”¶åˆ«çš„å‡½æ•°ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°±æ˜¯æŒ‡è¿™ç§é«˜åº¦æŠ½è±¡çš„ç¼–ç¨‹èŒƒå¼ã€‚</p><h1 id="é«˜é˜¶å‡½æ•°çš„ç‰¹ç‚¹"><a href="#é«˜é˜¶å‡½æ•°çš„ç‰¹ç‚¹" class="headerlink" title="é«˜é˜¶å‡½æ•°çš„ç‰¹ç‚¹"></a>é«˜é˜¶å‡½æ•°çš„ç‰¹ç‚¹</h1><ul><li>å˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°</li></ul><p><code>å‡½æ•°æœ¬èº«ä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡ï¼Œå³ï¼šå˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°</code></p><pre><code class="go">package main//goè¯­è¨€å¯¼åŒ…import (    m &quot;Lets_Go/lets_18_package/math&quot; //èµ·åˆ«å  è‡ªå®šä¹‰åŒ…åä¹Ÿå°±æ˜¯ç»™â€œmathâ€œèµ·ä¸ªåˆ«å    &quot;fmt&quot;)func main() {    multip := m.SimpleCompute(&quot;+&quot;)    fmt.Println(multip(2, 8))}</code></pre><ul><li>è¿”å›å€¼ä¹Ÿæ˜¯å‡½æ•°</li></ul><pre><code class="go">/*    é—­åŒ…é«˜é˜¶å‡½æ•°*/func SimpleCompute(Symbol string) func(n, m int) int {    switch Symbol {    case &quot;+&quot;:        return func(n, m int) int {            return n + m        }    case &quot;-&quot;:        return func(n, m int) int {            return n - m        }    case &quot;*&quot;:        return func(n, m int) int {            return n * m        }    case &quot;/&quot;:        return func(n, m int) int {            return n / m        }    default:        panic(&quot;compute symbol invalid.&quot;)    }}</code></pre><ul><li>å‡½æ•°å¯ä½œä¸ºå‚æ•°</li></ul><p><code>æ—¢ç„¶å˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°èƒ½æ¥æ”¶å˜é‡ï¼Œé‚£ä¹ˆä¸€ä¸ªå‡½æ•°å°±å¯ä»¥æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¸€ä¸ªæœ€ç®€å•çš„é«˜é˜¶å‡½æ•°</code></p><pre><code class="go">package mainimport &quot;fmt&quot;//goè¯­è¨€ä¸­çš„é—­åŒ…æ“ä½œfunc main() {    f1(f3(f2, 5, 5))}//1.é™åˆ¶å‡½æ•°ç±»å‹çš„å‡½æ•°func f1(f func()) {    f()}//2.ç°åœ¨çš„éœ€æ±‚å°±è¦æŠŠæˆ‘ä»¬çš„f2å‡½æ•°ä¼ é€’åˆ°f1å‡½æ•°é‡Œé¢è¿›è¡Œè°ƒç”¨func f2(a, b int) int {    fmt.Println(&quot;f2() am f1() exec succeed&quot;)    fmt.Println(&quot;a + b = ? åœ¨f3ä¸­çš„åŒ¿åå‡½æ•°ä¸­è°ƒç”¨:&quot;)    return a + b}//3.é€šè¿‡é—­åŒ…è§£å†³func f3(fn func(int, int) int, a, b int) (Rf func()) { //è¿”å›å€¼åå­—å¿…é¡»æ˜¯â€œRfâ€ ä¸æƒ³ç”¨å°±ä¸éœ€è¦å†™ç›´æ¥å†™è¿”å›å€¼ç±»å‹    //è¿™ä¸ªå°±æ˜¯å–ä¸€ä¸ªä¸­é—´å˜é‡å­˜å‚¨ å¹¶ä¸” åœ¨å‡½æ•°é‡Œé¢å£°æ˜ä¸€ä¸ªåŒ¿åæ— è¿”å›å€¼çš„å‡½æ•°    // := è¿™é‡Œå¦‚æœå‡½æ•°è¿”å›å€¼å·²ç»åœ¨å‡½æ•°åä¸Šå†™ç€äº† å°±ä¸èƒ½ä½¿ç”¨ := å› ä¸ºå·²ç»åœ¨åˆ›å»ºå‡½æ•°æ—¶å·²ç»å£°æ˜äº†    Rf = func() {        sum := fn(a, b) //æ¥å—è¿”å›å€¼ ç„¶åæ‰“å°        fmt.Println(&quot;sum=&quot;, sum)    }    return Rf}</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goä¹‹channelæµ…å…¥äº†è§£</title>
    <link href="/2020/04/23/Go%E4%B9%8Bchannel%E6%B5%85%E5%85%A5%E4%BA%86%E8%A7%A3/"/>
    <url>/2020/04/23/Go%E4%B9%8Bchannel%E6%B5%85%E5%85%A5%E4%BA%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯Goè¯­è¨€çš„channelï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Goè¯­è¨€çš„channelï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Goè¯­è¨€çš„channelï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Goè¯­è¨€çš„channelï¼Ÿ</h2><blockquote><p>åœ¨Goè¯­è¨€ä¸­,Channelå³æŒ‡é€šé“ç±»å‹ã€‚æœ‰æ—¶ä¹Ÿç”¨å®ƒæ¥ç›´æ¥æŒ‡ä»£å¯ä»¥ä¼ é€’æŸç§ç±»å‹çš„å€¼çš„é€šé“ã€‚</p></blockquote><p>channelæ˜¯Goè¯­è¨€ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç±»å‹ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆç®¡é“ã€‚å¹¶å‘æ ¸å¿ƒå•å…ƒé€šè¿‡å®ƒå°±å¯ä»¥å‘é€æˆ–è€…æ¥æ”¶æ•°æ®è¿›è¡Œé€šè®¯ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šåˆè¿›ä¸€æ­¥é™ä½äº†ç¼–ç¨‹çš„éš¾åº¦ã€‚<br>channelæ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œä¸»è¦ç”¨æ¥è§£å†³åç¨‹çš„åŒæ­¥é—®é¢˜ä»¥åŠåç¨‹ä¹‹é—´æ•°æ®å…±äº«ï¼ˆæ•°æ®ä¼ é€’ï¼‰çš„é—®é¢˜ã€‚<br>goroutineè¿è¡Œåœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ï¼Œå› æ­¤è®¿é—®å…±äº«å†…å­˜å¿…é¡»åšå¥½åŒæ­¥ã€‚goroutine å¥‰è¡Œé€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜ï¼Œè€Œä¸æ˜¯å…±äº«å†…å­˜æ¥é€šä¿¡ã€‚<br>å¼•â½¤ç±»å‹ channelå¯ç”¨äºå¤šä¸ª goroutine é€šè®¯ã€‚å…¶å†…éƒ¨å®ç°äº†åŒæ­¥ï¼Œç¡®ä¿å¹¶å‘å®‰å…¨ã€‚</p><p>è™½ç„¶å¯ä»¥ä½¿ç”¨å…±äº«å†…å­˜è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œä½†æ˜¯å…±äº«å†…å­˜åœ¨ä¸åŒçš„goroutineä¸­å®¹æ˜“å‘ç”Ÿç«æ€é—®é¢˜ã€‚ä¸ºäº†ä¿è¯æ•°æ®äº¤æ¢çš„æ­£ç¡®æ€§ï¼Œå¿…é¡»ä½¿ç”¨äº’æ–¥é‡å¯¹å†…å­˜è¿›è¡ŒåŠ é”ï¼Œè¿™ç§åšæ³•åŠ¿å¿…é€ æˆæ€§èƒ½é—®é¢˜ã€‚</p><p>Goè¯­è¨€çš„å¹¶å‘æ¨¡å‹æ˜¯CSPï¼ˆCommunicating Sequential Processesï¼‰ï¼Œæå€¡é€šè¿‡é€šä¿¡å…±äº«å†…å­˜è€Œä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜è€Œå®ç°é€šä¿¡ã€‚</p><p>å¦‚æœè¯´goroutineæ˜¯Goç¨‹åºå¹¶å‘çš„æ‰§è¡Œä½“ï¼Œchannelå°±æ˜¯å®ƒä»¬ä¹‹é—´çš„è¿æ¥ã€‚channelæ˜¯å¯ä»¥è®©ä¸€ä¸ªgoroutineå‘é€ç‰¹å®šå€¼åˆ°å¦ä¸€ä¸ªgoroutineçš„é€šä¿¡æœºåˆ¶ã€‚</p><p>Go è¯­è¨€ä¸­çš„é€šé“ï¼ˆchannelï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ã€‚é€šé“åƒä¸€ä¸ªä¼ é€å¸¦æˆ–è€…é˜Ÿåˆ—ï¼Œæ€»æ˜¯éµå¾ªå…ˆå…¥å…ˆå‡ºï¼ˆFirst In First Outï¼‰çš„è§„åˆ™ï¼Œä¿è¯æ”¶å‘æ•°æ®çš„é¡ºåºã€‚æ¯ä¸€ä¸ªé€šé“éƒ½æ˜¯ä¸€ä¸ªå…·ä½“ç±»å‹çš„å¯¼ç®¡ï¼Œä¹Ÿå°±æ˜¯å£°æ˜channelçš„æ—¶å€™éœ€è¦ä¸ºå…¶æŒ‡å®šå…ƒç´ ç±»å‹ã€‚<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge3kqrcxboj30dw072mxe.jpg" srcset="/img/loading.gif" alt=""></p><h2 id="å±æ€§å’ŒåŸºæœ¬æ“ä½œ"><a href="#å±æ€§å’ŒåŸºæœ¬æ“ä½œ" class="headerlink" title="å±æ€§å’ŒåŸºæœ¬æ“ä½œ"></a>å±æ€§å’ŒåŸºæœ¬æ“ä½œ</h2><ul><li>åŸºäºé€šé“çš„é€šè®¯æ˜¯åœ¨å¤šä¸ªGoroutineä¹‹é—´è¿›è¡ŒåŒæ­¥çš„é‡è¦æ‰‹æ®µã€‚è€Œé’ˆå¯¹é€šé“çš„æ“ä½œæœ¬èº«ä¹Ÿæ˜¯åŒæ­¥çš„ã€‚</li><li>åœ¨åŒä¸€æ—¶åˆ»ï¼Œä»…æœ‰ä¸€ä¸ªGoroutineèƒ½å‘ä¸€ä¸ªé€šé“å‘é€å…ƒç´ å€¼</li><li>åŒæ—¶ä¹Ÿä»…æœ‰ä¸€ä¸ªGoroutineèƒ½ä»å®ƒé‚£é‡Œæ¥æ”¶å…ƒç´ å€¼ã€‚</li><li>é€šé“ç›¸å½“äºä¸€ä¸ªFIFOå…ˆè¿›å…ˆå‡ºçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>é€šé“ä¸­çš„å…ƒç´ å€¼éƒ½å…·æœ‰åŸå­æ€§ã€‚å®ƒä»¬æ˜¯ä¸å¯è¢«åˆ†å‰²çš„ã€‚é€šé“ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½åªå¯èƒ½è¢«æŸä¸€ä¸ªGoroutineæ¥æ”¶ã€‚å·²è¢«æ¥æ”¶çš„å…ƒç´ å€¼ä¼šç«‹åˆ»è¢«ä»é€šé“ä¸­åˆ é™¤ã€‚</li></ul><h2 id="æœ‰ç¼“å†²çš„channel"><a href="#æœ‰ç¼“å†²çš„channel" class="headerlink" title="æœ‰ç¼“å†²çš„channel"></a>æœ‰ç¼“å†²çš„channel</h2><p>æœ‰ç¼“å†²çš„é€šé“ï¼ˆbuffered channelï¼‰æ˜¯ä¸€ç§åœ¨è¢«æ¥æ”¶å‰èƒ½å­˜å‚¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®å€¼çš„é€šé“ã€‚<br>è¿™ç§ç±»å‹çš„é€šé“å¹¶ä¸å¼ºåˆ¶è¦æ±‚ goroutine ä¹‹é—´å¿…é¡»åŒæ—¶å®Œæˆå‘é€å’Œæ¥æ”¶ã€‚é€šé“ä¼šé˜»å¡å‘é€å’Œæ¥æ”¶åŠ¨ä½œçš„æ¡ä»¶ä¹Ÿä¸åŒã€‚<br>åªæœ‰é€šé“ä¸­æ²¡æœ‰è¦æ¥æ”¶çš„å€¼æ—¶ï¼Œæ¥æ”¶åŠ¨ä½œæ‰ä¼šé˜»å¡ã€‚<br>åªæœ‰é€šé“æ²¡æœ‰å¯ç”¨ç¼“å†²åŒºå®¹çº³è¢«å‘é€çš„å€¼æ—¶ï¼Œå‘é€åŠ¨ä½œæ‰ä¼šé˜»å¡ã€‚<br>è¿™å¯¼è‡´æœ‰ç¼“å†²çš„é€šé“å’Œæ— ç¼“å†²çš„é€šé“ä¹‹é—´çš„ä¸€ä¸ªå¾ˆå¤§çš„ä¸åŒï¼šæ— ç¼“å†²çš„é€šé“ä¿è¯è¿›è¡Œå‘é€å’Œæ¥æ”¶çš„ goroutine ä¼šåœ¨åŒä¸€æ—¶é—´è¿›è¡Œæ•°æ®äº¤æ¢ï¼›æœ‰ç¼“å†²çš„é€šé“æ²¡æœ‰è¿™ç§ä¿è¯ã€‚</p><p>ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge3kigisnoj30m70ewtaf.jpg" srcset="/img/loading.gif" alt=""></p><p>åœ¨ç¬¬ 1 æ­¥ï¼Œå³ä¾§çš„ goroutine æ­£åœ¨ä»é€šé“æ¥æ”¶ä¸€ä¸ªå€¼ã€‚<br>åœ¨ç¬¬ 2 æ­¥ï¼Œå³ä¾§çš„è¿™ä¸ª goroutineç‹¬ç«‹å®Œæˆäº†æ¥æ”¶å€¼çš„åŠ¨ä½œï¼Œè€Œå·¦ä¾§çš„ goroutine æ­£åœ¨å‘é€ä¸€ä¸ªæ–°å€¼åˆ°é€šé“é‡Œã€‚<br>åœ¨ç¬¬ 3 æ­¥ï¼Œå·¦ä¾§çš„goroutine è¿˜åœ¨å‘é€šé“å‘é€æ–°å€¼ï¼Œè€Œå³ä¾§çš„ goroutine æ­£åœ¨ä»é€šé“æ¥æ”¶å¦å¤–ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªæ­¥éª¤é‡Œçš„ä¸¤ä¸ªæ“ä½œæ—¢ä¸æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¸ä¼šäº’ç›¸é˜»å¡ã€‚<br>æœ€åï¼Œåœ¨ç¬¬ 4 æ­¥ï¼Œæ‰€æœ‰çš„å‘é€å’Œæ¥æ”¶éƒ½å®Œæˆï¼Œè€Œé€šé“é‡Œè¿˜æœ‰å‡ ä¸ªå€¼ï¼Œä¹Ÿæœ‰ä¸€äº›ç©ºé—´å¯ä»¥å­˜æ›´å¤šçš„å€¼ã€‚</p><p><em>ä½¿ç”¨ç¤ºä¾‹</em></p><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2020/4/22 - 3:15 ä¸‹åˆpackage mainimport (    &quot;fmt&quot;    &quot;sync&quot;)var wg sync.WaitGroup//goè¯­è¨€çš„channel é€šé“//goè¯­è¨€ä½¿ç”¨goroutineæ‰§è¡Œå¤šä¸ªtaskä»»åŠ¡//æ“ä½œä¸€ä¸ªmapæˆ–è€…å…¶ä»–å˜é‡æˆ–è€…å†…å­˜æ—¶ä¼šå‘ç”Ÿæ•°æ®ç«äº‰//ä½¿ç”¨goé‡Œé¢ä½¿ç”¨channelæ¥è§£å†³å¹¶å‘å¹¶è¡Œæ¥è§£å†³func main() {    //channelç±»å‹ ç›¸å½“äºä¸€ä¸ªé˜Ÿåˆ— first in -&gt; first out å…ˆè¿›å…ˆå‡ºåŸåˆ™    //å®šä¹‰ä¸€ä¸ªchannelç±»å‹ channelæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ éœ€è¦å¼€è¾Ÿç©ºé—´    var ch chan int    fmt.Println(ch == nil) //true    //åˆå§‹åŒ–ä¸€ä¸ªæ— ç¼“å†²åŒºçš„é€šé“    ch = make(chan int)    wg.Add(1)    go func (){        defer wg.Done()        x := &lt;- ch        fmt.Println(x)    }()    ch &lt;- 2048 //ä¼šå¡æ­»mainçš„ä¸»goroutineä»è€Œä¸èƒ½è®©ç¨‹åºè¿›è¡Œæ‰§è¡Œ    fmt.Println(ch) //æ— ç¼“å†²åŒºçš„channelä¸èƒ½æ”¾å…¥å€¼    fmt.Println(ch == nil) //false    //åˆå§‹åŒ–ä¸€ä¸ªå¸¦ç¼“å†²åŒºçš„é€šé“    bufChan := make(chan int,8)    fmt.Println(cap(bufChan)) //8 CAPå¯ä»¥æ¢å–é€šé“ç¼“å†²åŒºå¤§å°    //å‘é€å€¼ ä½¿ç”¨è¿™ä¸ª&quot;&lt;-ç¬¦å·&quot; è·å–ä¹Ÿä¸€æ ·    bufChan &lt;- 1024    num := &lt;-bufChan    fmt.Println(bufChan)    fmt.Println(num)    wg.Wait()}</code></pre><blockquote><p>ä¸Šé¢éƒ¨åˆ†å†…å®¹è½¬è½½äºé“¾æ¥ï¼š<a href="https://www.jianshu.com/p/e611d30feb9d" target="_blank" rel="noopener">https://www.jianshu.com/p/e611d30feb9d</a></p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>goroutine</tag>
      
      <tag>channel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goä¹‹goroutineæµ…å…¥äº†è§£</title>
    <link href="/2020/04/22/Go%E4%B9%8Bgoroutine%E6%B5%85%E5%85%A5%E4%BA%86%E8%A7%A3/"/>
    <url>/2020/04/22/Go%E4%B9%8Bgoroutine%E6%B5%85%E5%85%A5%E4%BA%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ä»€ä¹ˆgoroutine"><a href="#1-ä»€ä¹ˆgoroutine" class="headerlink" title="1.ä»€ä¹ˆgoroutine?"></a>1.ä»€ä¹ˆgoroutine?</h1><p>goroutineæ˜¯Goå¹¶è¡Œè®¾è®¡çš„æ ¸å¿ƒã€‚goroutineè¯´åˆ°åº•å…¶å®å°±æ˜¯åç¨‹ï¼Œå®ƒæ¯”çº¿ç¨‹æ›´å°ï¼Œåå‡ ä¸ªgoroutineå¯èƒ½ä½“ç°åœ¨åº•å±‚å°±æ˜¯äº”å…­ä¸ªçº¿ç¨‹ï¼ŒGoè¯­è¨€å†…éƒ¨å¸®ä½ å®ç°äº†è¿™äº›goroutineä¹‹é—´çš„å†…å­˜å…±äº«ã€‚æ‰§è¡Œgoroutineåªéœ€æå°‘çš„æ ˆå†…å­˜(å¤§æ¦‚æ˜¯4~5KB)ï¼Œå½“ç„¶ä¼šæ ¹æ®ç›¸åº”çš„æ•°æ®ä¼¸ç¼©ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œå¯åŒæ—¶è¿è¡Œæˆåƒä¸Šä¸‡ä¸ªå¹¶å‘ä»»åŠ¡ã€‚goroutineæ¯”threadæ›´æ˜“ç”¨ã€æ›´é«˜æ•ˆã€æ›´è½»ä¾¿ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ™®é€šè®¡ç®—æœºè·‘å‡ åä¸ªçº¿ç¨‹å°±æœ‰ç‚¹è´Ÿè½½è¿‡å¤§äº†ï¼Œä½†æ˜¯åŒæ ·çš„æœºå™¨å´å¯ä»¥è½»æ¾åœ°è®©æˆç™¾ä¸Šåƒä¸ªgoroutineè¿›è¡Œèµ„æºç«äº‰ã€‚</p><p>Goroutineæ˜¯å»ºç«‹åœ¨çº¿ç¨‹ä¹‹ä¸Šçš„è½»é‡çº§çš„æŠ½è±¡ã€‚å®ƒå…è®¸æˆ‘ä»¬ä»¥éå¸¸ä½çš„ä»£ä»·åœ¨åŒä¸€ä¸ªåœ°å€ç©ºé—´ä¸­å¹¶è¡Œåœ°æ‰§è¡Œå¤šä¸ªå‡½æ•°æˆ–è€…æ–¹æ³•ã€‚ç›¸æ¯”äºçº¿ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·è¦å°å¾ˆå¤šï¼Œå¹¶ä¸”å®ƒçš„è°ƒåº¦æ˜¯ç‹¬ç«‹äºçº¿ç¨‹çš„ã€‚åœ¨golangä¸­åˆ›å»ºä¸€ä¸ªgoroutineéå¸¸ç®€å•ï¼Œä½¿ç”¨â€œgoâ€å…³é”®å­—å³å¯ï¼š</p><pre><code class="go">// Copyright (c) 2020 HigKer// Open Source: MIT License// Author: SDing &lt;deen.job@qq.com&gt;// Date: 2020/4/21 - 6:09 ä¸‹åˆpackage mainimport (    &quot;fmt&quot;    &quot;math/rand&quot;    &quot;sync&quot;    &quot;time&quot;)var (    //è¿™ä¸ªæ˜¯goé‡Œé¢ç”¨æ¥é…ç½®goroutineä½¿ç”¨çš„    //åªèƒ½æ“ä½œæŒ‡é’ˆ å› ä¸ºä»–æ˜¯ä¸€ä¸ªstruct å€¼ç±»å‹ï¼ï¼ï¼    wg sync.WaitGroup    //å­˜æ”¾æˆ‘ä»¬forçš„æ•°å­—æ–¹ä¾¿è§‚å¯Ÿ    sls []int)//goè¯­è¨€ä¸­çš„å¤šä¸ªgoroutine//WaitGroupfunc main() {    fmt.Println(&quot;goroutine begin:&quot;, sls)    for i := 0; i &lt;= 10; i++ {        // fatal error: all goroutines are asleep - deadlock!        //æ³¨æ„è¿™é‡ŒåŠ çš„1ä¸æ˜¯iå¦‚æœæ˜¯içš„è¯æ¯æ¬¡éƒ½æ˜¯åŠ çš„ä¸ä¸€æ ·ç„¶åå‡ºç°ğŸ‘†çš„å¼‚å¸¸ï¼ï¼ï¼        wg.Add(1)        go task(i)    }    fmt.Println(&quot;InService:&quot;, sls)    wg.Wait()    fmt.Println(&quot;End Over:&quot;, sls)}// fatal error: all goroutines are asleep - deadlock!func task(num int) {    defer func() {        wg.Done()    }()    //éšæœºä¼‘çœ å‡ æ¯«ç§’    time.Sleep(duration())    //å°†forå¾ªç¯çš„iå­˜å…¥åˆ°åˆ‡ç‰‡ä¸­æˆ‘ä»¬ç­‰ä¸‹å¥½è§‚å¯Ÿ,    //æ‰“å°æ§åˆ¶å°å¤ªæ…¢äº†å›æ¼æ‰    sls = append(sls, num) //ä¸å®‰å…¨}//ç”Ÿæˆä¸€ä¸ªéšæœºçš„ç­‰å¾…æ—¶é—´ = æ¯«ç§’func duration() time.Duration {    rand.Seed(time.Now().UnixNano())    return time.Millisecond * time.Duration(rand.Intn(3000))}</code></pre><h3 id="output"><a href="#output" class="headerlink" title="output"></a>output</h3><pre><code class="shell">goroutine begin: []InService: []End Over: [4 10 9 8 6 1 0 3 2]</code></pre><blockquote><p>ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜å¤šæ¬¡è¿è¡Œä½ ä¼šå‘ç°æœ‰æ—¶å€™ç»“æœçš„sliceä¼šå°‘ä¸€ä¸ªæ•°,è¿™æ˜¯å› ä¸ºï¼Œå’Œçº¿ç¨‹ä¸€æ ·ï¼Œgolangçš„ä¸»å‡½æ•°ï¼ˆå…¶å®ä¹Ÿè·‘åœ¨ä¸€ä¸ªgoroutineä¸­ï¼‰å¹¶ä¸ä¼šç­‰å¾…å…¶å®ƒgoroutineç»“æŸã€‚å¦‚æœä¸»goroutineç»“æŸäº†ï¼Œæ‰€æœ‰å…¶å®ƒgoroutineéƒ½å°†ç»“æŸ,æ‰€æœ‰åé¢æˆ‘ä»¬å°±ä¼šå°†åˆ°goçš„channelæ¥è§£å†³é—®é¢˜~æ•°æ®ç«äº‰å’Œæ•°æ®å…±äº«,å¤šä¸ªgoroutineä¹‹é—´çš„é€šè®¯é—®é¢˜ã€‚</p></blockquote><h3 id="Goroutineä¸çº¿ç¨‹çš„åŒºåˆ«"><a href="#Goroutineä¸çº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="Goroutineä¸çº¿ç¨‹çš„åŒºåˆ«"></a>Goroutineä¸çº¿ç¨‹çš„åŒºåˆ«</h3><p>è®¸å¤šäººè®¤ä¸ºgoroutineæ¯”çº¿ç¨‹è¿è¡Œå¾—æ›´å¿«ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯¯è§£ã€‚Goroutineå¹¶ä¸ä¼šæ›´å¿«ï¼Œå®ƒåªæ˜¯å¢åŠ äº†æ›´å¤šçš„å¹¶å‘æ€§ã€‚å½“ä¸€ä¸ªgoroutineè¢«é˜»å¡ï¼ˆæ¯”å¦‚ç­‰å¾…IOï¼‰ï¼Œgolangçš„schedulerä¼šè°ƒåº¦å…¶å®ƒå¯ä»¥æ‰§è¡Œçš„goroutineè¿è¡Œã€‚ä¸çº¿ç¨‹ç›¸æ¯”ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p><h3 id="å†…å­˜æ¶ˆè€—æ›´å°‘ï¼š"><a href="#å†…å­˜æ¶ˆè€—æ›´å°‘ï¼š" class="headerlink" title="å†…å­˜æ¶ˆè€—æ›´å°‘ï¼š"></a>å†…å­˜æ¶ˆè€—æ›´å°‘ï¼š</h3><p>Goroutineæ‰€éœ€è¦çš„å†…å­˜é€šå¸¸åªæœ‰2kbï¼Œè€Œçº¿ç¨‹åˆ™éœ€è¦1Mbï¼ˆ500å€ï¼‰ã€‚<br>å†…å­˜æ¶ˆè€—æ›´å°‘ï¼š</p><h3 id="åˆ›å»ºä¸é”€æ¯çš„å¼€é”€æ›´å°"><a href="#åˆ›å»ºä¸é”€æ¯çš„å¼€é”€æ›´å°" class="headerlink" title="åˆ›å»ºä¸é”€æ¯çš„å¼€é”€æ›´å°"></a>åˆ›å»ºä¸é”€æ¯çš„å¼€é”€æ›´å°</h3><p>ç”±äºçº¿ç¨‹åˆ›å»ºæ—¶éœ€è¦å‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºï¼Œå¹¶ä¸”åœ¨é”€æ¯æ—¶å°†èµ„æºå½’è¿˜ï¼Œå› æ­¤å®ƒçš„åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œgoroutineçš„åˆ›å»ºå’Œé”€æ¯æ˜¯ç”±goè¯­è¨€åœ¨è¿è¡Œæ—¶è‡ªå·±ç®¡ç†çš„ï¼Œå› æ­¤å¼€é”€æ›´ä½ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge2mjdldsfj30hs0a5q3h.jpg" srcset="/img/loading.gif" alt=""></p><h3 id="åˆ‡æ¢å¼€é”€æ›´å°"><a href="#åˆ‡æ¢å¼€é”€æ›´å°" class="headerlink" title="åˆ‡æ¢å¼€é”€æ›´å°"></a>åˆ‡æ¢å¼€é”€æ›´å°</h3><p>è¿™æ˜¯goroutineäºçº¿ç¨‹çš„ä¸»è¦åŒºåˆ«ï¼Œä¹Ÿæ˜¯golangèƒ½å¤Ÿå®ç°é«˜å¹¶å‘çš„ä¸»è¦åŸå› ã€‚çº¿ç¨‹çš„è°ƒåº¦æ–¹å¼æ˜¯æŠ¢å å¼çš„ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†åˆ†é…ç»™å®ƒçš„æ—¶é—´ç‰‡ï¼Œå°±ä¼šè¢«å…¶å®ƒå¯æ‰§è¡Œçš„çº¿ç¨‹æŠ¢å ã€‚åœ¨çº¿ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹ä¸­éœ€è¦ä¿å­˜/æ¢å¤æ‰€æœ‰çš„å¯„å­˜å™¨ä¿¡æ¯ï¼Œæ¯”å¦‚16ä¸ªé€šç”¨å¯„å­˜å™¨ï¼ŒPCï¼ˆProgram Counterï¼‰ï¼ŒSPï¼ˆStack Pointerï¼‰ï¼Œæ®µå¯„å­˜å™¨ç­‰ç­‰ã€‚</p><p>è€Œgoroutineçš„è°ƒåº¦æ˜¯ååŒå¼çš„ï¼Œå®ƒä¸ä¼šç›´æ¥åœ°ä¸æ“ä½œç³»ç»Ÿå†…æ ¸æ‰“äº¤é“ã€‚å½“goroutineè¿›è¡Œåˆ‡æ¢çš„æ—¶å€™ï¼Œä¹‹åå¾ˆå°‘é‡çš„å¯„å­˜å™¨éœ€è¦ä¿å­˜å’Œæ¢å¤ï¼ˆPCå’ŒSPï¼‰ã€‚å› æ­¤gouroutineçš„åˆ‡æ¢æ•ˆç‡æ›´é«˜ã€‚</p><h3 id="Goroutineçš„è°ƒåº¦"><a href="#Goroutineçš„è°ƒåº¦" class="headerlink" title="Goroutineçš„è°ƒåº¦"></a>Goroutineçš„è°ƒåº¦</h3><p>çœŸå¦‚å‰é¢æåˆ°çš„ï¼Œgoroutineçš„è°ƒåº¦æ–¹å¼æ˜¯ååŒå¼çš„ã€‚åœ¨ååŒå¼è°ƒåº¦ä¸­ï¼Œæ²¡æœ‰æ—¶é—´ç‰‡çš„æ¦‚å¿µã€‚ä¸ºäº†å¹¶è¡Œæ‰§è¡Œgoroutineï¼Œè°ƒåº¦å™¨ä¼šåœ¨ä»¥ä¸‹å‡ ä¸ªæ—¶é—´ç‚¹å¯¹å…¶è¿›è¡Œåˆ‡æ¢ï¼š</p><h3 id="Channelæ¥å—æˆ–è€…å‘é€ä¼šé€ æˆé˜»å¡çš„æ¶ˆæ¯"><a href="#Channelæ¥å—æˆ–è€…å‘é€ä¼šé€ æˆé˜»å¡çš„æ¶ˆæ¯" class="headerlink" title="Channelæ¥å—æˆ–è€…å‘é€ä¼šé€ æˆé˜»å¡çš„æ¶ˆæ¯"></a>Channelæ¥å—æˆ–è€…å‘é€ä¼šé€ æˆé˜»å¡çš„æ¶ˆæ¯</h3><p>å½“ä¸€ä¸ªæ–°çš„goroutineè¢«åˆ›å»ºæ—¶<br>å¯ä»¥é€ æˆé˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æ–‡ä»¶å’Œç½‘ç»œæ“ä½œ<br>åƒåœ¾å›æ”¶<br>ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è°ƒåº¦å™¨å…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚Golangè°ƒåº¦å™¨ä¸­æœ‰ä¸‰ä¸ªæ¦‚å¿µ</p><ul><li>Processorï¼ˆPï¼‰</li><li>OSThreadï¼ˆMï¼‰</li><li>Goroutinesï¼ˆGï¼‰</li></ul><p>åœ¨ä¸€ä¸ªGoç¨‹åºä¸­ï¼Œå¯ç”¨çš„çº¿ç¨‹æ•°æ˜¯é€šè¿‡GOMAXPROCSæ¥è®¾ç½®çš„ï¼Œé»˜è®¤å€¼æ˜¯å¯ç”¨çš„CPUæ ¸æ•°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨runtimeåŒ…åŠ¨æ€æ”¹å˜è¿™ä¸ªå€¼ã€‚OSThreadè°ƒåº¦åœ¨processorä¸Šï¼Œgoroutinesè°ƒåº¦åœ¨OSThreadsä¸Š<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge2ml5ze1wj30hs08at98.jpg" srcset="/img/loading.gif" alt=""><br>Golangçš„è°ƒåº¦å™¨å¯ä»¥åˆ©ç”¨å¤šprocessorèµ„æºï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼ŒMä¸ªgoroutineéœ€è¦è¢«è°ƒåº¦åˆ°Nä¸ªOS threadsä¸Šï¼ŒåŒæ—¶è¿™äº›threadsè¿è¡Œåœ¨è‡³å¤šGOMAXPROCSä¸ªprocessorä¸Šï¼ˆN &lt;= GOMAXPROCSï¼‰ã€‚Go schedulerå°†å¯è¿è¡Œçš„goroutinesåˆ†é…åˆ°å¤šä¸ªè¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªprocessorä¸Šçš„OS threadsä¸Šã€‚</p><p>æ¯ä¸ªprocessoræœ‰ä¸€ä¸ªæœ¬åœ°goroutineé˜Ÿåˆ—ã€‚åŒæ—¶æœ‰ä¸€ä¸ªå…¨å±€çš„goroutineé˜Ÿåˆ—ã€‚æ¯ä¸ªOSThreadéƒ½ä¼šè¢«åˆ†é…ç»™ä¸€ä¸ªprocessorã€‚æœ€å¤šåªèƒ½æœ‰GOMAXPROCSä¸ªprocessorï¼Œæ¯ä¸ªprocessoråŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªOSThreadã€‚Scheculerå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºOSThreadã€‚<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge2mlz0si1j30hs08j74l.jpg" srcset="/img/loading.gif" alt=""><br>åœ¨æ¯ä¸€è½®è°ƒåº¦ä¸­ï¼Œscheduleræ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„goroutineå¹¶æ‰§è¡Œç›´åˆ°å…¶è¢«é˜»å¡,ç”±æ­¤å¯è§ï¼Œæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªçº¿ç¨‹ä¸‹å¯ä»¥å¹¶å‘æ‰§è¡Œä¸Šåƒä¸ªgoroutineï¼Œæ¯ä¸ªgoroutineæ‰€å ç”¨çš„èµ„æºå’Œåˆ‡æ¢å¼€é”€éƒ½å¾ˆå°ï¼Œå› æ­¤ï¼Œgoroutineæ˜¯golangé€‚åˆé«˜å¹¶å‘åœºæ™¯çš„é‡è¦åŸå› ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>golang</tag>
      
      <tag>goroutine</tag>
      
      <tag>channel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Macä¸Šé…ç½®Golangå¼€å‘ç¯å¢ƒ</title>
    <link href="/2020/03/13/Mac%E4%B8%8A%E9%85%8D%E7%BD%AEGolang%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    <url>/2020/03/13/Mac%E4%B8%8A%E9%85%8D%E7%BD%AEGolang%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2020/03/13/JYRMzrxeKlLNp26.jpg" srcset="/img/loading.gif" alt="Golang"></p><blockquote><p><strong>ğŸ“æœ¬ç¯‡æ–‡ç« è®°å½•æˆ‘æœ¬äººåœ¨Macä¸Šé…ç½®Goå¼€å‘ç¯å¢ƒçš„ç¬”è®°ğŸ“’</strong></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li><a href="https://github.com/golang/go" target="_blank" rel="noopener">Go Source Code</a></li><li>Goæ˜¯Googleå¼€å‘çš„ä¸€ç§é™æ€å¼ºç±»å‹ã€ç¼–è¯‘å‹ã€å¹¶å‘å‹ï¼Œå¹¶å…·æœ‰åƒåœ¾å›æ”¶åŠŸèƒ½çš„ç¼–ç¨‹è¯­è¨€ã€‚ ç½—ä¼¯ç‰¹Â·æ ¼ç‘å²è«ï¼Œç½—å‹ƒÂ·æ´¾å…‹åŠè‚¯Â·æ±¤æ™®é€Šäº2007å¹´9æœˆå¼€å§‹è®¾è®¡Goï¼Œç¨åIan Lance Taylorã€Russ CoxåŠ å…¥é¡¹ç›®ã€‚Goæ˜¯åŸºäºInfernoæ“ä½œç³»ç»Ÿæ‰€å¼€å‘çš„ã€‚</li><li>Goçš„è¯­æ³•æ¥è¿‘Cè¯­è¨€ï¼Œä½†å¯¹äºå˜é‡çš„å£°æ˜æœ‰æ‰€ä¸åŒã€‚Goæ”¯æŒåƒåœ¾å›æ”¶åŠŸèƒ½ã€‚Goçš„å¹¶è¡Œè®¡ç®—æ¨¡å‹æ˜¯ä»¥ä¸œå°¼Â·éœå°”çš„é€šä¿¡é¡ºåºè¿›ç¨‹ï¼ˆCSPï¼‰ä¸ºåŸºç¡€ï¼Œé‡‡å–ç±»ä¼¼æ¨¡å‹çš„å…¶ä»–è¯­è¨€åŒ…æ‹¬Occamå’ŒLimboï¼Œ[2]ï¼Œä½†å®ƒä¹Ÿå…·æœ‰pipelineæ¨¡å‹çš„ç‰¹å¾ï¼Œæ¯”å¦‚é€šé“ä¼ è¾“ã€‚åœ¨1.8ç‰ˆæœ¬ä¸­å¼€æ”¾æ’ä»¶ï¼ˆPluginï¼‰çš„æ”¯æŒï¼Œè¿™æ„å‘³ç€ç°åœ¨èƒ½ä»Goä¸­åŠ¨æ€åŠ è½½éƒ¨åˆ†å‡½æ•°ã€‚ä¸C++ç›¸æ¯”ï¼ŒGoå¹¶ä¸åŒ…æ‹¬å¦‚æšä¸¾ã€å¼‚å¸¸å¤„ç†ã€ç»§æ‰¿ã€æ³›å‹ã€æ–­è¨€ã€è™šå‡½æ•°ç­‰åŠŸèƒ½ï¼Œä½†å¢åŠ äº† åˆ‡ç‰‡(Slice) å‹ã€å¹¶å‘ã€ç®¡é“ã€åƒåœ¾å›æ”¶åŠŸèƒ½ã€æ¥å£ç­‰ç‰¹æ€§çš„è¯­è¨€çº§æ”¯æŒ[2]ã€‚Go 2.0ç‰ˆæœ¬å°†æ”¯æŒæ³›å‹[7]ï¼Œå¯¹äºæ–­è¨€çš„å­˜åœ¨ï¼Œåˆ™æŒè´Ÿé¢æ€åº¦ï¼ŒåŒæ—¶ä¹Ÿä¸ºè‡ªå·±ä¸æä¾›ç±»å‹ç»§æ‰¿æ¥è¾©æŠ¤ã€‚ä¸åŒäºJavaï¼ŒGoåŸç”Ÿæä¾›äº†å…³è”æ•°ç»„ï¼ˆä¹Ÿç§°ä¸ºå“ˆå¸Œè¡¨ï¼ˆHashesï¼‰æˆ–å­—å…¸ï¼ˆDictionariesï¼‰ï¼‰ï¼Œå°±åƒå­—ç¬¦ä¸²ç±»å‹ä¸€æ ·ã€‚</li></ul><h2 id="ä¸‹è½½-amp-å®‰è£…"><a href="#ä¸‹è½½-amp-å®‰è£…" class="headerlink" title="ä¸‹è½½ &amp; å®‰è£…"></a>ä¸‹è½½ &amp; å®‰è£…</h2><ul><li><a href="https://go.dev/" target="_blank" rel="noopener">Go Dev</a></li><li>æµè§ˆå™¨ğŸ”›æ‰“å¼€ä¸Šé¢ğŸ‘†é“¾æ¥ä¸‹è½½å®˜æ–¹å®‰è£…åŒ…<br><img src="https://i.loli.net/2020/03/13/XosNZdnTVtr3auA.jpg" srcset="/img/loading.gif" alt="Xnip2020-03-13_15-54-37.jpg"></li><li>ä¸‹è½½çš„æ—¶å€™æ ¹æ®è‡ªå·±ç³»ç»Ÿç‰ˆæœ¬ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…</li><li>ä¸‹è½½å®Œæˆä¹‹ååŒå‡»å®‰è£…åŒ…å³å¯å®‰è£…</li></ul><h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>æˆ‘æœ¬äººMacæ˜¯ä½¿ç”¨çš„<code>iTerm2 + Oh My Zsh + zsh</code>æ‰€ä»¥æˆ‘åªéœ€è¦ç¼–è¾‘æˆ‘çš„<code>~/.zshrc</code>æ–‡ä»¶ğŸ“ƒå³å¯.</p><ul><li>é€šè¿‡vscodeæ‰“å¼€<pre><code class="bash">code ~/.zshrc</code></pre></li><li>åœ¨æ–‡ä»¶æœ€åæ·»åŠ ä¿®æ”¹é…ç½®<pre><code class="bash">##goè¯­è¨€ç¯å¢ƒé…ç½® ##go è¯­è¨€å®‰è£…ä¸»æ ¹ç›®å½•export GOROOT=/usr/local/go#GOPATHæ˜¯è‡ªå·±çš„goé¡¹ç›®è·¯å¾„ï¼Œè‡ªå®šä¹‰è®¾ç½®export GOPATH=/Users/ding/Documents/GO_CODE_DEV# å¯ç”¨ Go Modules åŠŸèƒ½export GO111MODULE=on# é…ç½® GOPROXY ç¯å¢ƒå˜é‡ &amp; å›½å†…ç½‘ç»œç¯å¢ƒå¤§å®¶éƒ½çŸ¥é“ä¸å¤šè¯´export GOPROXY=https://goproxy.io,directexport PATH=$PATH:$GOBIN:$GOPATH/bin:GO111MODULE:GOPROXY</code></pre></li><li>ç„¶åä½¿ç”¨<code>source ~/.zshrc</code>æ–‡ä»¶</li><li>åœ¨terminalé‡Œé¢è¾“å…¥<code>go env</code>å³å¯æŸ¥çœ‹ç¯å¢ƒ<br><img src="https://i.loli.net/2020/03/13/3hrCzjTS5D4MlKJ.jpg" srcset="/img/loading.gif" alt="Xnip2020-03-13_16-07-43.jpg"></li></ul><h2 id="VSCodeé…ç½®"><a href="#VSCodeé…ç½®" class="headerlink" title="VSCodeé…ç½®"></a>VSCodeé…ç½®</h2><p>æˆ‘ä¸ªäººä½¿ç”¨vscodeæ¯”è¾ƒå¤šä¸€ç‚¹,Golandåœ¨å¼€å‘å¤§å‹é¡¹ç›®æ‰ä½¿ç”¨<br><strong>VS Codeå®˜æ–¹ä¸‹è½½åœ°å€ï¼š<a href="https://code.visualstudio.com/Download" target="_blank" rel="noopener">https://code.visualstudio.com/Download</a></strong><br>ä¸‰å¤§ä¸»æµå¹³å°éƒ½æ”¯æŒï¼Œè¯·æ ¹æ®è‡ªå·±çš„ç”µè„‘å¹³å°é€‰æ‹©å¯¹åº”çš„å®‰è£…åŒ…ã€‚åŒå‡»ä¸‹è½½å¥½çš„å®‰è£…æ–‡ä»¶ï¼ŒåŒå‡»å®‰è£…å³å¯ã€‚</p><ul><li><h4 id="å®‰è£…Goè¯­è¨€å¼€å‘å·¥å…·åŒ…"><a href="#å®‰è£…Goè¯­è¨€å¼€å‘å·¥å…·åŒ…" class="headerlink" title="å®‰è£…Goè¯­è¨€å¼€å‘å·¥å…·åŒ…"></a>å®‰è£…Goè¯­è¨€å¼€å‘å·¥å…·åŒ…</h4><p>åœ¨åº§Goè¯­è¨€å¼€å‘çš„æ—¶å€™ä¸ºæˆ‘ä»¬æä¾›è¯¸å¦‚ä»£ç æç¤ºã€ä»£ç è‡ªåŠ¨è¡¥å…¨ç­‰åŠŸèƒ½ã€‚<br>Windowså¹³å°æŒ‰ä¸‹Ctrl+Shift+Pï¼ŒMacå¹³å°æŒ‰Command+Shift+Pï¼Œè¿™ä¸ªæ—¶å€™VS Codeç•Œé¢ä¼šå¼¹å‡ºä¸€ä¸ªè¾“å…¥æ¡†ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://www.liwenzhou.com/images/Go/00_config_VSCode/15535662106193.jpg" srcset="/img/loading.gif" alt="GO"><br>æˆ‘ä»¬åœ¨è¿™ä¸ªè¾“å…¥æ¡†ä¸­è¾“å…¥<code>&gt;go:install</code>ï¼Œä¸‹é¢ä¼šè‡ªåŠ¨æœç´¢ç›¸å…³å‘½ä»¤ï¼Œæˆ‘ä»¬é€‰æ‹©<code>Go:Install/Update Tools</code>è¿™ä¸ªå‘½ä»¤<br><img src="https://www.liwenzhou.com/images/Go/00_config_VSCode/15535659707162.jpg" srcset="/img/loading.gif" alt="GOINSTALL"><br>é€‰ä¸­å¹¶ä¼šå›è½¦æ‰§è¡Œè¯¥å‘½ä»¤ï¼ˆæˆ–è€…ä½¿ç”¨é¼ æ ‡ç‚¹å‡»è¯¥å‘½ä»¤ï¼‰<br><img src="https://www.liwenzhou.com/images/Go/00_config_VSCode/15535665573387.jpg" srcset="/img/loading.gif" alt="golang"></p></li><li><h4 id="é…ç½®ä»£ç ç‰‡æ®µå¿«æ·é”®"><a href="#é…ç½®ä»£ç ç‰‡æ®µå¿«æ·é”®" class="headerlink" title="é…ç½®ä»£ç ç‰‡æ®µå¿«æ·é”®"></a>é…ç½®ä»£ç ç‰‡æ®µå¿«æ·é”®</h4><p>è¿˜æ˜¯æŒ‰Ctrl/Command+Shift+P,æŒ‰ä¸‹å›¾è¾“å…¥<code>&gt;snippets</code>ï¼Œé€‰æ‹©å‘½ä»¤å¹¶æ‰§è¡Œ<br><img src="https://www.liwenzhou.com/images/Go/00_config_VSCode/15535687503862.jpg" srcset="/img/loading.gif" alt="GO"><br>é…ç½®<code>snippets</code>ä»£ç ç‰‡æ®µæ¨¡æœ¬<br><img src="https://www.liwenzhou.com/images/Go/00_config_VSCode/15535688890224.jpg" srcset="/img/loading.gif" alt="GO SNIPPETS"><br>å¤§å®¶å¯ä»¥ç®€å•çœ‹ä¸‹ä¸Šé¢çš„æ³¨é‡Šï¼Œä»‹ç»äº†ä¸»è¦ç”¨æ³•ï¼š</p><pre><code class="json">    â€œè¿™é‡Œæ”¾ä¸ªåå­—â€:{      &quot;prefix&quot;: &quot;è¿™ä¸ªæ˜¯å¿«æ·é”®&quot;,      &quot;body&quot;: &quot;è¿™é‡Œæ˜¯æŒ‰å¿«æ·é”®æ’å…¥çš„ä»£ç ç‰‡æ®µ&quot;,      &quot;description&quot;: &quot;è¿™é‡Œæ”¾æç¤ºä¿¡æ¯çš„æè¿°&quot;    }</code></pre><p> å…¶ä¸­<code>$0</code>è¡¨ç¤ºæœ€ç»ˆå…‰æ ‡æç•™çš„ä½ç½®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªå¿«æ·æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯è¾“å…¥<code>pln</code>å°±ä¼šåœ¨ç¼–è¾‘å™¨ä¸­æ’å…¥<code>fmt.Println()</code>ä»£ç ï¼›è¾“å…¥<code>plf</code>ï¼Œå°±ä¼šæ’å…¥<code>fmt.Printf(&quot;&quot;)</code>ä»£ç ã€‚</p><pre><code class="json">  {    &quot;println&quot;:{      &quot;prefix&quot;: &quot;pln&quot;,      &quot;body&quot;:&quot;fmt.Println($0)&quot;,      &quot;description&quot;: &quot;println&quot;    },    &quot;printf&quot;:{      &quot;prefix&quot;: &quot;plf&quot;,      &quot;body&quot;: &quot;fmt.Printf(\&quot;$0\&quot;)&quot;,      &quot;description&quot;: &quot;printf&quot;    }  }</code></pre><p>æ·»åŠ å¦‚ä¸Šé…ç½®åï¼Œä¿å­˜ã€‚ æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªgoæ–‡ä»¶ï¼Œæµ‹è¯•ä¸€ä¸‹æ•ˆæœï¼š<br> <img src="https://www.liwenzhou.com/images/Go/00_config_VSCode/demo1.gif" srcset="/img/loading.gif" alt="fmt.println"></p></li></ul><p><strong>å¥½äº†é…ç½®å®Œæˆ,å¼€å§‹æ„‰å¿«çš„codingå§ğŸ‘¨â€ğŸ’»â€Good luck~ğŸ˜œ</strong>   </p>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>Golang</tag>
      
      <tag>Mac</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexoé›†æˆgitalkè¯„è®ºç»„ä»¶</title>
    <link href="/2020/03/08/Hexo%E9%9B%86%E6%88%90gitalk%E8%AF%84%E8%AE%BA%E7%BB%84%E4%BB%B6/"/>
    <url>/2020/03/08/Hexo%E9%9B%86%E6%88%90gitalk%E8%AF%84%E8%AE%BA%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/BayMRX/Blog_source@master/img/hexo.jpg" srcset="/img/loading.gif" alt="hexo"></p><blockquote><p><strong>ä¸€ä¸ªåŸºäº Github Issue å’Œ Preact å¼€å‘çš„è¯„è®ºæ’ä»¶,ä¸‹é¢æˆ‘ä»¬å°±æ¥ä½¿ç”¨gitalkæ¥å®ç°hexoçš„è¯„è®ºåŠŸèƒ½ã€‚</strong></p></blockquote><h4 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h4><ul><li><a href="https://gitalk.github.io/" target="_blank" rel="noopener">Gitalkå¼€æºåœ°å€</a></li></ul><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>ä½¿ç”¨ GitHub ç™»å½•</li><li>æ”¯æŒå¤šè¯­è¨€ [en, zh-CN, zh-TW, es-ES, fr, ru]</li><li>æ”¯æŒä¸ªäººæˆ–ç»„ç»‡</li><li>æ— å¹²æ‰°æ¨¡å¼ï¼ˆè®¾ç½® distractionFreeMode ä¸º true å¼€å¯ï¼‰</li><li>å¿«æ·é”®æäº¤è¯„è®º ï¼ˆcmd|ctrl + enterï¼‰</li></ul><p><a href="https://github.com/gitalk/gitalk/blob/master/readme.md" target="_blank" rel="noopener">Readme</a><br><a href="https://gitalk.github.io" target="_blank" rel="noopener">åœ¨çº¿ç¤ºä¾‹</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ä¸¤ç§æ–¹å¼</p><ul><li>ç›´æ¥å¼•å…¥</li></ul><pre><code class="html">  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css&quot;&gt;  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js&quot;&gt;&lt;/script&gt;  &lt;!-- or --&gt;  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/gitalk/dist/gitalk.css&quot;&gt;  &lt;script src=&quot;https://unpkg.com/gitalk/dist/gitalk.min.js&quot;&gt;&lt;/script&gt;</code></pre><ul><li>npm å®‰è£…</li></ul><pre><code class="sh">npm i --save gitalk</code></pre><pre><code class="js">import &#39;gitalk/dist/gitalk.css&#39;import Gitalk from &#39;gitalk&#39;</code></pre><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>æ·»åŠ ä¸€ä¸ªå®¹å™¨ï¼š</p><pre><code class="html">&lt;div id=&quot;gitalk-container&quot;&gt;&lt;/div&gt;</code></pre><p>ç”¨ä¸‹é¢çš„ Javascript ä»£ç æ¥ç”Ÿæˆ gitalk æ’ä»¶ï¼š</p><pre><code class="js">var gitalk = new Gitalk({  clientID: &#39;GitHub Application Client ID&#39;,  clientSecret: &#39;GitHub Application Client Secret&#39;,  repo: &#39;GitHub repo&#39;,  owner: &#39;GitHub repo owner&#39;,  admin: [&#39;GitHub repo owner and collaborators, only these guys can initialize github issues&#39;],  id: location.pathname,      // Ensure uniqueness and length less than 50  distractionFreeMode: false  // Facebook-like distraction free mode})gitalk.render(&#39;gitalk-container&#39;)</code></pre><p>éœ€è¦ <strong>GitHub Application</strong>ï¼Œå¦‚æœæ²¡æœ‰ <a href="https://github.com/settings/applications/new" target="_blank" rel="noopener">ç‚¹å‡»è¿™é‡Œç”³è¯·</a>ï¼Œ<code>Authorization callback URL</code> å¡«å†™å½“å‰ä½¿ç”¨æ’ä»¶é¡µé¢çš„åŸŸåã€‚</p><p><strong>âš ï¸æ›´å¤šå¸®åŠ©åœ¨å®˜æ–¹æ–‡æ¡£,å¯ä»¥åœ¨å®˜æ–¹é“¾æ¥é‡ŒæŸ¥è¯¢ã€‚</strong></p><h2 id="è®¾ç½®GitHub"><a href="#è®¾ç½®GitHub" class="headerlink" title="è®¾ç½®GitHub"></a>è®¾ç½®GitHub</h2><ul><li>åœ¨ä¸ªäººè®¾ç½®é‡Œé¢åˆ›å»ºä¸€ä¸ªApplication<br><img src="https://i.loli.net/2020/03/08/fKqE9JHALBXMnN7.jpg" srcset="/img/loading.gif" alt="Xnip2020-03-07_12-46-47.jpg"></li><li>ç„¶åæˆ‘ä»¬éœ€è¦çš„ClientIDå’ŒToken<br><img src="https://i.loli.net/2020/03/08/vAx7wkRFhsNyqtX.jpg" srcset="/img/loading.gif" alt="clientId"></li><li>åˆ›å»ºä¸€ä¸ªå­˜æ”¾lssueä»“åº“<br><img src="https://i.loli.net/2020/03/08/jeBmlY2RD6Fi35E.jpg" srcset="/img/loading.gif" alt="Xnip2020-03-07_13-00-14.jpg"><h2 id="åœ¨Hexoé‡Œä½¿ç”¨"><a href="#åœ¨Hexoé‡Œä½¿ç”¨" class="headerlink" title="åœ¨Hexoé‡Œä½¿ç”¨"></a>åœ¨Hexoé‡Œä½¿ç”¨</h2><blockquote><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„ä¸»é¢˜é‡Œé¢å·²ç»é›†æˆäº†gitalk,æ‰€æœ‰æˆ‘ä»¬ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ã€‚æ ¹æ®ä¸ªäººé…ç½®æ–¹æ³•ä¸åŒæŸ¥è¯¢å„ç§æ–‡æ¡£ï¼ï¼ï¼</p></blockquote></li></ul><p>ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®æ–‡ä»¶ğŸ“ƒ</p><pre><code class="yaml"># Gitalk# You can get yout ClientID and ClientSecret from https://github.com/settings/applications/new# More info available at https://github.com/gitalk/gitalk#optionsgitalk:  clientID: è¿™é‡Œå¡«å†™ä½ ä¹‹å‰applicationçš„clientID # GitHub Application Client ID  clientSecret: ä¹‹å‰ç”³è¯·çš„ # GitHub Application Client Secret  repo: ibyte.me # The repo to store comments  owner: deencode # GitHub repository owner. Can be personal user or organization.  admin: deencode # GitHub repo owner and collaborators, only these guys can initialize github issues, should be like &quot;[&#39;admin&#39;]&quot; or &quot;[&#39;admin1&#39;,&#39;admin2&#39;]&quot;  id: location.pathname # The unique id of the page. Length must less than 50.  language: zh-CN # Localization language key, en, zh-CN and zh-TW are currently available.  labels: &quot;[&#39;Gitalk&#39;]&quot; # GitHub issue labels.  perPage: 15 # Pagination size, with maximum 100.  pagerDirection: last # Comment sorting direction, available values are last and first.  distractionFreeMode: false # Facebook-like distraction free mode.  createIssueManually: true # By default, Gitalk will create a corresponding github issue for your every single page automatically when the logined user is belong to the admin users. You can create it manually by setting this option to true.</code></pre><p><strong>é…ç½®æ–¹æ³•ä¸åŒæœ‰æ‰€å·®å¼‚!!æ ¹æ®è‡ªå·±ä½¿ç”¨çš„æ’ä»¶æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£è¿›è¡Œçš„é…ç½®ï¼ï¼ï¼Good LuckğŸ˜œ</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>gitalk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨Hexoæ­å»ºBlog</title>
    <link href="/2020/03/06/%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BABlog/"/>
    <url>/2020/03/06/%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BABlog/</url>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2020/03/06/cOUwFstAaTeyGQk.jpg" srcset="/img/loading.gif" alt="Hexo&amp;GithubPage.jpg"></p><h3 id="1-ç›¸å…³ç½‘ç«™"><a href="#1-ç›¸å…³ç½‘ç«™" class="headerlink" title="1. ç›¸å…³ç½‘ç«™"></a>1. ç›¸å…³ç½‘ç«™</h3><ul><li>[Github]: <a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a></li><li>[Hexo]: <a href="https://hexo.io/" target="_blank" rel="noopener">https://hexo.io/</a></li><li>[Hexo Theme]: <a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></li><li>[Hexo Docs]: <a href="https://hexo.io/docs/" target="_blank" rel="noopener">https://hexo.io/docs/</a></li></ul><h3 id="2-åˆ›å»ºGithub-Key"><a href="#2-åˆ›å»ºGithub-Key" class="headerlink" title="2. åˆ›å»ºGithub Key"></a>2. åˆ›å»ºGithub Key</h3><p>è®¾ç½®ä½ çš„ç”¨æˆ·åç§°ä¸é‚®ä»¶åœ°å€ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨gitçš„è¯</p><pre><code class="bash">$ git config --global user.name &quot;John Doe&quot;$ git config --global user.email johndoe@example.com</code></pre><p>ä½¿ç”¨ssh-keygenç”Ÿæˆç§é’¥å’Œå…¬é’¥<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class="bash">$ ssh-keygen -t rsa</code></pre><p>ç„¶ååˆ°ä½ GitHub è®¾ç½®é‡Œé¢æ·»åŠ ä½ åˆšæ‰ç”Ÿæˆçš„xx.pubçš„å†…å®¹åˆ°Keyé‡Œé¢.</p><pre><code class="bash">$ ssh -T git@github.com</code></pre><p>ç™»å½•Githubï¼Œç‚¹å‡»å¤´åƒä¸‹çš„settingsï¼Œæ·»åŠ ssh,æ–°å»ºä¸€ä¸ªnew ssh keyï¼Œå°†id_rsa.pubæ–‡ä»¶é‡Œçš„å†…å®¹å¤åˆ¶ä¸Šå»ã€‚</p><p>è¾“å…¥ssh -T <a href="mailto:git@github.com">git@github.com</a>ï¼Œæµ‹è¯•æ·»åŠ sshæ˜¯å¦æˆåŠŸã€‚å¦‚æœçœ‹åˆ°Hiåé¢æ˜¯ä½ çš„ç”¨æˆ·åï¼Œå°±è¯´æ˜æˆåŠŸäº†ã€‚</p><p>è¿™é‡Œä½ å¯ä»¥å»åˆ›å»ºä¸€ä¸ªpublicçš„ä»“åº“æ¥å­˜å‚¨ç­‰ä¸‹Hexoç›¸å…³çš„æ–‡ä»¶.</p><h3 id="3-å®‰è£…NPMå’ŒHexo"><a href="#3-å®‰è£…NPMå’ŒHexo" class="headerlink" title="3. å®‰è£…NPMå’ŒHexo"></a>3. å®‰è£…NPMå’ŒHexo</h3><ul><li>[NodeJSç½‘ç«™]: <a href="http://nodejs.cn/" target="_blank" rel="noopener">http://nodejs.cn/</a></li></ul><p>é€šè¿‡ä¸Šé¢çš„ç½‘ç«™ä¸‹è½½å¯¹åº”çš„ç³»ç»Ÿç‰ˆæœ¬çš„NodeJSå®‰è£…åŒ….</p><ol><li><strong>è®¾ç½®NPMæºåˆ°æ·˜å®æº</strong></li></ol><pre><code class="bash">   npm config set registry https://registry.npmjs.org/</code></pre><ol start="2"><li><p><strong>NPMå®‰è£…HexoCli</strong></p><p>è¾“å…¥npm install hexo -gï¼Œå¼€å§‹å®‰è£…Hexo</p></li></ol><pre><code class="bash">   npm install hexo -g</code></pre><ol start="3"><li><p><strong>åˆå§‹åŒ–Hexo</strong></p><p>è¾“å…¥hexo -vï¼Œæ£€æŸ¥hexoæ˜¯å¦å®‰è£…æˆåŠŸ</p><p>è¾“å…¥hexo initï¼Œåˆå§‹åŒ–è¯¥æ–‡ä»¶å¤¹ï¼ˆæœ‰ç‚¹æ¼«é•¿çš„ç­‰å¾…â€¦ï¼‰çœ‹åˆ°åé¢çš„â€œStart blogging with Hexoï¼â€å°±è¯´æ˜åˆå§‹åŒ–å¥½äº†</p><p>è¾“å…¥npm installï¼Œå®‰è£…æ‰€éœ€è¦çš„ç»„ä»¶</p></li></ol><pre><code class="bash">$ hexo -v$ hexo init$ hexo install        </code></pre><h3 id="4-é…ç½®config-ymlæ–‡ä»¶"><a href="#4-é…ç½®config-ymlæ–‡ä»¶" class="headerlink" title="4.é…ç½®config.ymlæ–‡ä»¶"></a>4.é…ç½®config.ymlæ–‡ä»¶</h3><p><strong>PS:è¿™é‡Œæ ¹æ®è‡ªå·±éœ€è¦è‡ªå·±é…ç½®ï¼Œä½ å¯ä»¥å»æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼ï¼</strong></p><pre><code class="bash">deploy:  type: git  repo: git@github.com:Deencode/ibyte.me.git  branch: master</code></pre><h3 id="5-ç”Ÿæˆé™æ€æ–‡ä»¶-amp-ä¸Šä¼ åˆ°GitHubä»“åº“"><a href="#5-ç”Ÿæˆé™æ€æ–‡ä»¶-amp-ä¸Šä¼ åˆ°GitHubä»“åº“" class="headerlink" title="5.ç”Ÿæˆé™æ€æ–‡ä»¶&amp;ä¸Šä¼ åˆ°GitHubä»“åº“"></a>5.ç”Ÿæˆé™æ€æ–‡ä»¶&amp;ä¸Šä¼ åˆ°GitHubä»“åº“</h3><p><strong>ğŸ‰: åˆ°äº†è¿™ä¸€æ­¥å°±å·®ä¸å¤šäº†ï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤å°±å¯ä»¥ç”Ÿæˆæ–‡ä»¶äº†.</strong></p><pre><code class="bash">#ç”Ÿæˆæ–‡ä»¶$ hexo generate#ç›‘è§†æ–‡ä»¶å˜åŠ¨Hexo èƒ½å¤Ÿç›‘è§†æ–‡ä»¶å˜åŠ¨å¹¶ç«‹å³é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶#åœ¨ç”Ÿæˆæ—¶ä¼šæ¯”å¯¹æ–‡ä»¶çš„ SHA1 checksumï¼Œåªæœ‰å˜åŠ¨çš„æ–‡ä»¶æ‰ä¼šå†™å…¥ã€‚$ hexo generate --watch# æœ¬åœ°è¿è¡Œ$ hexo server#æ‚¨å¯æ‰§è¡Œä¸‹åˆ—çš„å…¶ä¸­ä¸€ä¸ªå‘½ä»¤ï¼Œè®© Hexo åœ¨ç”Ÿæˆå®Œæ¯•åè‡ªåŠ¨éƒ¨ç½²ç½‘ç«™ï¼Œä¸¤ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ç›¸åŒçš„ã€‚$ hexo deploy</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
